<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Byeong-Hak Choe">
<meta name="dcterms.date" content="2025-03-05">

<title>Homework 2 | Byeong-Hak Choe</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
<link rel="stylesheet" href="../assets/css/font.css">
<meta property="og:title" content="Homework 2 | Byeong-Hak Choe">
<meta property="og:description" content="Beer Markets">
<meta property="og:image" content="/assets/img/posts.png">
<meta property="og:site-name" content="Home">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../img/geneseo-logo-squared.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Home</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../blog-listing.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/bcdanl/320-code" rel="" target="_blank">
 <span class="menu-text">Class Code</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../listing-danl-320-ml.html" rel="" target="_blank">
 <span class="menu-text">ML Notebook</span></a>
  </li>  
  <li class="dropdown-header">
 <span class="menu-text"> </span></li>
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="3">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#settings" id="toc-settings" class="nav-link active" data-scroll-target="#settings">Settings</a>
  <ul>
  <li><a href="#required-libraries-and-spark-session" id="toc-required-libraries-and-spark-session" class="nav-link" data-scroll-target="#required-libraries-and-spark-session">Required Libraries and Spark Session</a></li>
  <li><a href="#udfs" id="toc-udfs" class="nav-link" data-scroll-target="#udfs">UDFs</a>
  <ul>
  <li><a href="#regression_table" id="toc-regression_table" class="nav-link" data-scroll-target="#regression_table">regression_table</a></li>
  <li><a href="#add_dummy_variables" id="toc-add_dummy_variables" class="nav-link" data-scroll-target="#add_dummy_variables">add_dummy_variables</a></li>
  <li><a href="#add_interaction_terms" id="toc-add_interaction_terms" class="nav-link" data-scroll-target="#add_interaction_terms">add_interaction_terms</a></li>
  <li><a href="#compare_reg_models" id="toc-compare_reg_models" class="nav-link" data-scroll-target="#compare_reg_models">compare_reg_models</a></li>
  <li><a href="#compare_rmse" id="toc-compare_rmse" class="nav-link" data-scroll-target="#compare_rmse">compare_rmse</a></li>
  <li><a href="#residual_plot" id="toc-residual_plot" class="nav-link" data-scroll-target="#residual_plot">residual_plot</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">Data Preparation</a>
  <ul>
  <li><a href="#log-transformation" id="toc-log-transformation" class="nav-link" data-scroll-target="#log-transformation">Log Transformation</a></li>
  <li><a href="#question-1---filter" id="toc-question-1---filter" class="nav-link" data-scroll-target="#question-1---filter">Question 1 - Filter</a></li>
  <li><a href="#question-2---training-test-split" id="toc-question-2---training-test-split" class="nav-link" data-scroll-target="#question-2---training-test-split">Question 2 - Training-Test Split</a></li>
  <li><a href="#adding-dummies" id="toc-adding-dummies" class="nav-link" data-scroll-target="#adding-dummies">Adding Dummies</a></li>
  <li><a href="#adding-interaction-terms" id="toc-adding-interaction-terms" class="nav-link" data-scroll-target="#adding-interaction-terms">Adding Interaction Terms</a></li>
  </ul></li>
  <li><a href="#question-3---intuition-behind-each-model" id="toc-question-3---intuition-behind-each-model" class="nav-link" data-scroll-target="#question-3---intuition-behind-each-model">Question 3 - Intuition behind Each Model</a></li>
  <li><a href="#model-1" id="toc-model-1" class="nav-link" data-scroll-target="#model-1">Model 1</a></li>
  <li><a href="#model-2" id="toc-model-2" class="nav-link" data-scroll-target="#model-2">Model 2</a></li>
  <li><a href="#model-3" id="toc-model-3" class="nav-link" data-scroll-target="#model-3">Model 3</a></li>
  <li><a href="#model-comparison" id="toc-model-comparison" class="nav-link" data-scroll-target="#model-comparison">Model Comparison</a>
  <ul>
  <li><a href="#question-4" id="toc-question-4" class="nav-link" data-scroll-target="#question-4">Question 4</a>
  <ul>
  <li><a href="#question-4---rmses-on-test-data" id="toc-question-4---rmses-on-test-data" class="nav-link" data-scroll-target="#question-4---rmses-on-test-data">Question 4 - RMSEs on Test Data</a></li>
  </ul></li>
  <li><a href="#question-5" id="toc-question-5" class="nav-link" data-scroll-target="#question-5">Question 5</a></li>
  <li><a href="#question-6" id="toc-question-6" class="nav-link" data-scroll-target="#question-6">Question 6</a></li>
  <li><a href="#question-7" id="toc-question-7" class="nav-link" data-scroll-target="#question-7">Question 7</a></li>
  <li><a href="#residual-plots" id="toc-residual-plots" class="nav-link" data-scroll-target="#residual-plots">Residual Plots</a></li>
  <li><a href="#question-8" id="toc-question-8" class="nav-link" data-scroll-target="#question-8">Question 8</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Homework 2</h1>
<p class="subtitle lead">Beer Markets</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Byeong-Hak Choe </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 5, 2025</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">April 19, 2025</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="settings" class="level1">
<h1>Settings</h1>
<section id="required-libraries-and-spark-session" class="level2">
<h2 class="anchored" data-anchor-id="required-libraries-and-spark-session">Required Libraries and Spark Session</h2>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tabulate <span class="im">import</span> tabulate  <span class="co"># for table summary</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> stats</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm  <span class="co"># for lowess smoothing</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> SparkSession</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.functions <span class="im">import</span> rand, col, <span class="bu">pow</span>, mean, avg, when, log, sqrt, exp</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.feature <span class="im">import</span> VectorAssembler</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.regression <span class="im">import</span> LinearRegression</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>spark <span class="op">=</span> SparkSession.builder.master(<span class="st">"local[*]"</span>).getOrCreate()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="udfs" class="level2">
<h2 class="anchored" data-anchor-id="udfs">UDFs</h2>
<section id="regression_table" class="level3">
<h3 class="anchored" data-anchor-id="regression_table">regression_table</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> regression_table(model, assembler):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Creates a formatted regression table from a fitted LinearRegression model and its VectorAssembler.</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">    If the model’s labelCol (retrieved using getLabelCol()) starts with "log", an extra column showing np.exp(coeff)</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">    is added immediately after the beta estimate column for predictor rows. Additionally, np.exp() of the 95% CI</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Lower and Upper bounds is also added unless the predictor's name includes "log_". The Intercept row does not</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">    include exponentiated values.</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">    When labelCol starts with "log", the columns are ordered as:</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">        y: [label] | Beta | Exp(Beta) | Sig. | Std. Error | p-value | 95% CI Lower | 95% CI Upper | Exp(95% CI Lower) | Exp(95% CI Upper)</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">    Otherwise, the columns are:</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">        y: [label] | Beta | Sig. | Std. Error | p-value | 95% CI Lower | 95% CI Upper</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">        model: A fitted LinearRegression model (with a .summary attribute and a labelCol).</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co">        assembler: The VectorAssembler used to assemble the features for the model.</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co">        A formatted string containing the regression table.</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Determine if we should display exponential values for coefficients.</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    is_log <span class="op">=</span> model.getLabelCol().lower().startswith(<span class="st">"log"</span>)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract coefficients and standard errors as NumPy arrays.</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    coeffs <span class="op">=</span> model.coefficients.toArray()</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    std_errors_all <span class="op">=</span> np.array(model.summary.coefficientStandardErrors)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if the intercept's standard error is included (one extra element).</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(std_errors_all) <span class="op">==</span> <span class="bu">len</span>(coeffs) <span class="op">+</span> <span class="dv">1</span>:</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>        intercept_se <span class="op">=</span> std_errors_all[<span class="dv">0</span>]</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>        std_errors <span class="op">=</span> std_errors_all[<span class="dv">1</span>:]</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>        intercept_se <span class="op">=</span> <span class="va">None</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>        std_errors <span class="op">=</span> std_errors_all</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use provided tValues and pValues.</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> model.summary.numInstances <span class="op">-</span> <span class="bu">len</span>(coeffs) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    t_critical <span class="op">=</span> stats.t.ppf(<span class="fl">0.975</span>, df)</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    p_values <span class="op">=</span> model.summary.pValues</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Helper: significance stars.</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> significance_stars(p):</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> p <span class="op">&lt;</span> <span class="fl">0.01</span>:</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"***"</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> p <span class="op">&lt;</span> <span class="fl">0.05</span>:</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"**"</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> p <span class="op">&lt;</span> <span class="fl">0.1</span>:</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"*"</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">""</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build table rows for each feature.</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    table <span class="op">=</span> []</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> feature, beta, se, p <span class="kw">in</span> <span class="bu">zip</span>(assembler.getInputCols(), coeffs, std_errors, p_values):</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>        ci_lower <span class="op">=</span> beta <span class="op">-</span> t_critical <span class="op">*</span> se</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>        ci_upper <span class="op">=</span> beta <span class="op">+</span> t_critical <span class="op">*</span> se</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if predictor contains "log_" to determine if exponentiation should be applied</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>        apply_exp <span class="op">=</span> is_log <span class="kw">and</span> <span class="st">"log_"</span> <span class="kw">not</span> <span class="kw">in</span> feature.lower()</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>        exp_beta <span class="op">=</span> np.exp(beta) <span class="cf">if</span> apply_exp <span class="cf">else</span> <span class="st">""</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>        exp_ci_lower <span class="op">=</span> np.exp(ci_lower) <span class="cf">if</span> apply_exp <span class="cf">else</span> <span class="st">""</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>        exp_ci_upper <span class="op">=</span> np.exp(ci_upper) <span class="cf">if</span> apply_exp <span class="cf">else</span> <span class="st">""</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> is_log:</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>            table.append([</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>                feature,            <span class="co"># Predictor name</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>                beta,               <span class="co"># Beta estimate</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>                exp_beta,           <span class="co"># Exponential of beta (or blank)</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>                significance_stars(p),</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>                se,</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>                p,</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>                ci_lower,</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>                ci_upper,</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>                exp_ci_lower,       <span class="co"># Exponential of 95% CI lower bound</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>                exp_ci_upper        <span class="co"># Exponential of 95% CI upper bound</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>            ])</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>            table.append([</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>                feature,</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>                beta,</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>                significance_stars(p),</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>                se,</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>                p,</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>                ci_lower,</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>                ci_upper</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>            ])</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process intercept.</span></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> intercept_se <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>        intercept_p <span class="op">=</span> model.summary.pValues[<span class="dv">0</span>] <span class="cf">if</span> model.summary.pValues <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>        intercept_sig <span class="op">=</span> significance_stars(intercept_p)</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>        ci_intercept_lower <span class="op">=</span> model.intercept <span class="op">-</span> t_critical <span class="op">*</span> intercept_se</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>        ci_intercept_upper <span class="op">=</span> model.intercept <span class="op">+</span> t_critical <span class="op">*</span> intercept_se</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>        intercept_sig <span class="op">=</span> <span class="st">""</span></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>        ci_intercept_lower <span class="op">=</span> <span class="st">""</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>        ci_intercept_upper <span class="op">=</span> <span class="st">""</span></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>        intercept_se <span class="op">=</span> <span class="st">""</span></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> is_log:</span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>        table.append([</span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Intercept"</span>,</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>            model.intercept,</span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>            <span class="st">""</span>,                    <span class="co"># Removed np.exp(model.intercept)</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>            intercept_sig,</span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>            intercept_se,</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>            <span class="st">""</span>,</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>            ci_intercept_lower,</span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>            <span class="st">""</span>,</span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>            ci_intercept_upper,</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>            <span class="st">""</span></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>        table.append([</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Intercept"</span>,</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>            model.intercept,</span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>            intercept_sig,</span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>            intercept_se,</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>            <span class="st">""</span>,</span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>            ci_intercept_lower,</span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>            ci_intercept_upper</span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Append overall model metrics.</span></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> is_log:</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>        table.append([<span class="st">"Observations"</span>, model.summary.numInstances, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>])</span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>        table.append([<span class="st">"R²"</span>, model.summary.r2, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>])</span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>        table.append([<span class="st">"RMSE"</span>, model.summary.rootMeanSquaredError, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>])</span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>        table.append([<span class="st">"Observations"</span>, model.summary.numInstances, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>])</span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>        table.append([<span class="st">"R²"</span>, model.summary.r2, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>])</span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>        table.append([<span class="st">"RMSE"</span>, model.summary.rootMeanSquaredError, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>])</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Format the table rows.</span></span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>    formatted_table <span class="op">=</span> []</span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> table:</span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>        formatted_row <span class="op">=</span> []</span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, item <span class="kw">in</span> <span class="bu">enumerate</span>(row):</span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Format Observations as integer with commas.</span></span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> row[<span class="dv">0</span>] <span class="op">==</span> <span class="st">"Observations"</span> <span class="kw">and</span> i <span class="op">==</span> <span class="dv">1</span> <span class="kw">and</span> <span class="bu">isinstance</span>(item, (<span class="bu">int</span>, <span class="bu">float</span>, np.floating)) <span class="kw">and</span> item <span class="op">!=</span> <span class="st">""</span>:</span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>                formatted_row.append(<span class="ss">f"</span><span class="sc">{</span><span class="bu">int</span>(item)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(item, (<span class="bu">int</span>, <span class="bu">float</span>, np.floating)) <span class="kw">and</span> item <span class="op">!=</span> <span class="st">""</span>:</span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> is_log:</span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># When is_log, the columns are:</span></span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># 0: Metric, 1: Beta, 2: Exp(Beta), 3: Sig, 4: Std. Error, 5: p-value,</span></span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># 6: 95% CI Lower, 7: 95% CI Upper, 8: Exp(95% CI Lower), 9: Exp(95% CI Upper).</span></span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> i <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>]:</span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>                        formatted_row.append(<span class="ss">f"</span><span class="sc">{</span>item<span class="sc">:,</span><span class="fl">.3</span><span class="er">f</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> i <span class="op">==</span> <span class="dv">5</span>:</span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>                        formatted_row.append(<span class="ss">f"</span><span class="sc">{</span>item<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>                        formatted_row.append(<span class="ss">f"</span><span class="sc">{</span>item<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># When not is_log, the columns are:</span></span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># 0: Metric, 1: Beta, 2: Sig, 3: Std. Error, 4: p-value, 5: 95% CI Lower, 6: 95% CI Upper.</span></span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> i <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">6</span>]:</span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>                        formatted_row.append(<span class="ss">f"</span><span class="sc">{</span>item<span class="sc">:,</span><span class="fl">.3</span><span class="er">f</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> i <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>                        formatted_row.append(<span class="ss">f"</span><span class="sc">{</span>item<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a>                        formatted_row.append(<span class="ss">f"</span><span class="sc">{</span>item<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>                formatted_row.append(item)</span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a>        formatted_table.append(formatted_row)</span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set header and column alignment based on whether label starts with "log"</span></span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> is_log:</span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>        headers <span class="op">=</span> [</span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"y: </span><span class="sc">{</span>model<span class="sc">.</span>getLabelCol()<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Beta"</span>, <span class="st">"Exp(Beta)"</span>, <span class="st">"Sig."</span>, <span class="st">"Std. Error"</span>, <span class="st">"p-value"</span>,</span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a>            <span class="st">"95% CI Lower"</span>, <span class="st">"95% CI Upper"</span>, <span class="st">"Exp(95% CI Lower)"</span>, <span class="st">"Exp(95% CI Upper)"</span></span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>        colalign <span class="op">=</span> (<span class="st">"left"</span>, <span class="st">"right"</span>, <span class="st">"right"</span>, <span class="st">"center"</span>, <span class="st">"right"</span>, <span class="st">"right"</span>, <span class="st">"right"</span>, <span class="st">"right"</span>, <span class="st">"right"</span>, <span class="st">"right"</span>)</span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a>        headers <span class="op">=</span> [<span class="ss">f"y: </span><span class="sc">{</span>model<span class="sc">.</span>getLabelCol()<span class="sc">}</span><span class="ss">"</span>, <span class="st">"Beta"</span>, <span class="st">"Sig."</span>, <span class="st">"Std. Error"</span>, <span class="st">"p-value"</span>, <span class="st">"95% CI Lower"</span>, <span class="st">"95% CI Upper"</span>]</span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a>        colalign <span class="op">=</span> (<span class="st">"left"</span>, <span class="st">"right"</span>, <span class="st">"center"</span>, <span class="st">"right"</span>, <span class="st">"right"</span>, <span class="st">"right"</span>, <span class="st">"right"</span>)</span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a>    table_str <span class="op">=</span> tabulate(</span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a>        formatted_table,</span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a>        headers<span class="op">=</span>headers,</span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a>        tablefmt<span class="op">=</span><span class="st">"pretty"</span>,</span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a>        colalign<span class="op">=</span>colalign</span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Insert a dashed line after the Intercept row.</span></span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> table_str.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a>    dash_line <span class="op">=</span> <span class="st">'-'</span> <span class="op">*</span> <span class="bu">len</span>(lines[<span class="dv">0</span>])</span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, line <span class="kw">in</span> <span class="bu">enumerate</span>(lines):</span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"Intercept"</span> <span class="kw">in</span> line <span class="kw">and</span> <span class="kw">not</span> line.strip().startswith(<span class="st">'+'</span>):</span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a>            lines.insert(i<span class="op">+</span><span class="dv">1</span>, dash_line)</span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(lines)</span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage:</span></span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a><span class="co"># print(regression_table(model_1, assembler_1))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="add_dummy_variables" class="level3">
<h3 class="anchored" data-anchor-id="add_dummy_variables">add_dummy_variables</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_dummy_variables(var_name, reference_level, category_order<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Creates dummy variables for the specified column in the global DataFrames dtrain and dtest.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Allows manual setting of category order.</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">        var_name (str): The name of the categorical column (e.g., "borough_name").</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">        reference_level (int): Index of the category to be used as the reference (dummy omitted).</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">        category_order (list, optional): List of categories in the desired order. If None, categories are sorted.</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">        dummy_cols (list): List of dummy column names excluding the reference category.</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">        ref_category (str): The category chosen as the reference.</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> dtrain, dtest</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get distinct categories from the training set.</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    categories <span class="op">=</span> dtrain.select(var_name).distinct().rdd.flatMap(<span class="kw">lambda</span> x: x).collect()</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert booleans to strings if present.</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    categories <span class="op">=</span> [<span class="bu">str</span>(c) <span class="cf">if</span> <span class="bu">isinstance</span>(c, <span class="bu">bool</span>) <span class="cf">else</span> c <span class="cf">for</span> c <span class="kw">in</span> categories]</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use manual category order if provided; otherwise, sort categories.</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> category_order:</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure all categories are present in the user-defined order</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        missing <span class="op">=</span> <span class="bu">set</span>(categories) <span class="op">-</span> <span class="bu">set</span>(category_order)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> missing:</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"These categories are missing from your custom order: </span><span class="sc">{</span>missing<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>        categories <span class="op">=</span> category_order</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>        categories <span class="op">=</span> <span class="bu">sorted</span>(categories)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validate reference_level</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> reference_level <span class="op">&lt;</span> <span class="dv">0</span> <span class="kw">or</span> reference_level <span class="op">&gt;=</span> <span class="bu">len</span>(categories):</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"reference_level must be between 0 and </span><span class="sc">{</span><span class="bu">len</span>(categories) <span class="op">-</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define the reference category</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    ref_category <span class="op">=</span> categories[reference_level]</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Reference category (dummy omitted):"</span>, ref_category)</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create dummy variables for all categories</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> cat <span class="kw">in</span> categories:</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>        dummy_col_name <span class="op">=</span> var_name <span class="op">+</span> <span class="st">"_"</span> <span class="op">+</span> <span class="bu">str</span>(cat).replace(<span class="st">" "</span>, <span class="st">"_"</span>)</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>        dtrain <span class="op">=</span> dtrain.withColumn(dummy_col_name, when(col(var_name) <span class="op">==</span> cat, <span class="dv">1</span>).otherwise(<span class="dv">0</span>))</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>        dtest <span class="op">=</span> dtest.withColumn(dummy_col_name, when(col(var_name) <span class="op">==</span> cat, <span class="dv">1</span>).otherwise(<span class="dv">0</span>))</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># List of dummy columns, excluding the reference category</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    dummy_cols <span class="op">=</span> [var_name <span class="op">+</span> <span class="st">"_"</span> <span class="op">+</span> <span class="bu">str</span>(cat).replace(<span class="st">" "</span>, <span class="st">"_"</span>) <span class="cf">for</span> cat <span class="kw">in</span> categories <span class="cf">if</span> cat <span class="op">!=</span> ref_category]</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dummy_cols, ref_category</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage without category_order:</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="co"># dummy_cols_year, ref_category_year = add_dummy_variables('year', 0)</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage with category_order:</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a><span class="co"># custom_order_wkday = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday']</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a><span class="co"># dummy_cols_wkday, ref_category_wkday = add_dummy_variables('wkday', reference_level=0, category_order = custom_order_wkday)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="add_interaction_terms" class="level3">
<h3 class="anchored" data-anchor-id="add_interaction_terms">add_interaction_terms</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_interaction_terms(var_list1, var_list2, var_list3<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Creates interaction term columns in the global DataFrames dtrain and dtest.</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">    For two sets of variable names (which may represent categorical (dummy) or continuous variables),</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">    this function creates two-way interactions by multiplying each variable in var_list1 with each</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">    variable in var_list2.</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Optionally, if a third list of variable names (var_list3) is provided, the function also creates</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">    three-way interactions among each variable in var_list1, each variable in var_list2, and each variable</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">    in var_list3.</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">        var_list1 (list): List of column names for the first set of variables.</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">        var_list2 (list): List of column names for the second set of variables.</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">        var_list3 (list, optional): List of column names for the third set of variables for three-way interactions.</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co">        A flat list of new interaction column names.</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> dtrain, dtest</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    interaction_cols <span class="op">=</span> []</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create two-way interactions between var_list1 and var_list2.</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> var1 <span class="kw">in</span> var_list1:</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> var2 <span class="kw">in</span> var_list2:</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>            col_name <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>var1<span class="sc">}</span><span class="ss">_*_</span><span class="sc">{</span>var2<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>            dtrain <span class="op">=</span> dtrain.withColumn(col_name, col(var1).cast(<span class="st">"double"</span>) <span class="op">*</span> col(var2).cast(<span class="st">"double"</span>))</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>            dtest <span class="op">=</span> dtest.withColumn(col_name, col(var1).cast(<span class="st">"double"</span>) <span class="op">*</span> col(var2).cast(<span class="st">"double"</span>))</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>            interaction_cols.append(col_name)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create two-way interactions between var_list1 and var_list3.</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> var_list3 <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> var1 <span class="kw">in</span> var_list1:</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> var3 <span class="kw">in</span> var_list3:</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>              col_name <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>var1<span class="sc">}</span><span class="ss">_*_</span><span class="sc">{</span>var3<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>              dtrain <span class="op">=</span> dtrain.withColumn(col_name, col(var1).cast(<span class="st">"double"</span>) <span class="op">*</span> col(var3).cast(<span class="st">"double"</span>))</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>              dtest <span class="op">=</span> dtest.withColumn(col_name, col(var1).cast(<span class="st">"double"</span>) <span class="op">*</span> col(var3).cast(<span class="st">"double"</span>))</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>              interaction_cols.append(col_name)</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create two-way interactions between var_list2 and var_list3.</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> var_list3 <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> var2 <span class="kw">in</span> var_list2:</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> var3 <span class="kw">in</span> var_list3:</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>              col_name <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>var2<span class="sc">}</span><span class="ss">_*_</span><span class="sc">{</span>var3<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>              dtrain <span class="op">=</span> dtrain.withColumn(col_name, col(var2).cast(<span class="st">"double"</span>) <span class="op">*</span> col(var3).cast(<span class="st">"double"</span>))</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>              dtest <span class="op">=</span> dtest.withColumn(col_name, col(var2).cast(<span class="st">"double"</span>) <span class="op">*</span> col(var3).cast(<span class="st">"double"</span>))</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>              interaction_cols.append(col_name)</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If a third list is provided, create three-way interactions.</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> var_list3 <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> var1 <span class="kw">in</span> var_list1:</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> var2 <span class="kw">in</span> var_list2:</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> var3 <span class="kw">in</span> var_list3:</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>                    col_name <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>var1<span class="sc">}</span><span class="ss">_*_</span><span class="sc">{</span>var2<span class="sc">}</span><span class="ss">_*_</span><span class="sc">{</span>var3<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>                    dtrain <span class="op">=</span> dtrain.withColumn(col_name, col(var1).cast(<span class="st">"double"</span>) <span class="op">*</span> col(var2).cast(<span class="st">"double"</span>) <span class="op">*</span> col(var3).cast(<span class="st">"double"</span>))</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>                    dtest <span class="op">=</span> dtest.withColumn(col_name, col(var1).cast(<span class="st">"double"</span>) <span class="op">*</span> col(var2).cast(<span class="st">"double"</span>) <span class="op">*</span> col(var3).cast(<span class="st">"double"</span>))</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>                    interaction_cols.append(col_name)</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> interaction_cols</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a> <span class="co"># Example</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a> <span class="co"># interaction_cols_brand_price = add_interaction_terms(dummy_cols_brand, ['log_price'])</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a> <span class="co"># interaction_cols_brand_ad_price = add_interaction_terms(dummy_cols_brand, dummy_cols_ad, ['log_price'])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="compare_reg_models" class="level3">
<h3 class="anchored" data-anchor-id="compare_reg_models">compare_reg_models</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compare_reg_models(models, assemblers, names<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Produces a single formatted table comparing multiple regression models.</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">    For each predictor (the union across models, ordered by first appearance), the table shows</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">    the beta estimate (with significance stars) from each model (blank if not used).</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">    For a predictor, if a model's outcome (model.getLabelCol()) starts with "log", the cell displays</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">    both the beta and its exponential (separated by " / "), except when the predictor's name includes "log_".</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">    (The intercept row does not display exp(.))</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Additional rows for Intercept, Observations, R², and RMSE are appended.</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">    The header's first column is labeled "Predictor", and subsequent columns are</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">    "y: [outcome] ([name])" for each model.</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co">    The table is produced in grid format (with vertical lines). A dashed line (using '-' characters)</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co">    is inserted at the top, immediately after the header, and at the bottom.</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co">    Additionally, immediately after the Intercept row, the border line is replaced with one using '='</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co">    (to appear as, for example, "+==============================================+==========================+...").</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co">        models (list): List of fitted LinearRegression models.</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="co">        assemblers (list): List of corresponding VectorAssembler objects.</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co">        names (list, optional): List of model names; defaults to "Model 1", "Model 2", etc.</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co">        A formatted string containing the combined regression table.</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Default model names.</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> names <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>        names <span class="op">=</span> [<span class="ss">f"Model </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(models))]</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For each model, get outcome and determine if that model is log-transformed.</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    outcomes <span class="op">=</span> [m.getLabelCol() <span class="cf">for</span> m <span class="kw">in</span> models]</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    is_log_flags <span class="op">=</span> [out.lower().startswith(<span class="st">"log"</span>) <span class="cf">for</span> out <span class="kw">in</span> outcomes]</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build an ordered union of predictors based on first appearance.</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    ordered_predictors <span class="op">=</span> []</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> assembler <span class="kw">in</span> assemblers:</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> feat <span class="kw">in</span> assembler.getInputCols():</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> feat <span class="kw">not</span> <span class="kw">in</span> ordered_predictors:</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>                ordered_predictors.append(feat)</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Helper for significance stars.</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> significance_stars(p):</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> p <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">""</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> p <span class="op">&lt;</span> <span class="fl">0.01</span>:</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"***"</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> p <span class="op">&lt;</span> <span class="fl">0.05</span>:</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"**"</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> p <span class="op">&lt;</span> <span class="fl">0.1</span>:</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"*"</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">""</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build rows for each predictor.</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>    rows <span class="op">=</span> []</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> feat <span class="kw">in</span> ordered_predictors:</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>        row <span class="op">=</span> [feat]</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> m, a, is_log <span class="kw">in</span> <span class="bu">zip</span>(models, assemblers, is_log_flags):</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>            feats_model <span class="op">=</span> a.getInputCols()</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> feat <span class="kw">in</span> feats_model:</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>                idx <span class="op">=</span> feats_model.index(feat)</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>                beta <span class="op">=</span> m.coefficients.toArray()[idx]</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>                p_val <span class="op">=</span> m.summary.pValues[idx] <span class="cf">if</span> m.summary.pValues <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>                stars <span class="op">=</span> significance_stars(p_val)</span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>                cell <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>beta<span class="sc">:.3f}{</span>stars<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Only add exp(beta) if model is log and predictor name does NOT include "log_"</span></span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> is_log <span class="kw">and</span> (<span class="st">"log_"</span> <span class="kw">not</span> <span class="kw">in</span> feat.lower()):</span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>                    cell <span class="op">+=</span> <span class="ss">f" / </span><span class="sc">{</span>np<span class="sc">.</span>exp(beta)<span class="sc">:,</span><span class="fl">.3</span><span class="er">f</span><span class="sc">}</span><span class="ss">"</span></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>                row.append(cell)</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>                row.append(<span class="st">""</span>)</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>        rows.append(row)</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build intercept row (do NOT compute exp(intercept)).</span></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>    intercept_row <span class="op">=</span> [<span class="st">"Intercept"</span>]</span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> m <span class="kw">in</span> models:</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>        std_all <span class="op">=</span> np.array(m.summary.coefficientStandardErrors)</span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>        coeffs <span class="op">=</span> m.coefficients.toArray()</span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(std_all) <span class="op">==</span> <span class="bu">len</span>(coeffs) <span class="op">+</span> <span class="dv">1</span>:</span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>            intercept_p <span class="op">=</span> m.summary.pValues[<span class="dv">0</span>] <span class="cf">if</span> m.summary.pValues <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>            intercept_p <span class="op">=</span> <span class="va">None</span></span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>        sig <span class="op">=</span> significance_stars(intercept_p)</span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>        cell <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>m<span class="sc">.</span>intercept<span class="sc">:.3f}{</span>sig<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>        intercept_row.append(cell)</span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>    rows.append(intercept_row)</span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add Observations row.</span></span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>    obs_row <span class="op">=</span> [<span class="st">"Observations"</span>]</span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> m <span class="kw">in</span> models:</span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>        obs <span class="op">=</span> m.summary.numInstances</span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>        obs_row.append(<span class="ss">f"</span><span class="sc">{</span><span class="bu">int</span>(obs)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>    rows.append(obs_row)</span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add R² row.</span></span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>    r2_row <span class="op">=</span> [<span class="st">"R²"</span>]</span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> m <span class="kw">in</span> models:</span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>        r2_row.append(<span class="ss">f"</span><span class="sc">{</span>m<span class="sc">.</span>summary<span class="sc">.</span>r2<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a>    rows.append(r2_row)</span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add RMSE row.</span></span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>    rmse_row <span class="op">=</span> [<span class="st">"RMSE"</span>]</span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> m <span class="kw">in</span> models:</span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>        rmse_row.append(<span class="ss">f"</span><span class="sc">{</span>m<span class="sc">.</span>summary<span class="sc">.</span>rootMeanSquaredError<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a>    rows.append(rmse_row)</span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build header: first column "Predictor", then for each model: "y: [outcome] ([name])"</span></span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a>    header <span class="op">=</span> [<span class="st">"Predictor"</span>]</span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> out, name <span class="kw">in</span> <span class="bu">zip</span>(outcomes, names):</span>
<span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a>        header.append(<span class="ss">f"y: </span><span class="sc">{</span>out<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb5-114"><a href="#cb5-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-115"><a href="#cb5-115" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create table string using grid format.</span></span>
<span id="cb5-116"><a href="#cb5-116" aria-hidden="true" tabindex="-1"></a>    table_str <span class="op">=</span> tabulate(rows, headers<span class="op">=</span>header, tablefmt<span class="op">=</span><span class="st">"grid"</span>, colalign<span class="op">=</span>(<span class="st">"left"</span>,) <span class="op">+</span> (<span class="st">"right"</span>,)<span class="op">*</span><span class="bu">len</span>(models))</span>
<span id="cb5-117"><a href="#cb5-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-118"><a href="#cb5-118" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Split into lines.</span></span>
<span id="cb5-119"><a href="#cb5-119" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> table_str.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb5-120"><a href="#cb5-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-121"><a href="#cb5-121" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a dashed line spanning the full width.</span></span>
<span id="cb5-122"><a href="#cb5-122" aria-hidden="true" tabindex="-1"></a>    full_width <span class="op">=</span> <span class="bu">len</span>(lines[<span class="dv">0</span>])</span>
<span id="cb5-123"><a href="#cb5-123" aria-hidden="true" tabindex="-1"></a>    dash_line <span class="op">=</span> <span class="st">'-'</span> <span class="op">*</span> full_width</span>
<span id="cb5-124"><a href="#cb5-124" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create an equals line by replacing '-' with '='.</span></span>
<span id="cb5-125"><a href="#cb5-125" aria-hidden="true" tabindex="-1"></a>    eq_line <span class="op">=</span> dash_line.replace(<span class="st">'-'</span>, <span class="st">'='</span>)</span>
<span id="cb5-126"><a href="#cb5-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-127"><a href="#cb5-127" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Insert a dashed line after the header row.</span></span>
<span id="cb5-128"><a href="#cb5-128" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> table_str.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb5-129"><a href="#cb5-129" aria-hidden="true" tabindex="-1"></a>    <span class="co"># In grid format, header and separator are usually the first two lines.</span></span>
<span id="cb5-130"><a href="#cb5-130" aria-hidden="true" tabindex="-1"></a>    lines.insert(<span class="dv">2</span>, dash_line)</span>
<span id="cb5-131"><a href="#cb5-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-132"><a href="#cb5-132" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Insert an equals line after the Intercept row.</span></span>
<span id="cb5-133"><a href="#cb5-133" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, line <span class="kw">in</span> <span class="bu">enumerate</span>(lines):</span>
<span id="cb5-134"><a href="#cb5-134" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> line.startswith(<span class="st">"|"</span>) <span class="kw">and</span> <span class="st">"Intercept"</span> <span class="kw">in</span> line:</span>
<span id="cb5-135"><a href="#cb5-135" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i<span class="op">+</span><span class="dv">1</span> <span class="op">&lt;</span> <span class="bu">len</span>(lines):</span>
<span id="cb5-136"><a href="#cb5-136" aria-hidden="true" tabindex="-1"></a>                lines[i<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> eq_line</span>
<span id="cb5-137"><a href="#cb5-137" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb5-138"><a href="#cb5-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-139"><a href="#cb5-139" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add dashed lines at the very top and bottom.</span></span>
<span id="cb5-140"><a href="#cb5-140" aria-hidden="true" tabindex="-1"></a>    final_table <span class="op">=</span> dash_line <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(lines) <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> dash_line</span>
<span id="cb5-141"><a href="#cb5-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-142"><a href="#cb5-142" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> final_table</span>
<span id="cb5-143"><a href="#cb5-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-144"><a href="#cb5-144" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage:</span></span>
<span id="cb5-145"><a href="#cb5-145" aria-hidden="true" tabindex="-1"></a><span class="co"># print(compare_reg_models([model_1, model_2, model_3],</span></span>
<span id="cb5-146"><a href="#cb5-146" aria-hidden="true" tabindex="-1"></a><span class="co">#                          [assembler_1, assembler_2, assembler_3],</span></span>
<span id="cb5-147"><a href="#cb5-147" aria-hidden="true" tabindex="-1"></a><span class="co">#                          ["Model 1", "Model 2", "Model 3"]))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="compare_rmse" class="level3">
<h3 class="anchored" data-anchor-id="compare_rmse">compare_rmse</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compare_rmse(test_dfs, label_col, pred_col<span class="op">=</span><span class="st">"prediction"</span>, names<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Computes and compares RMSE values for a list of test DataFrames.</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">    For each DataFrame in test_dfs, this function calculates the RMSE between the actual outcome</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">    (given by label_col) and the predicted value (given by pred_col, default "prediction"). It then</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">    produces a formatted table where the first column header is empty and the first row's first cell is</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">    "RMSE", with each model's RMSE in its own column.</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">        test_dfs (list): List of test DataFrames.</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">        label_col (str): The name of the outcome column.</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">        pred_col (str, optional): The name of the prediction column (default "prediction").</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">        names (list, optional): List of model names corresponding to the test DataFrames.</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">                                Defaults to "Model 1", "Model 2", etc.</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">        A formatted string containing a table that compares RMSE values for each test DataFrame,</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co">        with one model per column.</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set default model names if none provided.</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> names <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>        names <span class="op">=</span> [<span class="ss">f"Model </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(test_dfs))]</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    rmse_values <span class="op">=</span> []</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> df <span class="kw">in</span> test_dfs:</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create a column for squared error.</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df.withColumn(<span class="st">"error_sq"</span>, <span class="bu">pow</span>(col(label_col) <span class="op">-</span> col(pred_col), <span class="dv">2</span>))</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate RMSE: square root of the mean squared error.</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>        rmse <span class="op">=</span> df.agg(sqrt(avg(<span class="st">"error_sq"</span>)).alias(<span class="st">"rmse"</span>)).collect()[<span class="dv">0</span>][<span class="st">"rmse"</span>]</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>        rmse_values.append(rmse)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build a single row table: first cell "RMSE", then one cell per model with the RMSE value.</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    row <span class="op">=</span> [<span class="st">"RMSE"</span>] <span class="op">+</span> [<span class="ss">f"</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">"</span> <span class="cf">for</span> rmse <span class="kw">in</span> rmse_values]</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build header: first column header is empty, then model names.</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    header <span class="op">=</span> [<span class="st">""</span>] <span class="op">+</span> names</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>    table_str <span class="op">=</span> tabulate([row], headers<span class="op">=</span>header, tablefmt<span class="op">=</span><span class="st">"grid"</span>, colalign<span class="op">=</span>(<span class="st">"left"</span>,) <span class="op">+</span> (<span class="st">"right"</span>,)<span class="op">*</span><span class="bu">len</span>(names))</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> table_str</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage:</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="co"># print(compare_rmse([dtest_1, dtest_2, dtest_3], "log_sales", names=["Model 1", "Model 2", "Model 3"]))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="residual_plot" class="level3">
<h3 class="anchored" data-anchor-id="residual_plot">residual_plot</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> residual_plot(df, label_col, model_name):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Generates a residual plot for a given test dataframe.</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">        df (DataFrame): Spark DataFrame containing the test set with predictions.</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">        label_col (str): The column name of the actual outcome variable.</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">        title (str): The title for the residual plot.</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">        None (displays the plot)</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to Pandas DataFrame</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    df_pd <span class="op">=</span> df.select([<span class="st">"prediction"</span>, label_col]).toPandas()</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    df_pd[<span class="st">"residual"</span>] <span class="op">=</span> df_pd[label_col] <span class="op">-</span> df_pd[<span class="st">"prediction"</span>]</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Scatter plot of residuals vs. predicted values</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    plt.scatter(df_pd[<span class="st">"prediction"</span>], df_pd[<span class="st">"residual"</span>], alpha<span class="op">=</span><span class="fl">0.2</span>, color<span class="op">=</span><span class="st">"darkgray"</span>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use LOWESS smoothing for trend line</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    smoothed <span class="op">=</span> sm.nonparametric.lowess(df_pd[<span class="st">"residual"</span>], df_pd[<span class="st">"prediction"</span>])</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    plt.plot(smoothed[:, <span class="dv">0</span>], smoothed[:, <span class="dv">1</span>], color<span class="op">=</span><span class="st">"darkblue"</span>)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add reference line at y=0</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Labels and title (model_name)</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Predicted Values"</span>)</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Residuals"</span>)</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    model_name <span class="op">=</span> <span class="st">"Residual Plot for "</span> <span class="op">+</span> model_name</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    plt.title(model_name)</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show plot</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage:</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="co"># residual_plot(dtest_1, "log_sales", "Model 1")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>
<section id="data-preparation" class="level1">
<h1>Data Preparation</h1>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>beer <span class="op">=</span> pd.read_csv(<span class="st">'https://bcdanl.github.io/data/beer_markets_all_cleaned.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="log-transformation" class="level2">
<h2 class="anchored" data-anchor-id="log-transformation">Log Transformation</h2>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> spark.createDataFrame(beer)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> (</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    .withColumn(<span class="st">"log_beer_floz"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                log(df[<span class="st">'beer_floz'</span>]) )</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    .withColumn(<span class="st">"log_price_floz"</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>                log(df[<span class="st">'price_floz'</span>]) )</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="question-1---filter" class="level2">
<h2 class="anchored" data-anchor-id="question-1---filter">Question 1 - Filter</h2>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.<span class="bu">filter</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    (col(<span class="st">"container"</span>) <span class="op">==</span> <span class="st">"CAN"</span>) <span class="op">|</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    (col(<span class="st">"container"</span>) <span class="op">==</span> <span class="st">"NON_REFILLABLE_BOTTLE"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="question-2---training-test-split" class="level2">
<h2 class="anchored" data-anchor-id="question-2---training-test-split">Question 2 - Training-Test Split</h2>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>dtrain, dtest <span class="op">=</span> df.randomSplit([<span class="fl">0.67</span>, <span class="fl">0.33</span>], seed <span class="op">=</span> <span class="dv">1234</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-outputid="40055738-f896-4274-92d9-9c484ddf24b8" data-execution_count="13">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    .groupBy(<span class="st">"market"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    .count()</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    .orderBy(<span class="st">"market"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    .show(n <span class="op">=</span> df.select(<span class="st">"market"</span>).distinct().count())</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+-----+
|              market|count|
+--------------------+-----+
|              ALBANY|  487|
|             ATLANTA| 1279|
|           BALTIMORE|  374|
|          BIRMINGHAM| 1137|
|              BOSTON|  872|
|   BUFFALO-ROCHESTER|  607|
|           CHARLOTTE| 1246|
|             CHICAGO| 1879|
|          CINCINNATI| 1270|
|           CLEVELAND| 1226|
|            COLUMBUS| 1862|
|              DALLAS| 2098|
|              DENVER|  796|
|          DES_MOINES|  716|
|             DETROIT| 1731|
|          EXURBAN_NJ|  223|
|          EXURBAN_NY|   98|
|        GRAND_RAPIDS|  739|
|  HARTFORD-NEW_HAVEN|  370|
|             HOUSTON| 1673|
|        INDIANAPOLIS| 1213|
|        JACKSONVILLE|  501|
|         KANSAS_CITY|  663|
|         LITTLE_ROCK|  452|
|         LOS_ANGELES| 1564|
|          LOUISVILLE|  833|
|             MEMPHIS|  530|
|               MIAMI| 2616|
|           MILWAUKEE|  728|
|         MINNEAPOLIS|  801|
|           NASHVILLE|  989|
|  NEW_ORLEANS-MOBILE|  852|
| OKLAHOMA_CITY-TULSA|  800|
|               OMAHA| 1017|
|             ORLANDO| 1135|
|        PHILADELPHIA|  433|
|             PHOENIX| 2263|
|          PITTSBURGH|  352|
|            PORTLAND|  552|
|      RALEIGH-DURHAM| 1126|
|            RICHMOND| 1063|
|       RURAL_ALABAMA|  305|
|      RURAL_ARKANSAS|  160|
|    RURAL_CALIFORNIA|  848|
|      RURAL_COLORADO|   21|
|       RURAL_FLORIDA|  522|
|       RURAL_GEORGIA|  460|
|         RURAL_IDAHO|  154|
|      RURAL_ILLINOIS| 1195|
|       RURAL_INDIANA|  481|
|          RURAL_IOWA| 1060|
|        RURAL_KANSAS|  179|
|      RURAL_KENTUCKY|  225|
|     RURAL_LOUISIANA|  381|
|         RURAL_MAINE|  353|
|      RURAL_MICHIGAN|  754|
|     RURAL_MINNESOTA|  138|
|   RURAL_MISSISSIPPI|  354|
|      RURAL_MISSOURI|  640|
|       RURAL_MONTANA|  354|
|      RURAL_NEBRASKA|  110|
|        RURAL_NEVADA|  557|
| RURAL_NEW_HAMPSHIRE|   25|
|    RURAL_NEW_MEXICO|  427|
|      RURAL_NEW_YORK|   13|
|RURAL_NORTH_CAROLINA|  909|
|  RURAL_NORTH_DAKOTA|  129|
|          RURAL_OHIO|  257|
|      RURAL_OKLAHOMA|   54|
|        RURAL_OREGON|   38|
|  RURAL_PENNSYLVANIA|  298|
|RURAL_SOUTH_CAROLINA| 1295|
|  RURAL_SOUTH_DAKOTA|  153|
|     RURAL_TENNESSEE|  423|
|         RURAL_TEXAS| 1771|
|       RURAL_VERMONT|  139|
|      RURAL_VIRGINIA|  185|
|    RURAL_WASHINGTON|  330|
| RURAL_WEST_VIRGINIA|  265|
|     RURAL_WISCONSIN| 1306|
|       RURAL_WYOMING|   39|
|          SACRAMENTO|  981|
|      SALT_LAKE_CITY|  320|
|         SAN_ANTONIO| 2615|
|           SAN_DIEGO|  656|
|       SAN_FRANCISCO|  871|
|             SEATTLE|  903|
|            ST_LOUIS| 1347|
|        SURBURBAN_NJ|  399|
|        SURBURBAN_NY|  473|
|            SYRACUSE|  294|
|               TAMPA| 3180|
|            URBAN_NY|  735|
|       WASHINGTON_DC|  863|
+--------------------+-----+
</code></pre>
</div>
</div>
<div class="cell" data-outputid="314a6a4a-9d6e-4c8e-c2f6-74f38d986509" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    .groupBy(<span class="st">"brand"</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    .count()</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    .orderBy(<span class="st">"brand"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    .show(n <span class="op">=</span> df.select(<span class="st">"brand"</span>).distinct().count())</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+-------------+-----+
|        brand|count|
+-------------+-----+
|    BUD_LIGHT|21170|
|  BUSCH_LIGHT| 8671|
|  COORS_LIGHT|12865|
|  MILLER_LITE|16788|
|NATURAL_LIGHT|12616|
+-------------+-----+
</code></pre>
</div>
</div>
<div class="cell" data-outputid="c6737ca6-1b83-4f07-c985-e884a5b9e228" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    .groupBy(<span class="st">"container"</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    .count()</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    .orderBy(<span class="st">"container"</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    .show(n <span class="op">=</span> df.select(<span class="st">"container"</span>).distinct().count(), truncate<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---------------------+-----+
|container            |count|
+---------------------+-----+
|CAN                  |53015|
|NON_REFILLABLE_BOTTLE|19095|
+---------------------+-----+
</code></pre>
</div>
</div>
<div class="cell" data-outputid="4fc44395-3b09-4167-e924-d7b192db2462" data-execution_count="16">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    .groupBy(<span class="st">"promo"</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    .count()</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    .orderBy(<span class="st">"promo"</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    .show(n <span class="op">=</span> df.select(<span class="st">"promo"</span>).distinct().count())</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+-----+-----+
|promo|count|
+-----+-----+
|false|57621|
| true|14489|
+-----+-----+
</code></pre>
</div>
</div>
</section>
<section id="adding-dummies" class="level2">
<h2 class="anchored" data-anchor-id="adding-dummies">Adding Dummies</h2>
<div class="cell" data-outputid="a389be23-d065-4512-edcc-f6026c3e3ca3" data-execution_count="17">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>dummy_cols_market, ref_category_market <span class="op">=</span> add_dummy_variables(<span class="st">'market'</span>, <span class="dv">5</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>dummy_cols_brand, ref_category_brand <span class="op">=</span> add_dummy_variables(<span class="st">'brand'</span>, <span class="dv">0</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>dummy_cols_container, ref_category_container <span class="op">=</span> add_dummy_variables(<span class="st">'container'</span>, <span class="dv">1</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>dummy_cols_promo, ref_category_promo <span class="op">=</span> add_dummy_variables(<span class="st">'promo'</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reference category (dummy omitted): BUFFALO-ROCHESTER
Reference category (dummy omitted): BUD_LIGHT
Reference category (dummy omitted): NON_REFILLABLE_BOTTLE
Reference category (dummy omitted): False</code></pre>
</div>
</div>
</section>
<section id="adding-interaction-terms" class="level2">
<h2 class="anchored" data-anchor-id="adding-interaction-terms">Adding Interaction Terms</h2>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>interaction_cols_brand_quantity <span class="op">=</span> add_interaction_terms(dummy_cols_brand, [<span class="st">'log_beer_floz'</span>])</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>interaction_cols_brand_promo_quantity <span class="op">=</span> add_interaction_terms(dummy_cols_brand, dummy_cols_promo, [<span class="st">'log_beer_floz'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="question-3---intuition-behind-each-model" class="level1">
<h1>Question 3 - Intuition behind Each Model</h1>
<ul>
<li><p><strong>Model 1</strong> $$ \begin{aligned} () = &amp;&nbsp;<em>{0} + </em>{i=1}^{N} <em>{i} ,</em>{i} + <em>{j=N+1}^{N+4} </em>{j} ,_{j}</p></li>
<li><p><em>{N+5} , \ &amp;,+, </em>{N+6} () + \end{aligned} $$</p></li>
<li><p><strong>One-Size-Fits-All Elasticity</strong></p>
<ul>
<li>Assumes that every beer—whether Budweiser or value-priced Natural—shares an identical inverse price elasticity.</li>
<li>The entire beer is treated as a homogeneous commodity. A 10 % increase in price invariably yields, for example, a 5 % reduction in sales, regardless of brand identity or promotional activity.</li>
<li>While straightforward to estimate, this specification overlooks differences in pricing power across brands, positioning, and promotional responsiveness, leading to underpricing of premium favorites (e.g., Bud, Coors, Miller) and overpricing of bargain brands (e.g., Busch, Natural).</li>
</ul></li>
<li><p><strong>Model 2</strong> <span class="math display">\[
\begin{aligned}
\log(\text{price_per_floz}) \,=\, &amp; \beta_{0} \,+\, \sum_{i=1}^{N}\beta_{i}\,\text{market}_{i} \,+\, \sum_{j=N+1}^{N+4}\beta_{j}\,\text{brand}_{j} \,+\, \beta_{N+5}\,\text{container_CAN} \\
&amp;\,+\, \beta_{N+6}\log(\text{beer_floz})\\
&amp;\,+\, \sum_{j=N+1}^{N+4}\beta_{j\times\text{beer_floz}}\,\text{brand}_{j}\times \log(\text{beer_floz})\\
&amp;\,+\, \epsilon
\end{aligned}
\]</span></p></li>
<li><p>Brand-Specific Elasticity (No Promotional Effect)</p>
<ul>
<li>Allows Bud, Coors, Miller, Busch, and Natural each to exhibit its own inverse price elasticity, yet treats promotion and no-promotion identically.</li>
<li>The model imposes a constant sensitivity irrespective of whether the price is part of a “Happy Hour” or standard offering.
<ul>
<li>This approach captures variation in the degres of sensitiveness across brands, but it fails to account for the additional demand shifts induced by promotions.</li>
</ul></li>
</ul></li>
<li><p><strong>Model 3</strong> <span class="math display">\[
\begin{aligned}
\log(\text{price_per_floz}) \,=\, &amp; \beta_{0} \,+\, \sum_{i=1}^{N}\beta_{i}\,\text{market}_{i} \,+\, \sum_{j=N+1}^{N+4}\beta_{j}\,\text{brand}_{j} \,+\, \beta_{N+5}\,\text{container_CAN} \\
&amp;\,+\, \beta_{N+6}\log(\text{beer_floz})\\
&amp;\,+\, \beta_{N+7}\,\text{promo} \times\log(\text{beer_floz}) \\
&amp;\,+\, \sum_{j=N+1}^{N+4}\beta_{j\times\text{beer_floz}}\,\text{brand}_{j}\times \log(\text{beer_floz})\\
&amp;\,+\, \sum_{j=N+1}^{N+4}\beta_{j\times\text{promo}}\,\text{brand}_{j}\times \text{promo}\\
&amp;\,+\, \sum_{j=N+1}^{N+4}\beta_{j\times\text{promo}\times\text{beer_floz}}\,\text{brand}_{j}\times \text{promo}\times \log(\text{beer_floz})\\
&amp;\,+\, \epsilon
\end{aligned}
\]</span></p></li>
<li><p>Brand * Promotion-Specific Elasticity</p>
<ul>
<li>Estimates a distinct inverse elasticity for each brand and for each brand’s promotional status (discounted vs.&nbsp;full price).
<ul>
<li>When Natural Light is on special, its demand becomes markedly more elastic—deal-seeking consumers flood in—whereas Bud devotees remain relatively insensitive to a buy-one-get-one offer. Each brand’s “promotion effect” is modeled uniquely.</li>
<li>This specification offers the greatest flexibility, supporting a dynamic pricing and promotional calendar that maximizes profitability by aligning strategies with each brand’s specific consumer responsiveness.</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="model-1" class="level1">
<h1>Model 1</h1>
<div class="cell" data-outputid="43370bba-c9bc-4b7d-9f73-b1fb6025b5f5" data-execution_count="19">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># assembling predictors</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>conti_cols <span class="op">=</span> [<span class="st">"log_beer_floz"</span>]</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>assembler_predictors <span class="op">=</span> (</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    conti_cols <span class="op">+</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    dummy_cols_market <span class="op">+</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    dummy_cols_brand <span class="op">+</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    dummy_cols_container</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>assembler_1 <span class="op">=</span> VectorAssembler(</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    inputCols <span class="op">=</span> assembler_predictors,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    outputCol <span class="op">=</span> <span class="st">"predictors"</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>dtrain_1 <span class="op">=</span> assembler_1.transform(dtrain)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>dtest_1  <span class="op">=</span> assembler_1.transform(dtest)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="co"># training model</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>model_1 <span class="op">=</span> (</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    LinearRegression(featuresCol<span class="op">=</span><span class="st">"predictors"</span>,</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>                     labelCol<span class="op">=</span><span class="st">"log_price_floz"</span>)</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    .fit(dtrain_1)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="co"># making prediction - Question 4</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>dtest_1 <span class="op">=</span> model_1.transform(dtest_1)</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a><span class="co"># makting regression table</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( regression_table(model_1, assembler_1) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+-----------------------------+--------+-----------+------+------------+---------+--------------+--------------+-------------------+-------------------+
| y: log_price_floz           |   Beta | Exp(Beta) | Sig. | Std. Error | p-value | 95% CI Lower | 95% CI Upper | Exp(95% CI Lower) | Exp(95% CI Upper) |
+-----------------------------+--------+-----------+------+------------+---------+--------------+--------------+-------------------+-------------------+
| log_beer_floz               | -0.142 |           | ***  |      0.013 |   0.000 |       -0.166 |       -0.117 |                   |                   |
| market_ALBANY               |  0.027 |     1.027 |  **  |      0.010 |   0.034 |        0.007 |        0.047 |             1.007 |             1.048 |
| market_ATLANTA              |  0.083 |     1.087 | ***  |      0.014 |   0.000 |        0.057 |        0.110 |             1.058 |             1.117 |
| market_BALTIMORE            |  0.100 |     1.105 | ***  |      0.011 |   0.000 |        0.079 |        0.121 |             1.083 |             1.128 |
| market_BIRMINGHAM           |  0.124 |     1.132 | ***  |      0.011 |   0.000 |        0.102 |        0.145 |             1.107 |             1.156 |
| market_BOSTON               |  0.127 |     1.136 | ***  |      0.010 |   0.000 |        0.107 |        0.147 |             1.113 |             1.159 |
| market_CHARLOTTE            |  0.020 |     1.020 |  *   |      0.010 |   0.058 |        0.000 |        0.039 |             1.000 |             1.039 |
| market_CHICAGO              | -0.008 |     0.992 |      |      0.010 |   0.411 |       -0.028 |        0.012 |             0.972 |             1.012 |
| market_CINCINNATI           |  0.084 |     1.088 | ***  |      0.010 |   0.000 |        0.064 |        0.104 |             1.066 |             1.110 |
| market_CLEVELAND            |  0.050 |     1.051 | ***  |      0.010 |   0.000 |        0.031 |        0.069 |             1.031 |             1.071 |
| market_COLUMBUS             |  0.069 |     1.072 | ***  |      0.010 |   0.000 |        0.050 |        0.088 |             1.051 |             1.092 |
| market_DALLAS               |  0.203 |     1.226 | ***  |      0.011 |   0.000 |        0.181 |        0.225 |             1.199 |             1.253 |
| market_DENVER               |  0.123 |     1.131 | ***  |      0.012 |   0.000 |        0.101 |        0.146 |             1.106 |             1.157 |
| market_DES_MOINES           |  0.129 |     1.138 | ***  |      0.010 |   0.000 |        0.110 |        0.148 |             1.116 |             1.160 |
| market_DETROIT              |  0.087 |     1.091 | ***  |      0.016 |   0.000 |        0.055 |        0.119 |             1.057 |             1.126 |
| market_EXURBAN_NJ           |  0.221 |     1.247 | ***  |      0.023 |   0.000 |        0.176 |        0.266 |             1.192 |             1.305 |
| market_EXURBAN_NY           |  0.122 |     1.130 | ***  |      0.011 |   0.000 |        0.100 |        0.144 |             1.105 |             1.155 |
| market_GRAND_RAPIDS         |  0.082 |     1.086 | ***  |      0.014 |   0.000 |        0.055 |        0.109 |             1.056 |             1.115 |
| market_HARTFORD-NEW_HAVEN   |  0.148 |     1.160 | ***  |      0.010 |   0.000 |        0.129 |        0.167 |             1.137 |             1.182 |
| market_HOUSTON              |  0.113 |     1.120 | ***  |      0.010 |   0.000 |        0.093 |        0.133 |             1.097 |             1.143 |
| market_INDIANAPOLIS         |  0.042 |     1.043 | ***  |      0.013 |   0.000 |        0.018 |        0.067 |             1.018 |             1.069 |
| market_JACKSONVILLE         |  0.113 |     1.120 | ***  |      0.012 |   0.000 |        0.090 |        0.136 |             1.094 |             1.146 |
| market_KANSAS_CITY          |  0.076 |     1.079 | ***  |      0.013 |   0.000 |        0.050 |        0.101 |             1.052 |             1.106 |
| market_LITTLE_ROCK          |  0.092 |     1.096 | ***  |      0.010 |   0.000 |        0.072 |        0.112 |             1.075 |             1.118 |
| market_LOS_ANGELES          |  0.032 |     1.033 | ***  |      0.011 |   0.001 |        0.010 |        0.054 |             1.010 |             1.055 |
| market_LOUISVILLE           |  0.068 |     1.070 | ***  |      0.012 |   0.000 |        0.044 |        0.092 |             1.045 |             1.097 |
| market_MEMPHIS              |  0.128 |     1.137 | ***  |      0.009 |   0.000 |        0.110 |        0.147 |             1.116 |             1.158 |
| market_MIAMI                |  0.108 |     1.114 | ***  |      0.011 |   0.000 |        0.085 |        0.130 |             1.089 |             1.139 |
| market_MILWAUKEE            |  0.028 |     1.028 |  **  |      0.011 |   0.015 |        0.006 |        0.050 |             1.006 |             1.051 |
| market_MINNEAPOLIS          |  0.128 |     1.137 | ***  |      0.011 |   0.000 |        0.107 |        0.149 |             1.113 |             1.161 |
| market_NASHVILLE            |  0.143 |     1.153 | ***  |      0.011 |   0.000 |        0.121 |        0.164 |             1.129 |             1.179 |
| market_NEW_ORLEANS-MOBILE   |  0.128 |     1.136 | ***  |      0.011 |   0.000 |        0.106 |        0.150 |             1.112 |             1.162 |
| market_OKLAHOMA_CITY-TULSA  |  0.145 |     1.156 | ***  |      0.011 |   0.000 |        0.124 |        0.166 |             1.132 |             1.181 |
| market_OMAHA                |  0.131 |     1.140 | ***  |      0.011 |   0.000 |        0.110 |        0.151 |             1.116 |             1.164 |
| market_ORLANDO              |  0.098 |     1.103 | ***  |      0.013 |   0.000 |        0.073 |        0.124 |             1.075 |             1.132 |
| market_PHILADELPHIA         |  0.115 |     1.121 | ***  |      0.010 |   0.000 |        0.096 |        0.133 |             1.100 |             1.143 |
| market_PHOENIX              |  0.142 |     1.152 | ***  |      0.014 |   0.000 |        0.115 |        0.169 |             1.121 |             1.184 |
| market_PITTSBURGH           |  0.100 |     1.105 | ***  |      0.012 |   0.000 |        0.076 |        0.124 |             1.079 |             1.132 |
| market_PORTLAND             |  0.115 |     1.122 | ***  |      0.011 |   0.000 |        0.095 |        0.136 |             1.099 |             1.145 |
| market_RALEIGH-DURHAM       |  0.090 |     1.094 | ***  |      0.011 |   0.000 |        0.069 |        0.111 |             1.071 |             1.117 |
| market_RICHMOND             |  0.043 |     1.044 | ***  |      0.015 |   0.000 |        0.015 |        0.072 |             1.015 |             1.075 |
| market_RURAL_ALABAMA        |  0.157 |     1.170 | ***  |      0.020 |   0.000 |        0.118 |        0.195 |             1.126 |             1.215 |
| market_RURAL_ARKANSAS       |  0.157 |     1.171 | ***  |      0.011 |   0.000 |        0.136 |        0.179 |             1.145 |             1.196 |
| market_RURAL_CALIFORNIA     |  0.044 |     1.045 | ***  |      0.046 |   0.000 |       -0.047 |        0.135 |             0.955 |             1.144 |
| market_RURAL_COLORADO       |  0.137 |     1.147 | ***  |      0.013 |   0.003 |        0.113 |        0.162 |             1.119 |             1.176 |
| market_RURAL_FLORIDA        |  0.059 |     1.061 | ***  |      0.013 |   0.000 |        0.034 |        0.085 |             1.034 |             1.089 |
| market_RURAL_GEORGIA        |  0.132 |     1.141 | ***  |      0.019 |   0.000 |        0.095 |        0.169 |             1.099 |             1.184 |
| market_RURAL_IDAHO          |  0.142 |     1.152 | ***  |      0.010 |   0.000 |        0.121 |        0.162 |             1.129 |             1.176 |
| market_RURAL_ILLINOIS       |  0.014 |     1.014 |      |      0.013 |   0.176 |       -0.011 |        0.039 |             0.989 |             1.040 |
| market_RURAL_INDIANA        |  0.073 |     1.076 | ***  |      0.011 |   0.000 |        0.052 |        0.094 |             1.053 |             1.098 |
| market_RURAL_IOWA           |  0.058 |     1.060 | ***  |      0.018 |   0.000 |        0.023 |        0.094 |             1.023 |             1.098 |
| market_RURAL_KANSAS         |  0.134 |     1.143 | ***  |      0.016 |   0.000 |        0.102 |        0.166 |             1.108 |             1.180 |
| market_RURAL_KENTUCKY       |  0.157 |     1.170 | ***  |      0.014 |   0.000 |        0.130 |        0.184 |             1.139 |             1.202 |
| market_RURAL_LOUISIANA      |  0.060 |     1.061 | ***  |      0.014 |   0.000 |        0.032 |        0.087 |             1.033 |             1.091 |
| market_RURAL_MAINE          |  0.091 |     1.096 | ***  |      0.011 |   0.000 |        0.069 |        0.114 |             1.071 |             1.120 |
| market_RURAL_MICHIGAN       |  0.085 |     1.089 | ***  |      0.020 |   0.000 |        0.046 |        0.124 |             1.047 |             1.132 |
| market_RURAL_MINNESOTA      |  0.165 |     1.180 | ***  |      0.014 |   0.000 |        0.138 |        0.193 |             1.148 |             1.213 |
| market_RURAL_MISSISSIPPI    |  0.043 |     1.044 | ***  |      0.012 |   0.002 |        0.020 |        0.066 |             1.020 |             1.069 |
| market_RURAL_MISSOURI       |  0.106 |     1.112 | ***  |      0.014 |   0.000 |        0.078 |        0.134 |             1.081 |             1.143 |
| market_RURAL_MONTANA        |  0.127 |     1.135 | ***  |      0.021 |   0.000 |        0.085 |        0.169 |             1.089 |             1.184 |
| market_RURAL_NEBRASKA       |  0.138 |     1.148 | ***  |      0.012 |   0.000 |        0.114 |        0.162 |             1.121 |             1.176 |
| market_RURAL_NEVADA         |  0.051 |     1.052 | ***  |      0.045 |   0.000 |       -0.037 |        0.139 |             0.964 |             1.149 |
| market_RURAL_NEW_HAMPSHIRE  |  0.028 |     1.028 |      |      0.013 |   0.532 |        0.002 |        0.054 |             1.002 |             1.055 |
| market_RURAL_NEW_MEXICO     |  0.154 |     1.166 | ***  |      0.061 |   0.000 |        0.035 |        0.273 |             1.036 |             1.314 |
| market_RURAL_NEW_YORK       | -0.013 |     0.987 |      |      0.011 |   0.832 |       -0.034 |        0.009 |             0.966 |             1.009 |
| market_RURAL_NORTH_CAROLINA | -0.002 |     0.998 |      |      0.020 |   0.823 |       -0.042 |        0.038 |             0.958 |             1.038 |
| market_RURAL_NORTH_DAKOTA   |  0.223 |     1.250 | ***  |      0.015 |   0.000 |        0.193 |        0.253 |             1.213 |             1.288 |
| market_RURAL_OHIO           |  0.096 |     1.100 | ***  |      0.031 |   0.000 |        0.034 |        0.157 |             1.035 |             1.170 |
| market_RURAL_OKLAHOMA       |  0.130 |     1.139 | ***  |      0.033 |   0.000 |        0.066 |        0.194 |             1.068 |             1.214 |
| market_RURAL_OREGON         |  0.074 |     1.077 |  **  |      0.015 |   0.024 |        0.045 |        0.103 |             1.046 |             1.108 |
| market_RURAL_PENNSYLVANIA   |  0.131 |     1.140 | ***  |      0.010 |   0.000 |        0.111 |        0.151 |             1.117 |             1.163 |
| market_RURAL_SOUTH_CAROLINA |  0.055 |     1.056 | ***  |      0.020 |   0.000 |        0.017 |        0.093 |             1.017 |             1.098 |
| market_RURAL_SOUTH_DAKOTA   |  0.077 |     1.081 | ***  |      0.013 |   0.000 |        0.052 |        0.103 |             1.053 |             1.109 |
| market_RURAL_TENNESSEE      |  0.170 |     1.186 | ***  |      0.010 |   0.000 |        0.151 |        0.190 |             1.163 |             1.209 |
| market_RURAL_TEXAS          |  0.169 |     1.184 | ***  |      0.020 |   0.000 |        0.130 |        0.207 |             1.139 |             1.230 |
| market_RURAL_VERMONT        |  0.077 |     1.080 | ***  |      0.017 |   0.000 |        0.043 |        0.111 |             1.044 |             1.118 |
| market_RURAL_VIRGINIA       |  0.018 |     1.019 |      |      0.014 |   0.289 |       -0.009 |        0.046 |             0.991 |             1.047 |
| market_RURAL_WASHINGTON     |  0.116 |     1.123 | ***  |      0.015 |   0.000 |        0.087 |        0.146 |             1.090 |             1.157 |
| market_RURAL_WEST_VIRGINIA  | -0.037 |     0.964 |  **  |      0.010 |   0.015 |       -0.057 |       -0.017 |             0.945 |             0.984 |
| market_RURAL_WISCONSIN      |  0.039 |     1.040 | ***  |      0.036 |   0.000 |       -0.031 |        0.109 |             0.970 |             1.115 |
| market_RURAL_WYOMING        |  0.147 |     1.158 | ***  |      0.011 |   0.000 |        0.126 |        0.168 |             1.134 |             1.183 |
| market_SACRAMENTO           |  0.020 |     1.020 |  *   |      0.014 |   0.064 |       -0.008 |        0.048 |             0.992 |             1.049 |
| market_SALT_LAKE_CITY       |  0.120 |     1.128 | ***  |      0.009 |   0.000 |        0.102 |        0.139 |             1.107 |             1.149 |
| market_SAN_ANTONIO          |  0.138 |     1.148 | ***  |      0.012 |   0.000 |        0.115 |        0.161 |             1.122 |             1.174 |
| market_SAN_DIEGO            |  0.012 |     1.012 |      |      0.011 |   0.321 |       -0.010 |        0.033 |             0.990 |             1.034 |
| market_SAN_FRANCISCO        |  0.069 |     1.071 | ***  |      0.011 |   0.000 |        0.047 |        0.090 |             1.048 |             1.094 |
| market_SEATTLE              |  0.109 |     1.116 | ***  |      0.010 |   0.000 |        0.089 |        0.129 |             1.093 |             1.138 |
| market_ST_LOUIS             |  0.042 |     1.042 | ***  |      0.013 |   0.000 |        0.015 |        0.068 |             1.015 |             1.070 |
| market_SURBURBAN_NJ         | -0.008 |     0.992 |      |      0.013 |   0.559 |       -0.033 |        0.017 |             0.968 |             1.017 |
| market_SURBURBAN_NY         |  0.101 |     1.106 | ***  |      0.015 |   0.000 |        0.072 |        0.129 |             1.075 |             1.138 |
| market_SYRACUSE             | -0.035 |     0.966 |  **  |      0.009 |   0.017 |       -0.053 |       -0.017 |             0.948 |             0.983 |
| market_TAMPA                |  0.103 |     1.109 | ***  |      0.011 |   0.000 |        0.081 |        0.126 |             1.084 |             1.134 |
| market_URBAN_NY             |  0.173 |     1.189 | ***  |      0.011 |   0.000 |        0.152 |        0.195 |             1.164 |             1.216 |
| market_WASHINGTON_DC        |  0.097 |     1.102 | ***  |      0.003 |   0.000 |        0.092 |        0.103 |             1.096 |             1.109 |
| brand_BUSCH_LIGHT           | -0.260 |     0.771 | ***  |      0.002 |   0.000 |       -0.264 |       -0.255 |             0.768 |             0.775 |
| brand_COORS_LIGHT           | -0.005 |     0.995 |  **  |      0.002 |   0.049 |       -0.009 |       -0.000 |             0.991 |             1.000 |
| brand_MILLER_LITE           | -0.013 |     0.987 | ***  |      0.003 |   0.000 |       -0.018 |       -0.008 |             0.982 |             0.992 |
| brand_NATURAL_LIGHT         | -0.319 |     0.727 | ***  |      0.002 |   0.000 |       -0.323 |       -0.315 |             0.724 |             0.730 |
| container_CAN               | -0.053 |     0.948 | ***  |      0.011 |   0.000 |       -0.074 |       -0.032 |             0.929 |             0.968 |
| Intercept                   | -2.117 |           | ***  |      0.001 |         |       -2.119 |              |            -2.115 |                   |
--------------------------------------------------------------------------------------------------------------------------------------------------------
| Observations                | 48,115 |           |      |            |         |              |              |                   |                   |
| R²                          |  0.547 |           |      |            |         |              |              |                   |                   |
| RMSE                        |  0.170 |           |      |            |         |              |              |                   |                   |
+-----------------------------+--------+-----------+------+------------+---------+--------------+--------------+-------------------+-------------------+</code></pre>
</div>
</div>
</section>
<section id="model-2" class="level1">
<h1>Model 2</h1>
<div class="cell" data-outputid="1d07b72c-5bcf-4ff9-ce0b-ae117c430790" data-execution_count="20">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># assembling predictors</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>conti_cols <span class="op">=</span> [<span class="st">"log_beer_floz"</span>]</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>assembler_predictors <span class="op">=</span> (</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    conti_cols <span class="op">+</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    dummy_cols_market <span class="op">+</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    dummy_cols_brand <span class="op">+</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    dummy_cols_container <span class="op">+</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    interaction_cols_brand_quantity</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>assembler_2 <span class="op">=</span> VectorAssembler(</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    inputCols <span class="op">=</span> assembler_predictors,</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    outputCol <span class="op">=</span> <span class="st">"predictors"</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>dtrain_2 <span class="op">=</span> assembler_2.transform(dtrain)</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>dtest_2  <span class="op">=</span> assembler_2.transform(dtest)</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="co"># training model</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>model_2 <span class="op">=</span> (</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>    LinearRegression(featuresCol<span class="op">=</span><span class="st">"predictors"</span>,</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>                     labelCol<span class="op">=</span><span class="st">"log_price_floz"</span>)</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>    .fit(dtrain_2)</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a><span class="co"># making prediction - Question 4</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>dtest_2 <span class="op">=</span> model_2.transform(dtest_2)</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a><span class="co"># makting regression table</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( regression_table(model_2, assembler_2) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+-------------------------------------+--------+-----------+------+------------+---------+--------------+--------------+-------------------+-------------------+
| y: log_price_floz                   |   Beta | Exp(Beta) | Sig. | Std. Error | p-value | 95% CI Lower | 95% CI Upper | Exp(95% CI Lower) | Exp(95% CI Upper) |
+-------------------------------------+--------+-----------+------+------------+---------+--------------+--------------+-------------------+-------------------+
| log_beer_floz                       | -0.146 |           | ***  |      0.013 |   0.000 |       -0.171 |       -0.121 |                   |                   |
| market_ALBANY                       |  0.029 |     1.029 |  **  |      0.010 |   0.021 |        0.009 |        0.049 |             1.009 |             1.050 |
| market_ATLANTA                      |  0.083 |     1.087 | ***  |      0.014 |   0.000 |        0.056 |        0.110 |             1.058 |             1.116 |
| market_BALTIMORE                    |  0.104 |     1.109 | ***  |      0.011 |   0.000 |        0.083 |        0.124 |             1.087 |             1.132 |
| market_BIRMINGHAM                   |  0.130 |     1.139 | ***  |      0.011 |   0.000 |        0.108 |        0.152 |             1.114 |             1.164 |
| market_BOSTON                       |  0.127 |     1.135 | ***  |      0.010 |   0.000 |        0.107 |        0.147 |             1.113 |             1.158 |
| market_CHARLOTTE                    |  0.015 |     1.015 |      |      0.010 |   0.156 |       -0.005 |        0.034 |             0.995 |             1.034 |
| market_CHICAGO                      | -0.013 |     0.987 |      |      0.010 |   0.173 |       -0.033 |        0.007 |             0.967 |             1.007 |
| market_CINCINNATI                   |  0.079 |     1.082 | ***  |      0.010 |   0.000 |        0.058 |        0.099 |             1.060 |             1.104 |
| market_CLEVELAND                    |  0.045 |     1.046 | ***  |      0.010 |   0.000 |        0.025 |        0.064 |             1.026 |             1.066 |
| market_COLUMBUS                     |  0.066 |     1.068 | ***  |      0.010 |   0.000 |        0.047 |        0.085 |             1.048 |             1.089 |
| market_DALLAS                       |  0.214 |     1.238 | ***  |      0.011 |   0.000 |        0.192 |        0.236 |             1.211 |             1.266 |
| market_DENVER                       |  0.121 |     1.129 | ***  |      0.012 |   0.000 |        0.099 |        0.144 |             1.104 |             1.155 |
| market_DES_MOINES                   |  0.125 |     1.134 | ***  |      0.010 |   0.000 |        0.106 |        0.145 |             1.112 |             1.156 |
| market_DETROIT                      |  0.083 |     1.086 | ***  |      0.016 |   0.000 |        0.051 |        0.114 |             1.052 |             1.121 |
| market_EXURBAN_NJ                   |  0.216 |     1.242 | ***  |      0.023 |   0.000 |        0.172 |        0.261 |             1.187 |             1.299 |
| market_EXURBAN_NY                   |  0.119 |     1.126 | ***  |      0.011 |   0.000 |        0.096 |        0.141 |             1.101 |             1.151 |
| market_GRAND_RAPIDS                 |  0.078 |     1.081 | ***  |      0.014 |   0.000 |        0.051 |        0.105 |             1.053 |             1.111 |
| market_HARTFORD-NEW_HAVEN           |  0.146 |     1.157 | ***  |      0.010 |   0.000 |        0.126 |        0.165 |             1.135 |             1.179 |
| market_HOUSTON                      |  0.110 |     1.117 | ***  |      0.010 |   0.000 |        0.090 |        0.131 |             1.094 |             1.140 |
| market_INDIANAPOLIS                 |  0.041 |     1.042 | ***  |      0.013 |   0.000 |        0.017 |        0.066 |             1.017 |             1.068 |
| market_JACKSONVILLE                 |  0.105 |     1.111 | ***  |      0.012 |   0.000 |        0.082 |        0.128 |             1.086 |             1.137 |
| market_KANSAS_CITY                  |  0.070 |     1.073 | ***  |      0.013 |   0.000 |        0.045 |        0.095 |             1.046 |             1.100 |
| market_LITTLE_ROCK                  |  0.088 |     1.092 | ***  |      0.010 |   0.000 |        0.069 |        0.108 |             1.071 |             1.114 |
| market_LOS_ANGELES                  |  0.026 |     1.026 |  **  |      0.011 |   0.010 |        0.004 |        0.047 |             1.004 |             1.048 |
| market_LOUISVILLE                   |  0.063 |     1.065 | ***  |      0.012 |   0.000 |        0.039 |        0.087 |             1.040 |             1.091 |
| market_MEMPHIS                      |  0.127 |     1.136 | ***  |      0.009 |   0.000 |        0.109 |        0.146 |             1.115 |             1.157 |
| market_MIAMI                        |  0.106 |     1.112 | ***  |      0.011 |   0.000 |        0.084 |        0.129 |             1.088 |             1.137 |
| market_MILWAUKEE                    |  0.027 |     1.027 |  **  |      0.011 |   0.019 |        0.005 |        0.048 |             1.005 |             1.050 |
| market_MINNEAPOLIS                  |  0.129 |     1.138 | ***  |      0.011 |   0.000 |        0.108 |        0.150 |             1.115 |             1.162 |
| market_NASHVILLE                    |  0.142 |     1.152 | ***  |      0.011 |   0.000 |        0.120 |        0.163 |             1.128 |             1.177 |
| market_NEW_ORLEANS-MOBILE           |  0.118 |     1.125 | ***  |      0.011 |   0.000 |        0.097 |        0.140 |             1.101 |             1.150 |
| market_OKLAHOMA_CITY-TULSA          |  0.142 |     1.153 | ***  |      0.011 |   0.000 |        0.121 |        0.163 |             1.129 |             1.177 |
| market_OMAHA                        |  0.129 |     1.137 | ***  |      0.011 |   0.000 |        0.108 |        0.149 |             1.114 |             1.161 |
| market_ORLANDO                      |  0.096 |     1.101 | ***  |      0.013 |   0.000 |        0.071 |        0.121 |             1.073 |             1.129 |
| market_PHILADELPHIA                 |  0.114 |     1.121 | ***  |      0.010 |   0.000 |        0.096 |        0.133 |             1.100 |             1.142 |
| market_PHOENIX                      |  0.144 |     1.155 | ***  |      0.014 |   0.000 |        0.117 |        0.171 |             1.124 |             1.186 |
| market_PITTSBURGH                   |  0.098 |     1.102 | ***  |      0.012 |   0.000 |        0.074 |        0.122 |             1.076 |             1.129 |
| market_PORTLAND                     |  0.113 |     1.120 | ***  |      0.010 |   0.000 |        0.093 |        0.133 |             1.097 |             1.143 |
| market_RALEIGH-DURHAM               |  0.090 |     1.094 | ***  |      0.011 |   0.000 |        0.069 |        0.111 |             1.072 |             1.117 |
| market_RICHMOND                     |  0.041 |     1.041 | ***  |      0.015 |   0.000 |        0.012 |        0.069 |             1.012 |             1.072 |
| market_RURAL_ALABAMA                |  0.156 |     1.169 | ***  |      0.019 |   0.000 |        0.118 |        0.194 |             1.125 |             1.215 |
| market_RURAL_ARKANSAS               |  0.161 |     1.174 | ***  |      0.011 |   0.000 |        0.139 |        0.182 |             1.149 |             1.200 |
| market_RURAL_CALIFORNIA             |  0.041 |     1.042 | ***  |      0.046 |   0.000 |       -0.049 |        0.131 |             0.952 |             1.140 |
| market_RURAL_COLORADO               |  0.136 |     1.145 | ***  |      0.012 |   0.003 |        0.111 |        0.160 |             1.118 |             1.174 |
| market_RURAL_FLORIDA                |  0.050 |     1.052 | ***  |      0.013 |   0.000 |        0.025 |        0.076 |             1.025 |             1.079 |
| market_RURAL_GEORGIA                |  0.128 |     1.137 | ***  |      0.019 |   0.000 |        0.091 |        0.166 |             1.096 |             1.180 |
| market_RURAL_IDAHO                  |  0.135 |     1.144 | ***  |      0.010 |   0.000 |        0.114 |        0.155 |             1.121 |             1.168 |
| market_RURAL_ILLINOIS               |  0.013 |     1.013 |      |      0.013 |   0.228 |       -0.012 |        0.037 |             0.988 |             1.038 |
| market_RURAL_INDIANA                |  0.076 |     1.078 | ***  |      0.011 |   0.000 |        0.055 |        0.096 |             1.056 |             1.101 |
| market_RURAL_IOWA                   |  0.055 |     1.056 | ***  |      0.018 |   0.000 |        0.019 |        0.090 |             1.020 |             1.094 |
| market_RURAL_KANSAS                 |  0.133 |     1.142 | ***  |      0.016 |   0.000 |        0.102 |        0.165 |             1.107 |             1.179 |
| market_RURAL_KENTUCKY               |  0.156 |     1.169 | ***  |      0.014 |   0.000 |        0.129 |        0.183 |             1.138 |             1.200 |
| market_RURAL_LOUISIANA              |  0.055 |     1.057 | ***  |      0.014 |   0.000 |        0.028 |        0.082 |             1.028 |             1.086 |
| market_RURAL_MAINE                  |  0.088 |     1.092 | ***  |      0.011 |   0.000 |        0.065 |        0.110 |             1.068 |             1.116 |
| market_RURAL_MICHIGAN               |  0.081 |     1.084 | ***  |      0.020 |   0.000 |        0.042 |        0.119 |             1.043 |             1.127 |
| market_RURAL_MINNESOTA              |  0.169 |     1.185 | ***  |      0.014 |   0.000 |        0.142 |        0.197 |             1.152 |             1.218 |
| market_RURAL_MISSISSIPPI            |  0.039 |     1.040 | ***  |      0.012 |   0.006 |        0.016 |        0.062 |             1.016 |             1.064 |
| market_RURAL_MISSOURI               |  0.104 |     1.110 | ***  |      0.014 |   0.000 |        0.077 |        0.132 |             1.080 |             1.141 |
| market_RURAL_MONTANA                |  0.124 |     1.132 | ***  |      0.021 |   0.000 |        0.083 |        0.166 |             1.086 |             1.180 |
| market_RURAL_NEBRASKA               |  0.138 |     1.148 | ***  |      0.012 |   0.000 |        0.114 |        0.162 |             1.121 |             1.176 |
| market_RURAL_NEVADA                 |  0.051 |     1.052 | ***  |      0.044 |   0.000 |       -0.037 |        0.138 |             0.964 |             1.148 |
| market_RURAL_NEW_HAMPSHIRE          |  0.017 |     1.017 |      |      0.013 |   0.705 |       -0.009 |        0.043 |             0.991 |             1.043 |
| market_RURAL_NEW_MEXICO             |  0.148 |     1.160 | ***  |      0.060 |   0.000 |        0.030 |        0.266 |             1.030 |             1.305 |
| market_RURAL_NEW_YORK               | -0.010 |     0.990 |      |      0.011 |   0.862 |       -0.032 |        0.011 |             0.968 |             1.011 |
| market_RURAL_NORTH_CAROLINA         |  0.027 |     1.027 |  **  |      0.020 |   0.015 |       -0.013 |        0.067 |             0.987 |             1.069 |
| market_RURAL_NORTH_DAKOTA           |  0.222 |     1.248 | ***  |      0.015 |   0.000 |        0.192 |        0.252 |             1.212 |             1.286 |
| market_RURAL_OHIO                   |  0.093 |     1.098 | ***  |      0.031 |   0.000 |        0.033 |        0.154 |             1.033 |             1.167 |
| market_RURAL_OKLAHOMA               |  0.130 |     1.139 | ***  |      0.033 |   0.000 |        0.067 |        0.194 |             1.069 |             1.214 |
| market_RURAL_OREGON                 |  0.070 |     1.073 |  **  |      0.015 |   0.031 |        0.041 |        0.099 |             1.042 |             1.104 |
| market_RURAL_PENNSYLVANIA           |  0.132 |     1.141 | ***  |      0.010 |   0.000 |        0.112 |        0.152 |             1.118 |             1.164 |
| market_RURAL_SOUTH_CAROLINA         |  0.054 |     1.055 | ***  |      0.019 |   0.000 |        0.016 |        0.092 |             1.016 |             1.096 |
| market_RURAL_SOUTH_DAKOTA           |  0.076 |     1.079 | ***  |      0.013 |   0.000 |        0.050 |        0.101 |             1.051 |             1.107 |
| market_RURAL_TENNESSEE              |  0.170 |     1.185 | ***  |      0.010 |   0.000 |        0.150 |        0.189 |             1.162 |             1.208 |
| market_RURAL_TEXAS                  |  0.167 |     1.182 | ***  |      0.020 |   0.000 |        0.129 |        0.205 |             1.137 |             1.228 |
| market_RURAL_VERMONT                |  0.066 |     1.068 | ***  |      0.017 |   0.001 |        0.032 |        0.100 |             1.032 |             1.105 |
| market_RURAL_VIRGINIA               |  0.015 |     1.015 |      |      0.014 |   0.380 |       -0.012 |        0.043 |             0.988 |             1.044 |
| market_RURAL_WASHINGTON             |  0.114 |     1.121 | ***  |      0.015 |   0.000 |        0.084 |        0.143 |             1.088 |             1.154 |
| market_RURAL_WEST_VIRGINIA          | -0.041 |     0.960 | ***  |      0.010 |   0.007 |       -0.061 |       -0.021 |             0.941 |             0.980 |
| market_RURAL_WISCONSIN              |  0.037 |     1.038 | ***  |      0.036 |   0.000 |       -0.032 |        0.107 |             0.968 |             1.113 |
| market_RURAL_WYOMING                |  0.144 |     1.155 | ***  |      0.011 |   0.000 |        0.123 |        0.165 |             1.131 |             1.179 |
| market_SACRAMENTO                   |  0.018 |     1.019 |  *   |      0.014 |   0.085 |       -0.009 |        0.046 |             0.991 |             1.047 |
| market_SALT_LAKE_CITY               |  0.114 |     1.121 | ***  |      0.009 |   0.000 |        0.096 |        0.133 |             1.101 |             1.142 |
| market_SAN_ANTONIO                  |  0.133 |     1.142 | ***  |      0.012 |   0.000 |        0.110 |        0.155 |             1.116 |             1.168 |
| market_SAN_DIEGO                    |  0.010 |     1.010 |      |      0.011 |   0.385 |       -0.012 |        0.032 |             0.989 |             1.032 |
| market_SAN_FRANCISCO                |  0.066 |     1.068 | ***  |      0.011 |   0.000 |        0.044 |        0.087 |             1.045 |             1.091 |
| market_SEATTLE                      |  0.101 |     1.106 | ***  |      0.010 |   0.000 |        0.081 |        0.121 |             1.084 |             1.128 |
| market_ST_LOUIS                     |  0.038 |     1.038 | ***  |      0.013 |   0.000 |        0.011 |        0.064 |             1.011 |             1.066 |
| market_SURBURBAN_NJ                 | -0.010 |     0.990 |      |      0.013 |   0.459 |       -0.035 |        0.015 |             0.966 |             1.015 |
| market_SURBURBAN_NY                 |  0.097 |     1.102 | ***  |      0.015 |   0.000 |        0.069 |        0.126 |             1.071 |             1.134 |
| market_SYRACUSE                     | -0.040 |     0.961 | ***  |      0.009 |   0.006 |       -0.058 |       -0.022 |             0.943 |             0.978 |
| market_TAMPA                        |  0.099 |     1.104 | ***  |      0.011 |   0.000 |        0.077 |        0.121 |             1.080 |             1.129 |
| market_URBAN_NY                     |  0.172 |     1.188 | ***  |      0.011 |   0.000 |        0.151 |        0.194 |             1.163 |             1.214 |
| market_WASHINGTON_DC                |  0.091 |     1.095 | ***  |      0.022 |   0.000 |        0.048 |        0.134 |             1.049 |             1.144 |
| brand_BUSCH_LIGHT                   | -0.185 |     0.831 | ***  |      0.019 |   0.000 |       -0.222 |       -0.149 |             0.801 |             0.862 |
| brand_COORS_LIGHT                   |  0.019 |     1.019 |      |      0.017 |   0.315 |       -0.014 |        0.051 |             0.986 |             1.053 |
| brand_MILLER_LITE                   |  0.080 |     1.083 | ***  |      0.018 |   0.000 |        0.045 |        0.114 |             1.046 |             1.121 |
| brand_NATURAL_LIGHT                 | -0.601 |     0.548 | ***  |      0.002 |   0.000 |       -0.605 |       -0.597 |             0.546 |             0.550 |
| container_CAN                       | -0.052 |     0.949 | ***  |      0.004 |   0.000 |       -0.060 |       -0.044 |             0.942 |             0.957 |
| brand_BUSCH_LIGHT_*_log_beer_floz   | -0.013 |           | ***  |      0.003 |   0.001 |       -0.020 |       -0.007 |                   |                   |
| brand_COORS_LIGHT_*_log_beer_floz   | -0.004 |           |      |      0.003 |   0.194 |       -0.011 |        0.002 |                   |                   |
| brand_MILLER_LITE_*_log_beer_floz   | -0.017 |           | ***  |      0.003 |   0.000 |       -0.024 |       -0.011 |                   |                   |
| brand_NATURAL_LIGHT_*_log_beer_floz |  0.052 |           | ***  |      0.014 |   0.000 |        0.025 |        0.080 |                   |                   |
| Intercept                           | -2.093 |           | ***  |      0.002 |         |       -2.097 |              |            -2.089 |                   |
----------------------------------------------------------------------------------------------------------------------------------------------------------------
| Observations                        | 48,115 |           |      |            |         |              |              |                   |                   |
| R²                                  |  0.552 |           |      |            |         |              |              |                   |                   |
| RMSE                                |  0.169 |           |      |            |         |              |              |                   |                   |
+-------------------------------------+--------+-----------+------+------------+---------+--------------+--------------+-------------------+-------------------+</code></pre>
</div>
</div>
</section>
<section id="model-3" class="level1">
<h1>Model 3</h1>
<div class="cell" data-outputid="ed16f5aa-2d43-4c23-9d17-44eeca141cad" data-execution_count="21">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># assembling predictors</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>conti_cols <span class="op">=</span> [<span class="st">"log_beer_floz"</span>]</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>assembler_predictors <span class="op">=</span> (</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    conti_cols <span class="op">+</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    dummy_cols_market <span class="op">+</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    dummy_cols_brand <span class="op">+</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    dummy_cols_container <span class="op">+</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    interaction_cols_brand_promo_quantity</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>assembler_3 <span class="op">=</span> VectorAssembler(</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    inputCols <span class="op">=</span> assembler_predictors,</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    outputCol <span class="op">=</span> <span class="st">"predictors"</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>dtrain_3 <span class="op">=</span> assembler_3.transform(dtrain)</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>dtest_3  <span class="op">=</span> assembler_3.transform(dtest)</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="co"># training model</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>model_3 <span class="op">=</span> (</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    LinearRegression(featuresCol<span class="op">=</span><span class="st">"predictors"</span>,</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>                     labelCol<span class="op">=</span><span class="st">"log_price_floz"</span>)</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    .fit(dtrain_3)</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a><span class="co"># making prediction - Question 4</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>dtest_3 <span class="op">=</span> model_3.transform(dtest_3)</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a><span class="co"># makting regression table</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( regression_table(model_3, assembler_3) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------------------------------------+--------+-----------+------+------------+---------+--------------+--------------+-------------------+-------------------+
| y: log_price_floz                                |   Beta | Exp(Beta) | Sig. | Std. Error | p-value | 95% CI Lower | 95% CI Upper | Exp(95% CI Lower) | Exp(95% CI Upper) |
+--------------------------------------------------+--------+-----------+------+------------+---------+--------------+--------------+-------------------+-------------------+
| log_beer_floz                                    | -0.140 |           | ***  |      0.012 |   0.000 |       -0.165 |       -0.116 |                   |                   |
| market_ALBANY                                    |  0.022 |     1.023 |  *   |      0.010 |   0.074 |        0.002 |        0.042 |             1.002 |             1.043 |
| market_ATLANTA                                   |  0.079 |     1.083 | ***  |      0.013 |   0.000 |        0.053 |        0.106 |             1.054 |             1.112 |
| market_BALTIMORE                                 |  0.093 |     1.098 | ***  |      0.010 |   0.000 |        0.073 |        0.114 |             1.075 |             1.120 |
| market_BIRMINGHAM                                |  0.124 |     1.133 | ***  |      0.011 |   0.000 |        0.103 |        0.146 |             1.108 |             1.157 |
| market_BOSTON                                    |  0.123 |     1.131 | ***  |      0.010 |   0.000 |        0.103 |        0.143 |             1.109 |             1.154 |
| market_CHARLOTTE                                 |  0.024 |     1.024 |  **  |      0.010 |   0.019 |        0.005 |        0.043 |             1.005 |             1.044 |
| market_CHICAGO                                   | -0.007 |     0.993 |      |      0.010 |   0.486 |       -0.027 |        0.013 |             0.974 |             1.013 |
| market_CINCINNATI                                |  0.077 |     1.080 | ***  |      0.010 |   0.000 |        0.057 |        0.097 |             1.058 |             1.102 |
| market_CLEVELAND                                 |  0.041 |     1.041 | ***  |      0.010 |   0.000 |        0.022 |        0.059 |             1.022 |             1.061 |
| market_COLUMBUS                                  |  0.066 |     1.068 | ***  |      0.010 |   0.000 |        0.047 |        0.085 |             1.048 |             1.088 |
| market_DALLAS                                    |  0.218 |     1.244 | ***  |      0.011 |   0.000 |        0.197 |        0.240 |             1.217 |             1.271 |
| market_DENVER                                    |  0.130 |     1.139 | ***  |      0.011 |   0.000 |        0.108 |        0.153 |             1.114 |             1.165 |
| market_DES_MOINES                                |  0.119 |     1.126 | ***  |      0.010 |   0.000 |        0.099 |        0.138 |             1.105 |             1.148 |
| market_DETROIT                                   |  0.084 |     1.088 | ***  |      0.016 |   0.000 |        0.053 |        0.116 |             1.054 |             1.123 |
| market_EXURBAN_NJ                                |  0.207 |     1.229 | ***  |      0.023 |   0.000 |        0.162 |        0.251 |             1.176 |             1.285 |
| market_EXURBAN_NY                                |  0.112 |     1.119 | ***  |      0.011 |   0.000 |        0.090 |        0.134 |             1.095 |             1.144 |
| market_GRAND_RAPIDS                              |  0.077 |     1.080 | ***  |      0.014 |   0.000 |        0.050 |        0.104 |             1.051 |             1.109 |
| market_HARTFORD-NEW_HAVEN                        |  0.143 |     1.154 | ***  |      0.010 |   0.000 |        0.124 |        0.162 |             1.132 |             1.176 |
| market_HOUSTON                                   |  0.114 |     1.121 | ***  |      0.010 |   0.000 |        0.094 |        0.134 |             1.098 |             1.143 |
| market_INDIANAPOLIS                              |  0.042 |     1.043 | ***  |      0.012 |   0.000 |        0.017 |        0.066 |             1.017 |             1.068 |
| market_JACKSONVILLE                              |  0.108 |     1.114 | ***  |      0.012 |   0.000 |        0.085 |        0.131 |             1.089 |             1.140 |
| market_KANSAS_CITY                               |  0.065 |     1.067 | ***  |      0.013 |   0.000 |        0.040 |        0.090 |             1.041 |             1.094 |
| market_LITTLE_ROCK                               |  0.085 |     1.088 | ***  |      0.010 |   0.000 |        0.065 |        0.104 |             1.067 |             1.109 |
| market_LOS_ANGELES                               |  0.034 |     1.035 | ***  |      0.011 |   0.000 |        0.013 |        0.056 |             1.013 |             1.058 |
| market_LOUISVILLE                                |  0.067 |     1.069 | ***  |      0.012 |   0.000 |        0.043 |        0.091 |             1.044 |             1.095 |
| market_MEMPHIS                                   |  0.121 |     1.128 | ***  |      0.009 |   0.000 |        0.102 |        0.139 |             1.108 |             1.149 |
| market_MIAMI                                     |  0.107 |     1.113 | ***  |      0.011 |   0.000 |        0.085 |        0.129 |             1.088 |             1.138 |
| market_MILWAUKEE                                 |  0.029 |     1.029 |  **  |      0.011 |   0.012 |        0.007 |        0.050 |             1.007 |             1.051 |
| market_MINNEAPOLIS                               |  0.125 |     1.134 | ***  |      0.011 |   0.000 |        0.105 |        0.146 |             1.110 |             1.157 |
| market_NASHVILLE                                 |  0.140 |     1.150 | ***  |      0.011 |   0.000 |        0.118 |        0.161 |             1.126 |             1.175 |
| market_NEW_ORLEANS-MOBILE                        |  0.112 |     1.118 | ***  |      0.011 |   0.000 |        0.090 |        0.134 |             1.095 |             1.143 |
| market_OKLAHOMA_CITY-TULSA                       |  0.135 |     1.144 | ***  |      0.011 |   0.000 |        0.114 |        0.156 |             1.121 |             1.169 |
| market_OMAHA                                     |  0.130 |     1.139 | ***  |      0.010 |   0.000 |        0.110 |        0.151 |             1.116 |             1.162 |
| market_ORLANDO                                   |  0.099 |     1.104 | ***  |      0.013 |   0.000 |        0.073 |        0.124 |             1.076 |             1.132 |
| market_PHILADELPHIA                              |  0.103 |     1.108 | ***  |      0.009 |   0.000 |        0.084 |        0.121 |             1.088 |             1.129 |
| market_PHOENIX                                   |  0.153 |     1.165 | ***  |      0.014 |   0.000 |        0.126 |        0.180 |             1.134 |             1.197 |
| market_PITTSBURGH                                |  0.091 |     1.096 | ***  |      0.012 |   0.000 |        0.067 |        0.115 |             1.070 |             1.122 |
| market_PORTLAND                                  |  0.116 |     1.123 | ***  |      0.010 |   0.000 |        0.095 |        0.136 |             1.100 |             1.146 |
| market_RALEIGH-DURHAM                            |  0.084 |     1.088 | ***  |      0.011 |   0.000 |        0.064 |        0.105 |             1.066 |             1.111 |
| market_RICHMOND                                  |  0.035 |     1.035 | ***  |      0.014 |   0.001 |        0.007 |        0.063 |             1.007 |             1.065 |
| market_RURAL_ALABAMA                             |  0.151 |     1.163 | ***  |      0.019 |   0.000 |        0.113 |        0.189 |             1.120 |             1.208 |
| market_RURAL_ARKANSAS                            |  0.152 |     1.164 | ***  |      0.011 |   0.000 |        0.130 |        0.173 |             1.139 |             1.189 |
| market_RURAL_CALIFORNIA                          |  0.044 |     1.045 | ***  |      0.046 |   0.000 |       -0.046 |        0.133 |             0.955 |             1.142 |
| market_RURAL_COLORADO                            |  0.144 |     1.155 | ***  |      0.012 |   0.002 |        0.120 |        0.169 |             1.128 |             1.184 |
| market_RURAL_FLORIDA                             |  0.047 |     1.049 | ***  |      0.013 |   0.000 |        0.022 |        0.073 |             1.022 |             1.076 |
| market_RURAL_GEORGIA                             |  0.122 |     1.130 | ***  |      0.019 |   0.000 |        0.085 |        0.159 |             1.089 |             1.172 |
| market_RURAL_IDAHO                               |  0.134 |     1.144 | ***  |      0.010 |   0.000 |        0.114 |        0.154 |             1.121 |             1.167 |
| market_RURAL_ILLINOIS                            |  0.010 |     1.010 |      |      0.013 |   0.316 |       -0.014 |        0.035 |             0.986 |             1.036 |
| market_RURAL_INDIANA                             |  0.075 |     1.077 | ***  |      0.011 |   0.000 |        0.054 |        0.095 |             1.055 |             1.100 |
| market_RURAL_IOWA                                |  0.051 |     1.052 | ***  |      0.018 |   0.000 |        0.016 |        0.086 |             1.016 |             1.090 |
| market_RURAL_KANSAS                              |  0.125 |     1.133 | ***  |      0.016 |   0.000 |        0.093 |        0.156 |             1.098 |             1.169 |
| market_RURAL_KENTUCKY                            |  0.152 |     1.164 | ***  |      0.014 |   0.000 |        0.125 |        0.178 |             1.134 |             1.195 |
| market_RURAL_LOUISIANA                           |  0.045 |     1.046 | ***  |      0.014 |   0.001 |        0.018 |        0.072 |             1.018 |             1.075 |
| market_RURAL_MAINE                               |  0.086 |     1.090 | ***  |      0.011 |   0.000 |        0.064 |        0.108 |             1.066 |             1.114 |
| market_RURAL_MICHIGAN                            |  0.076 |     1.079 | ***  |      0.020 |   0.000 |        0.037 |        0.114 |             1.038 |             1.121 |
| market_RURAL_MINNESOTA                           |  0.162 |     1.176 | ***  |      0.014 |   0.000 |        0.134 |        0.189 |             1.144 |             1.208 |
| market_RURAL_MISSISSIPPI                         |  0.038 |     1.039 | ***  |      0.012 |   0.006 |        0.015 |        0.061 |             1.015 |             1.063 |
| market_RURAL_MISSOURI                            |  0.097 |     1.102 | ***  |      0.014 |   0.000 |        0.070 |        0.125 |             1.072 |             1.133 |
| market_RURAL_MONTANA                             |  0.130 |     1.139 | ***  |      0.021 |   0.000 |        0.089 |        0.171 |             1.093 |             1.187 |
| market_RURAL_NEBRASKA                            |  0.133 |     1.142 | ***  |      0.012 |   0.000 |        0.109 |        0.156 |             1.115 |             1.169 |
| market_RURAL_NEVADA                              |  0.048 |     1.049 | ***  |      0.044 |   0.000 |       -0.038 |        0.134 |             0.962 |             1.144 |
| market_RURAL_NEW_HAMPSHIRE                       |  0.011 |     1.011 |      |      0.013 |   0.796 |       -0.014 |        0.037 |             0.986 |             1.038 |
| market_RURAL_NEW_MEXICO                          |  0.145 |     1.156 | ***  |      0.060 |   0.000 |        0.027 |        0.262 |             1.028 |             1.299 |
| market_RURAL_NEW_YORK                            | -0.024 |     0.976 |      |      0.011 |   0.686 |       -0.046 |       -0.003 |             0.955 |             0.997 |
| market_RURAL_NORTH_CAROLINA                      |  0.014 |     1.014 |      |      0.020 |   0.195 |       -0.025 |        0.054 |             0.975 |             1.055 |
| market_RURAL_NORTH_DAKOTA                        |  0.220 |     1.246 | ***  |      0.015 |   0.000 |        0.190 |        0.249 |             1.209 |             1.283 |
| market_RURAL_OHIO                                |  0.090 |     1.094 | ***  |      0.031 |   0.000 |        0.030 |        0.150 |             1.030 |             1.162 |
| market_RURAL_OKLAHOMA                            |  0.120 |     1.128 | ***  |      0.032 |   0.000 |        0.057 |        0.183 |             1.059 |             1.201 |
| market_RURAL_OREGON                              |  0.071 |     1.074 |  **  |      0.014 |   0.027 |        0.043 |        0.100 |             1.044 |             1.105 |
| market_RURAL_PENNSYLVANIA                        |  0.122 |     1.130 | ***  |      0.010 |   0.000 |        0.102 |        0.142 |             1.108 |             1.152 |
| market_RURAL_SOUTH_CAROLINA                      |  0.056 |     1.057 | ***  |      0.019 |   0.000 |        0.018 |        0.093 |             1.018 |             1.098 |
| market_RURAL_SOUTH_DAKOTA                        |  0.071 |     1.074 | ***  |      0.013 |   0.000 |        0.046 |        0.097 |             1.047 |             1.102 |
| market_RURAL_TENNESSEE                           |  0.174 |     1.190 | ***  |      0.010 |   0.000 |        0.155 |        0.193 |             1.168 |             1.213 |
| market_RURAL_TEXAS                               |  0.164 |     1.179 | ***  |      0.019 |   0.000 |        0.126 |        0.202 |             1.135 |             1.224 |
| market_RURAL_VERMONT                             |  0.067 |     1.069 | ***  |      0.017 |   0.001 |        0.033 |        0.100 |             1.034 |             1.106 |
| market_RURAL_VIRGINIA                            |  0.011 |     1.011 |      |      0.014 |   0.536 |       -0.017 |        0.038 |             0.983 |             1.039 |
| market_RURAL_WASHINGTON                          |  0.131 |     1.140 | ***  |      0.015 |   0.000 |        0.102 |        0.160 |             1.107 |             1.174 |
| market_RURAL_WEST_VIRGINIA                       | -0.050 |     0.951 | ***  |      0.010 |   0.001 |       -0.070 |       -0.031 |             0.932 |             0.970 |
| market_RURAL_WISCONSIN                           |  0.036 |     1.036 | ***  |      0.035 |   0.000 |       -0.033 |        0.105 |             0.967 |             1.110 |
| market_RURAL_WYOMING                             |  0.138 |     1.148 | ***  |      0.011 |   0.000 |        0.118 |        0.159 |             1.125 |             1.173 |
| market_SACRAMENTO                                |  0.026 |     1.026 |  **  |      0.014 |   0.015 |       -0.002 |        0.053 |             0.998 |             1.055 |
| market_SALT_LAKE_CITY                            |  0.113 |     1.120 | ***  |      0.009 |   0.000 |        0.095 |        0.131 |             1.099 |             1.140 |
| market_SAN_ANTONIO                               |  0.129 |     1.138 | ***  |      0.012 |   0.000 |        0.106 |        0.152 |             1.112 |             1.164 |
| market_SAN_DIEGO                                 |  0.015 |     1.015 |      |      0.011 |   0.197 |       -0.007 |        0.036 |             0.993 |             1.037 |
| market_SAN_FRANCISCO                             |  0.073 |     1.076 | ***  |      0.011 |   0.000 |        0.052 |        0.094 |             1.053 |             1.099 |
| market_SEATTLE                                   |  0.113 |     1.120 | ***  |      0.010 |   0.000 |        0.094 |        0.133 |             1.098 |             1.143 |
| market_ST_LOUIS                                  |  0.041 |     1.042 | ***  |      0.013 |   0.000 |        0.015 |        0.067 |             1.015 |             1.069 |
| market_SURBURBAN_NJ                              | -0.021 |     0.979 |      |      0.012 |   0.109 |       -0.046 |        0.003 |             0.955 |             1.003 |
| market_SURBURBAN_NY                              |  0.097 |     1.102 | ***  |      0.014 |   0.000 |        0.069 |        0.125 |             1.071 |             1.133 |
| market_SYRACUSE                                  | -0.048 |     0.953 | ***  |      0.009 |   0.001 |       -0.066 |       -0.030 |             0.936 |             0.970 |
| market_TAMPA                                     |  0.100 |     1.105 | ***  |      0.011 |   0.000 |        0.078 |        0.122 |             1.081 |             1.130 |
| market_URBAN_NY                                  |  0.170 |     1.186 | ***  |      0.011 |   0.000 |        0.149 |        0.192 |             1.160 |             1.212 |
| market_WASHINGTON_DC                             |  0.085 |     1.089 | ***  |      0.023 |   0.000 |        0.040 |        0.130 |             1.041 |             1.139 |
| brand_BUSCH_LIGHT                                | -0.149 |     0.862 | ***  |      0.019 |   0.000 |       -0.187 |       -0.111 |             0.829 |             0.895 |
| brand_COORS_LIGHT                                |  0.042 |     1.043 |  **  |      0.017 |   0.029 |        0.008 |        0.077 |             1.008 |             1.080 |
| brand_MILLER_LITE                                |  0.111 |     1.117 | ***  |      0.019 |   0.000 |        0.074 |        0.147 |             1.077 |             1.159 |
| brand_NATURAL_LIGHT                              | -0.519 |     0.595 | ***  |      0.002 |   0.000 |       -0.523 |       -0.516 |             0.593 |             0.597 |
| container_CAN                                    | -0.053 |     0.948 | ***  |      0.061 |   0.000 |       -0.173 |        0.067 |             0.841 |             1.069 |
| brand_BUSCH_LIGHT_*_promo_True                   | -0.253 |     0.776 | ***  |      0.044 |   0.000 |       -0.341 |       -0.166 |             0.711 |             0.847 |
| brand_COORS_LIGHT_*_promo_True                   | -0.227 |     0.797 | ***  |      0.037 |   0.000 |       -0.299 |       -0.155 |             0.741 |             0.856 |
| brand_MILLER_LITE_*_promo_True                   | -0.286 |     0.751 | ***  |      0.035 |   0.000 |       -0.354 |       -0.218 |             0.702 |             0.804 |
| brand_NATURAL_LIGHT_*_promo_True                 | -0.400 |     0.671 | ***  |      0.004 |   0.000 |       -0.408 |       -0.391 |             0.665 |             0.676 |
| brand_BUSCH_LIGHT_*_log_beer_floz                | -0.021 |           | ***  |      0.004 |   0.000 |       -0.028 |       -0.014 |                   |                   |
| brand_COORS_LIGHT_*_log_beer_floz                | -0.008 |           |  **  |      0.003 |   0.026 |       -0.015 |       -0.002 |                   |                   |
| brand_MILLER_LITE_*_log_beer_floz                | -0.023 |           | ***  |      0.003 |   0.000 |       -0.030 |       -0.016 |                   |                   |
| brand_NATURAL_LIGHT_*_log_beer_floz              |  0.037 |           | ***  |      0.001 |   0.000 |        0.036 |        0.038 |                   |                   |
| promo_True_*_log_beer_floz                       | -0.008 |           | ***  |      0.011 |   0.000 |       -0.029 |        0.012 |                   |                   |
| brand_BUSCH_LIGHT_*_promo_True_*_log_beer_floz   |  0.047 |           | ***  |      0.008 |   0.000 |        0.031 |        0.063 |                   |                   |
| brand_COORS_LIGHT_*_promo_True_*_log_beer_floz   |  0.037 |           | ***  |      0.007 |   0.000 |        0.024 |        0.050 |                   |                   |
| brand_MILLER_LITE_*_promo_True_*_log_beer_floz   |  0.052 |           | ***  |      0.006 |   0.000 |        0.040 |        0.064 |                   |                   |
| brand_NATURAL_LIGHT_*_promo_True_*_log_beer_floz |  0.071 |           | ***  |      0.014 |   0.000 |        0.043 |        0.098 |                   |                   |
| Intercept                                        | -2.111 |           | ***  |      0.002 |         |       -2.115 |              |            -2.107 |                   |
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
| Observations                                     | 48,115 |           |      |            |         |              |              |                   |                   |
| R²                                               |  0.560 |           |      |            |         |              |              |                   |                   |
| RMSE                                             |  0.167 |           |      |            |         |              |              |                   |                   |
+--------------------------------------------------+--------+-----------+------+------------+---------+--------------+--------------+-------------------+-------------------+</code></pre>
</div>
</div>
</section>
<section id="model-comparison" class="level1">
<h1>Model Comparison</h1>
<section id="question-4" class="level2">
<h2 class="anchored" data-anchor-id="question-4">Question 4</h2>
<div class="cell" data-outputid="08d408ad-2e45-4e77-b6bf-da05637df3f4" data-execution_count="30">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    compare_reg_models(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>        [model_1, model_2, model_3],</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>        [assembler_1, assembler_2, assembler_3]</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>----------------------------------------------------------------------------------------------------------------------------------------------------
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| Predictor                                        |   y: log_price_floz (Model 1) |   y: log_price_floz (Model 2) |   y: log_price_floz (Model 3) |
----------------------------------------------------------------------------------------------------------------------------------------------------
+==================================================+===============================+===============================+===============================+
| log_beer_floz                                    |                     -0.142*** |                     -0.146*** |                     -0.140*** |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_ALBANY                                    |               0.027** / 1.027 |               0.029** / 1.029 |                0.022* / 1.023 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_ATLANTA                                   |              0.083*** / 1.087 |              0.083*** / 1.087 |              0.079*** / 1.083 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_BALTIMORE                                 |              0.100*** / 1.105 |              0.104*** / 1.109 |              0.093*** / 1.098 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_BIRMINGHAM                                |              0.124*** / 1.132 |              0.130*** / 1.139 |              0.124*** / 1.133 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_BOSTON                                    |              0.127*** / 1.136 |              0.127*** / 1.135 |              0.123*** / 1.131 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_CHARLOTTE                                 |                0.020* / 1.020 |                 0.015 / 1.015 |               0.024** / 1.024 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_CHICAGO                                   |                -0.008 / 0.992 |                -0.013 / 0.987 |                -0.007 / 0.993 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_CINCINNATI                                |              0.084*** / 1.088 |              0.079*** / 1.082 |              0.077*** / 1.080 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_CLEVELAND                                 |              0.050*** / 1.051 |              0.045*** / 1.046 |              0.041*** / 1.041 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_COLUMBUS                                  |              0.069*** / 1.072 |              0.066*** / 1.068 |              0.066*** / 1.068 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_DALLAS                                    |              0.203*** / 1.226 |              0.214*** / 1.238 |              0.218*** / 1.244 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_DENVER                                    |              0.123*** / 1.131 |              0.121*** / 1.129 |              0.130*** / 1.139 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_DES_MOINES                                |              0.129*** / 1.138 |              0.125*** / 1.134 |              0.119*** / 1.126 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_DETROIT                                   |              0.087*** / 1.091 |              0.083*** / 1.086 |              0.084*** / 1.088 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_EXURBAN_NJ                                |              0.221*** / 1.247 |              0.216*** / 1.242 |              0.207*** / 1.229 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_EXURBAN_NY                                |              0.122*** / 1.130 |              0.119*** / 1.126 |              0.112*** / 1.119 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_GRAND_RAPIDS                              |              0.082*** / 1.086 |              0.078*** / 1.081 |              0.077*** / 1.080 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_HARTFORD-NEW_HAVEN                        |              0.148*** / 1.160 |              0.146*** / 1.157 |              0.143*** / 1.154 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_HOUSTON                                   |              0.113*** / 1.120 |              0.110*** / 1.117 |              0.114*** / 1.121 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_INDIANAPOLIS                              |              0.042*** / 1.043 |              0.041*** / 1.042 |              0.042*** / 1.043 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_JACKSONVILLE                              |              0.113*** / 1.120 |              0.105*** / 1.111 |              0.108*** / 1.114 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_KANSAS_CITY                               |              0.076*** / 1.079 |              0.070*** / 1.073 |              0.065*** / 1.067 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_LITTLE_ROCK                               |              0.092*** / 1.096 |              0.088*** / 1.092 |              0.085*** / 1.088 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_LOS_ANGELES                               |              0.032*** / 1.033 |               0.026** / 1.026 |              0.034*** / 1.035 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_LOUISVILLE                                |              0.068*** / 1.070 |              0.063*** / 1.065 |              0.067*** / 1.069 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_MEMPHIS                                   |              0.128*** / 1.137 |              0.127*** / 1.136 |              0.121*** / 1.128 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_MIAMI                                     |              0.108*** / 1.114 |              0.106*** / 1.112 |              0.107*** / 1.113 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_MILWAUKEE                                 |               0.028** / 1.028 |               0.027** / 1.027 |               0.029** / 1.029 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_MINNEAPOLIS                               |              0.128*** / 1.137 |              0.129*** / 1.138 |              0.125*** / 1.134 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_NASHVILLE                                 |              0.143*** / 1.153 |              0.142*** / 1.152 |              0.140*** / 1.150 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_NEW_ORLEANS-MOBILE                        |              0.128*** / 1.136 |              0.118*** / 1.125 |              0.112*** / 1.118 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_OKLAHOMA_CITY-TULSA                       |              0.145*** / 1.156 |              0.142*** / 1.153 |              0.135*** / 1.144 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_OMAHA                                     |              0.131*** / 1.140 |              0.129*** / 1.137 |              0.130*** / 1.139 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_ORLANDO                                   |              0.098*** / 1.103 |              0.096*** / 1.101 |              0.099*** / 1.104 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_PHILADELPHIA                              |              0.115*** / 1.121 |              0.114*** / 1.121 |              0.103*** / 1.108 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_PHOENIX                                   |              0.142*** / 1.152 |              0.144*** / 1.155 |              0.153*** / 1.165 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_PITTSBURGH                                |              0.100*** / 1.105 |              0.098*** / 1.102 |              0.091*** / 1.096 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_PORTLAND                                  |              0.115*** / 1.122 |              0.113*** / 1.120 |              0.116*** / 1.123 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RALEIGH-DURHAM                            |              0.090*** / 1.094 |              0.090*** / 1.094 |              0.084*** / 1.088 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RICHMOND                                  |              0.043*** / 1.044 |              0.041*** / 1.041 |              0.035*** / 1.035 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_ALABAMA                             |              0.157*** / 1.170 |              0.156*** / 1.169 |              0.151*** / 1.163 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_ARKANSAS                            |              0.157*** / 1.171 |              0.161*** / 1.174 |              0.152*** / 1.164 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_CALIFORNIA                          |              0.044*** / 1.045 |              0.041*** / 1.042 |              0.044*** / 1.045 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_COLORADO                            |              0.137*** / 1.147 |              0.136*** / 1.145 |              0.144*** / 1.155 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_FLORIDA                             |              0.059*** / 1.061 |              0.050*** / 1.052 |              0.047*** / 1.049 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_GEORGIA                             |              0.132*** / 1.141 |              0.128*** / 1.137 |              0.122*** / 1.130 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_IDAHO                               |              0.142*** / 1.152 |              0.135*** / 1.144 |              0.134*** / 1.144 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_ILLINOIS                            |                 0.014 / 1.014 |                 0.013 / 1.013 |                 0.010 / 1.010 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_INDIANA                             |              0.073*** / 1.076 |              0.076*** / 1.078 |              0.075*** / 1.077 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_IOWA                                |              0.058*** / 1.060 |              0.055*** / 1.056 |              0.051*** / 1.052 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_KANSAS                              |              0.134*** / 1.143 |              0.133*** / 1.142 |              0.125*** / 1.133 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_KENTUCKY                            |              0.157*** / 1.170 |              0.156*** / 1.169 |              0.152*** / 1.164 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_LOUISIANA                           |              0.060*** / 1.061 |              0.055*** / 1.057 |              0.045*** / 1.046 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_MAINE                               |              0.091*** / 1.096 |              0.088*** / 1.092 |              0.086*** / 1.090 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_MICHIGAN                            |              0.085*** / 1.089 |              0.081*** / 1.084 |              0.076*** / 1.079 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_MINNESOTA                           |              0.165*** / 1.180 |              0.169*** / 1.185 |              0.162*** / 1.176 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_MISSISSIPPI                         |              0.043*** / 1.044 |              0.039*** / 1.040 |              0.038*** / 1.039 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_MISSOURI                            |              0.106*** / 1.112 |              0.104*** / 1.110 |              0.097*** / 1.102 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_MONTANA                             |              0.127*** / 1.135 |              0.124*** / 1.132 |              0.130*** / 1.139 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_NEBRASKA                            |              0.138*** / 1.148 |              0.138*** / 1.148 |              0.133*** / 1.142 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_NEVADA                              |              0.051*** / 1.052 |              0.051*** / 1.052 |              0.048*** / 1.049 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_NEW_HAMPSHIRE                       |                 0.028 / 1.028 |                 0.017 / 1.017 |                 0.011 / 1.011 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_NEW_MEXICO                          |              0.154*** / 1.166 |              0.148*** / 1.160 |              0.145*** / 1.156 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_NEW_YORK                            |                -0.013 / 0.987 |                -0.010 / 0.990 |                -0.024 / 0.976 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_NORTH_CAROLINA                      |                -0.002 / 0.998 |               0.027** / 1.027 |                 0.014 / 1.014 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_NORTH_DAKOTA                        |              0.223*** / 1.250 |              0.222*** / 1.248 |              0.220*** / 1.246 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_OHIO                                |              0.096*** / 1.100 |              0.093*** / 1.098 |              0.090*** / 1.094 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_OKLAHOMA                            |              0.130*** / 1.139 |              0.130*** / 1.139 |              0.120*** / 1.128 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_OREGON                              |               0.074** / 1.077 |               0.070** / 1.073 |               0.071** / 1.074 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_PENNSYLVANIA                        |              0.131*** / 1.140 |              0.132*** / 1.141 |              0.122*** / 1.130 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_SOUTH_CAROLINA                      |              0.055*** / 1.056 |              0.054*** / 1.055 |              0.056*** / 1.057 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_SOUTH_DAKOTA                        |              0.077*** / 1.081 |              0.076*** / 1.079 |              0.071*** / 1.074 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_TENNESSEE                           |              0.170*** / 1.186 |              0.170*** / 1.185 |              0.174*** / 1.190 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_TEXAS                               |              0.169*** / 1.184 |              0.167*** / 1.182 |              0.164*** / 1.179 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_VERMONT                             |              0.077*** / 1.080 |              0.066*** / 1.068 |              0.067*** / 1.069 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_VIRGINIA                            |                 0.018 / 1.019 |                 0.015 / 1.015 |                 0.011 / 1.011 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_WASHINGTON                          |              0.116*** / 1.123 |              0.114*** / 1.121 |              0.131*** / 1.140 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_WEST_VIRGINIA                       |              -0.037** / 0.964 |             -0.041*** / 0.960 |             -0.050*** / 0.951 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_WISCONSIN                           |              0.039*** / 1.040 |              0.037*** / 1.038 |              0.036*** / 1.036 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_RURAL_WYOMING                             |              0.147*** / 1.158 |              0.144*** / 1.155 |              0.138*** / 1.148 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_SACRAMENTO                                |                0.020* / 1.020 |                0.018* / 1.019 |               0.026** / 1.026 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_SALT_LAKE_CITY                            |              0.120*** / 1.128 |              0.114*** / 1.121 |              0.113*** / 1.120 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_SAN_ANTONIO                               |              0.138*** / 1.148 |              0.133*** / 1.142 |              0.129*** / 1.138 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_SAN_DIEGO                                 |                 0.012 / 1.012 |                 0.010 / 1.010 |                 0.015 / 1.015 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_SAN_FRANCISCO                             |              0.069*** / 1.071 |              0.066*** / 1.068 |              0.073*** / 1.076 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_SEATTLE                                   |              0.109*** / 1.116 |              0.101*** / 1.106 |              0.113*** / 1.120 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_ST_LOUIS                                  |              0.042*** / 1.042 |              0.038*** / 1.038 |              0.041*** / 1.042 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_SURBURBAN_NJ                              |                -0.008 / 0.992 |                -0.010 / 0.990 |                -0.021 / 0.979 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_SURBURBAN_NY                              |              0.101*** / 1.106 |              0.097*** / 1.102 |              0.097*** / 1.102 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_SYRACUSE                                  |              -0.035** / 0.966 |             -0.040*** / 0.961 |             -0.048*** / 0.953 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_TAMPA                                     |              0.103*** / 1.109 |              0.099*** / 1.104 |              0.100*** / 1.105 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_URBAN_NY                                  |              0.173*** / 1.189 |              0.172*** / 1.188 |              0.170*** / 1.186 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| market_WASHINGTON_DC                             |              0.097*** / 1.102 |              0.091*** / 1.095 |              0.085*** / 1.089 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| brand_BUSCH_LIGHT                                |             -0.260*** / 0.771 |             -0.185*** / 0.831 |             -0.149*** / 0.862 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| brand_COORS_LIGHT                                |              -0.005** / 0.995 |                 0.019 / 1.019 |               0.042** / 1.043 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| brand_MILLER_LITE                                |             -0.013*** / 0.987 |              0.080*** / 1.083 |              0.111*** / 1.117 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| brand_NATURAL_LIGHT                              |             -0.319*** / 0.727 |             -0.601*** / 0.548 |             -0.519*** / 0.595 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| container_CAN                                    |             -0.053*** / 0.948 |             -0.052*** / 0.949 |             -0.053*** / 0.948 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| brand_BUSCH_LIGHT_*_log_beer_floz                |                               |                     -0.013*** |                     -0.021*** |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| brand_COORS_LIGHT_*_log_beer_floz                |                               |                        -0.004 |                      -0.008** |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| brand_MILLER_LITE_*_log_beer_floz                |                               |                     -0.017*** |                     -0.023*** |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| brand_NATURAL_LIGHT_*_log_beer_floz              |                               |                      0.052*** |                      0.037*** |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| brand_BUSCH_LIGHT_*_promo_True                   |                               |                               |             -0.253*** / 0.776 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| brand_COORS_LIGHT_*_promo_True                   |                               |                               |             -0.227*** / 0.797 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| brand_MILLER_LITE_*_promo_True                   |                               |                               |             -0.286*** / 0.751 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| brand_NATURAL_LIGHT_*_promo_True                 |                               |                               |             -0.400*** / 0.671 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| promo_True_*_log_beer_floz                       |                               |                               |                     -0.008*** |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| brand_BUSCH_LIGHT_*_promo_True_*_log_beer_floz   |                               |                               |                      0.047*** |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| brand_COORS_LIGHT_*_promo_True_*_log_beer_floz   |                               |                               |                      0.037*** |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| brand_MILLER_LITE_*_promo_True_*_log_beer_floz   |                               |                               |                      0.052*** |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| brand_NATURAL_LIGHT_*_promo_True_*_log_beer_floz |                               |                               |                      0.071*** |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| Intercept                                        |                     -2.117*** |                     -2.093*** |                     -2.111*** |
====================================================================================================================================================
| Observations                                     |                        48,115 |                        48,115 |                        48,115 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| R²                                               |                         0.547 |                         0.552 |                         0.560 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
| RMSE                                             |                         0.170 |                         0.169 |                         0.167 |
+--------------------------------------------------+-------------------------------+-------------------------------+-------------------------------+
----------------------------------------------------------------------------------------------------------------------------------------------------</code></pre>
</div>
</div>
<section id="question-4---rmses-on-test-data" class="level3">
<h3 class="anchored" data-anchor-id="question-4---rmses-on-test-data">Question 4 - RMSEs on Test Data</h3>
<div class="cell" data-outputid="c98ffa1d-79cb-4c95-cf9a-ee6e5b9b4c44" data-execution_count="46">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(compare_rmse([dtest_1, dtest_2, dtest_3], <span class="st">"log_price_floz"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+------+-----------+-----------+-----------+
|      |   Model 1 |   Model 2 |   Model 3 |
+======+===========+===========+===========+
| RMSE |     0.167 |     0.166 |     0.165 |
+------+-----------+-----------+-----------+</code></pre>
</div>
</div>
</section>
</section>
<section id="question-5" class="level2">
<h2 class="anchored" data-anchor-id="question-5">Question 5</h2>
<ul>
<li>Below provides a list of beta esimates and exponential function of those beta estimates from Model 3:
<ul>
<li><p><strong>market_ALBANY</strong> (<span class="math inline">\(\hat{\beta}=0.022^*\)</span>&nbsp;/&nbsp;<span class="math inline">\(e^{\hat{\beta}}=1.023\)</span>)<br>
Ceteris paribus, beer prices in Albany are 2.3&nbsp;% higher than in the Buffalo–Rochester market.</p></li>
<li><p><strong>market_EXURBAN_NY</strong> (<span class="math inline">\(\hat{\beta}=0.112^{***}\)</span>&nbsp;/&nbsp;<span class="math inline">\(e^{\hat{\beta}}=1.119\)</span>)<br>
Ceteris paribus, beer prices in Exurban&nbsp;NY are 11.9&nbsp;% higher than in the Buffalo–Rochester market.</p></li>
<li><p><strong>market_RURAL_NEW_YORK</strong> (<span class="math inline">\(\hat{\beta}=-0.024\)</span>&nbsp;/&nbsp;<span class="math inline">\(e^{\hat{\beta}}=0.976\)</span>)<br>
Ceteris paribus, beer prices in Rural&nbsp;NY are not statistically different than in the Buffalo–Rochester market.</p></li>
<li><p><strong>market_SUBURBAN_NY</strong> (<span class="math inline">\(\hat{\beta}=0.097^{***}\)</span>&nbsp;/&nbsp;<span class="math inline">\(e^{\hat{\beta}}=1.102\)</span>)<br>
Ceteris paribus, beer prices in Suburban&nbsp;NY are 10.2&nbsp;% higher than in the Buffalo–Rochester market.</p></li>
<li><p><strong>market_SYRACUSE</strong> (<span class="math inline">\(\hat{\beta}=-0.048^{***}\)</span>&nbsp;/&nbsp;<span class="math inline">\(e^{\hat{\beta}}=0.953\)</span>)<br>
Ceteris paribus, beer prices in Syracuse are 4.7&nbsp;% lower than in the Buffalo–Rochester market.</p></li>
<li><p><strong>market_URBAN_NY</strong> (<span class="math inline">\(\hat{\beta}=0.170^{***}\)</span>&nbsp;/&nbsp;<span class="math inline">\(e^{\hat{\beta}}=1.186\)</span>)<br>
Ceteris paribus, beer prices in Urban&nbsp;NY are 18.6&nbsp;% higher than in the Buffalo–Rochester market.</p></li>
</ul></li>
</ul>
</section>
<section id="question-6" class="level2">
<h2 class="anchored" data-anchor-id="question-6">Question 6</h2>
<ul>
<li>We should focus on the beta esimates for predictors with <span class="math inline">\(\log(beer floz)\)</span> to calculate the inverse price elasticity of beer demand across brands.</li>
</ul>
<table class="table">
<colgroup>
<col style="width: 45%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th>Predictor</th>
<th style="text-align: right;">Model&nbsp;1</th>
<th style="text-align: right;">Model&nbsp;2</th>
<th style="text-align: right;">Model&nbsp;3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>log_beer_floz</td>
<td style="text-align: right;">-0.142***</td>
<td style="text-align: right;">-0.146***</td>
<td style="text-align: right;">-0.140***</td>
</tr>
<tr class="even">
<td>brand_BUSCH_LIGHT_*_log_beer_floz</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">-0.013***</td>
<td style="text-align: right;">-0.021***</td>
</tr>
<tr class="odd">
<td>brand_COORS_LIGHT_*_log_beer_floz</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">-0.004</td>
<td style="text-align: right;">-0.008**</td>
</tr>
<tr class="even">
<td>brand_MILLER_LITE_*_log_beer_floz</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">-0.017***</td>
<td style="text-align: right;">-0.023***</td>
</tr>
<tr class="odd">
<td>brand_NATURAL_LIGHT_*_log_beer_floz</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">0.052***</td>
<td style="text-align: right;">0.037***</td>
</tr>
<tr class="even">
<td>promo_True_*_log_beer_floz</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">-0.008***</td>
</tr>
<tr class="odd">
<td>brand_BUSCH_LIGHT_<em><em>promo_True</em></em>_log_beer_floz</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">0.047***</td>
</tr>
<tr class="even">
<td>brand_COORS_LIGHT_<em><em>promo_True</em></em>_log_beer_floz</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">0.037***</td>
</tr>
<tr class="odd">
<td>brand_MILLER_LITE_<em><em>promo_True</em></em>_log_beer_floz</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">0.052***</td>
</tr>
<tr class="even">
<td>brand_NATURAL_LIGHT_<em><em>promo_True</em></em>_log_beer_floz</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">0.071***</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 8%">
<col style="width: 5%">
<col style="width: 21%">
<col style="width: 21%">
<col style="width: 43%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">Model&nbsp;1</th>
<th>Model&nbsp;2</th>
<th>Model&nbsp;3 (no Promo)</th>
<th>Model&nbsp;3 (with Promo)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>BUD</strong></td>
<td style="text-align: right;">-0.142</td>
<td>-0.146</td>
<td>-0.140</td>
<td>-0.148&nbsp;<br> =&nbsp;−0.140&nbsp;−&nbsp;0.008</td>
</tr>
<tr class="even">
<td><strong>BUSCH</strong></td>
<td style="text-align: right;">-0.142</td>
<td>-0.159&nbsp;<br> =&nbsp;−0.146&nbsp;−&nbsp;0.013</td>
<td>-0.161&nbsp;<br> =&nbsp;−0.140&nbsp;−&nbsp;0.021</td>
<td>-0.122&nbsp;<br> =&nbsp;−0.140&nbsp;−&nbsp;0.021&nbsp;−&nbsp;0.008&nbsp;+&nbsp;0.047</td>
</tr>
<tr class="odd">
<td><strong>COORS</strong></td>
<td style="text-align: right;">-0.142</td>
<td>-0.146&nbsp;<br> =&nbsp;−0.146&nbsp;−&nbsp;0</td>
<td>-0.148&nbsp;<br> =&nbsp;−0.140&nbsp;−&nbsp;0.008</td>
<td>-0.119&nbsp;<br> =&nbsp;−0.140&nbsp;−&nbsp;0.008&nbsp;−&nbsp;0.008&nbsp;+&nbsp;0.037</td>
</tr>
<tr class="even">
<td><strong>MILLER</strong></td>
<td style="text-align: right;">-0.142</td>
<td>-0.163&nbsp;<br> =&nbsp;−0.146&nbsp;−&nbsp;0.017</td>
<td>-0.163&nbsp;<br> =&nbsp;−0.140&nbsp;−&nbsp;0.023</td>
<td>-0.119&nbsp;<br> =&nbsp;−0.140&nbsp;−&nbsp;0.023&nbsp;−&nbsp;0.008&nbsp;+&nbsp;0.052</td>
</tr>
<tr class="odd">
<td><strong>NATURAL</strong></td>
<td style="text-align: right;">-0.142</td>
<td>-0.094&nbsp;<br> =&nbsp;−0.146&nbsp;+&nbsp;0.052</td>
<td>-0.103&nbsp;<br> =&nbsp;−0.140&nbsp;+&nbsp;0.037</td>
<td>-0.040&nbsp;<br> =&nbsp;−0.140&nbsp;+&nbsp;0.037&nbsp;−&nbsp;0.008&nbsp;+&nbsp;0.071</td>
</tr>
</tbody>
</table>
<ul>
<li>Model 1
<ul>
<li>A 1% increase in sales volume (across any of the five brands) is associated with a 0.142% decrease in price.</li>
</ul></li>
<li>Model 2
<ul>
<li>A 1% increase in BUD sales volume is associated with a 0.146% decrease in its price.</li>
<li>A 1% increase in BUSCH sales volume is associated with a 0.159 decrease in its price.</li>
<li>A 1% increase in COORS sales volume is associated with a 0.146% decrease in its price.</li>
<li>A 1% increase in MILLER sales volume is associated with a 0.163% decrease in its price.</li>
<li>A 1% increase in NATURAL sales volume is associated with a 0.094% decrease in its price.</li>
</ul></li>
<li>Model 3 (no Promo)
<ul>
<li>A 1% increase in BUD sales volume is associated with a 0.140% decrease in its price.</li>
<li>A 1% increase in BUSCH sales volume is associated with a 0.161% decrease in its price.</li>
<li>A 1% increase in COORS sales volume is associated with a 0.148% decrease in its price.</li>
<li>A 1% increase in MILLER sales volume is associated with a 0.163% decrease in its price.</li>
<li>A 1% increase in NATURAL sales volume is associated with a 0.103% decrease in its price.</li>
</ul></li>
<li>Model 3 (with Promo)
<ul>
<li>A 1% increase in BUD sales volume is associated with a 0.148% decrease in its price.</li>
<li>A 1% increase in BUSCH sales volume is associated with a 0.122% decrease in its price.</li>
<li>A 1% increase in COORS sales volume is associated with a 0.119% decrease in its price.</li>
<li>A 1% increase in MILLER sales volume is associated with a 0.119% decrease in its price.</li>
<li>A 1% increase in NATURAL sales volume is associated with a 0.040% decrease in its price.</li>
</ul></li>
</ul>
<div class="cell" data-outputid="a59e69dc-42c0-4060-cbfd-63a0e64d8df6" data-execution_count="35">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Slopes (inverse elasticities)</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>model1_slope <span class="op">=</span> <span class="op">-</span><span class="fl">0.142</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>model2_slopes <span class="op">=</span> {</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Bud'</span>: <span class="op">-</span><span class="fl">0.146</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Busch'</span>: <span class="op">-</span><span class="fl">0.159</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Coors'</span>: <span class="op">-</span><span class="fl">0.146</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Miller'</span>: <span class="op">-</span><span class="fl">0.163</span>,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Natural'</span>: <span class="op">-</span><span class="fl">0.094</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>model3_full_slopes <span class="op">=</span> {</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Bud'</span>: <span class="op">-</span><span class="fl">0.140</span>,</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Busch'</span>: <span class="op">-</span><span class="fl">0.161</span>,</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Coors'</span>: <span class="op">-</span><span class="fl">0.148</span>,</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Miller'</span>: <span class="op">-</span><span class="fl">0.163</span>,</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Natural'</span>: <span class="op">-</span><span class="fl">0.103</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>model3_promo_slopes <span class="op">=</span> {</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Bud'</span>: <span class="op">-</span><span class="fl">0.148</span>,</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Busch'</span>: <span class="op">-</span><span class="fl">0.122</span>,</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Coors'</span>: <span class="op">-</span><span class="fl">0.119</span>,</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Miller'</span>: <span class="op">-</span><span class="fl">0.096</span>,</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Natural'</span>: <span class="op">-</span><span class="fl">0.077</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Create range of log(sales) values</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">100</span>)</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up a 2x2 grid of subplots</span></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>), sharex<span class="op">=</span><span class="va">True</span>, sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1: Common Elasticity</span></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axes[<span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>ax.plot(x, model1_slope <span class="op">*</span> x, color<span class="op">=</span><span class="st">'tab:blue'</span>, label<span class="op">=</span><span class="st">'All Brands'</span>)</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Model&nbsp;1: Common Elasticity'</span>)</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'log(sales)'</span>)</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'log(price)'</span>)</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>)</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2: Brand-Specific Elasticity</span></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axes[<span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> brand, slope <span class="kw">in</span> model2_slopes.items():</span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a>    ax.plot(x, slope <span class="op">*</span> x, label<span class="op">=</span>brand)</span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Model&nbsp;2: Brand-Specific'</span>)</span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'log(sales)'</span>)</span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>)</span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 3: Full-Price (No Promo)</span></span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axes[<span class="dv">1</span>, <span class="dv">0</span>]</span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> brand, slope <span class="kw">in</span> model3_full_slopes.items():</span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a>    ax.plot(x, slope <span class="op">*</span> x, label<span class="op">=</span>brand)</span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Model&nbsp;3: Full-Price'</span>)</span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'log(sales)'</span>)</span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'log(price)'</span>)</span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>)</span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 3: Promo-Price</span></span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axes[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> brand, slope <span class="kw">in</span> model3_promo_slopes.items():</span>
<span id="cb33-62"><a href="#cb33-62" aria-hidden="true" tabindex="-1"></a>    ax.plot(x, slope <span class="op">*</span> x, label<span class="op">=</span>brand)</span>
<span id="cb33-63"><a href="#cb33-63" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Model&nbsp;3: Promotional Price'</span>)</span>
<span id="cb33-64"><a href="#cb33-64" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'log(sales)'</span>)</span>
<span id="cb33-65"><a href="#cb33-65" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>)</span>
<span id="cb33-66"><a href="#cb33-66" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb33-67"><a href="#cb33-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-68"><a href="#cb33-68" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb33-69"><a href="#cb33-69" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="danl_320_hw2_linear_regression_beer_files/figure-html/cell-24-output-1.png" class="img-fluid"></p>
</div>
</div>
<ul>
<li><strong>Magnitude</strong> (<strong>|coefficient|</strong>): Larger absolute values mean more price sensitivity (higher elasticity).</li>
<li><strong>Promotions</strong>: For most brands, promotions reduce inverse coefficients (in absolute terms), implying lower sensitivity of price to volume during deals—firms can sell more with smaller price cuts.</li>
<li><strong>Brand differences</strong>: Miller and Busch tend to be the most elastic brands, while Natural Light is consistently the least elastic (i.e.&nbsp;its drinkers are relatively price‐insensitive, especially on promotion).
<ul>
<li>Given a fixed price increase, <strong>Natural Light</strong> experiences the largest decline in sales volume.</li>
<li>For the same price increase without promotion, <strong>Miller Lite</strong> and <strong>Busch Light</strong> exhibit the smallest declines in sales volume.</li>
<li>For the same price decrease with promotion, <strong>Bud Light</strong> shows the smallest increase in sales volume.</li>
</ul></li>
</ul>
</section>
<section id="question-7" class="level2">
<h2 class="anchored" data-anchor-id="question-7">Question 7</h2>
</section>
<section id="residual-plots" class="level2">
<h2 class="anchored" data-anchor-id="residual-plots">Residual Plots</h2>
<div class="cell" data-outputid="48af4324-6a8e-4363-f0f5-a26b7e8fa1d5">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>residual_plot(dtest_1, <span class="st">"log_price_floz"</span>, <span class="st">"Model 1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="danl_320_hw2_linear_regression_beer_files/figure-html/cell-25-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-outputid="f403ec87-5cba-4d91-9bca-79a27106522a">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>residual_plot(dtest_2, <span class="st">"log_price_floz"</span>, <span class="st">"Model 2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="danl_320_hw2_linear_regression_beer_files/figure-html/cell-26-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-outputid="e116d13b-4640-41b5-c3e2-88fc91a3cd2d">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>residual_plot(dtest_3, <span class="st">"log_price_floz"</span>, <span class="st">"Model 3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="danl_320_hw2_linear_regression_beer_files/figure-html/cell-27-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="question-8" class="level2">
<h2 class="anchored" data-anchor-id="question-8">Question 8</h2>
<p>I prefer Model 3 for three simple reasons:</p>
<ol type="1">
<li>Realistic Market Setting</li>
</ol>
<ul>
<li>It captures both the unique sensitivity of each brand and how that sensitivity changes when a beer is on promotion.</li>
</ul>
<ol start="2" type="1">
<li>Practical Pricing Strategies</li>
</ol>
<ul>
<li>By distinguishing full-price from promotional periods, it tells you exactly how much to adjust each brand’s price under each scenario.</li>
</ul>
<ol start="3" type="1">
<li>Better Fit with the lowest MSE on test data</li>
</ol>
<ul>
<li>Allowing elasticities to vary by brand and promotion status typically explains sales patterns more accurately than the cruder alternatives.</li>
</ul>
<p>In short, Model 3 reflects realistic market settings with brand heterogeneity and promotion effect, along with the best prediction quality.</p>


</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
<script src="https://giscus.app/client.js" data-repo="bcdanl/320" data-repo-id="R_kgDONtaKIQ" data-category="General" data-category-id="DIC_kwDONtaKIc4CmOi-" data-mapping="title" data-reactions-enabled="0" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme" data-lang="en" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">powered with github, quarto, and rstudio<br>byeong-hak choe, 2025</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>
<div id="scroll-padding"></div>
<script src="../assets/js/site.js"></script>
<script src="../assets/js/posts.js"></script>



</body></html>