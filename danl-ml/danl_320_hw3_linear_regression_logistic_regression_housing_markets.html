<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Byeong-Hak Choe">
<meta name="dcterms.date" content="2025-03-26">

<title>Homework 3 | Byeong-Hak Choe</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.css">
<link rel="stylesheet" href="../assets/css/font.css">
<meta property="og:title" content="Homework 3 | Byeong-Hak Choe">
<meta property="og:description" content="American Housing Survey 2004">
<meta property="og:image" content="/assets/img/posts.png">
<meta property="og:site-name" content="Home">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../img/geneseo-logo-squared.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Home</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../blog-listing.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/bcdanl/320-code" rel="" target="_blank">
 <span class="menu-text">Class Code</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../listing-danl-320-ml.html" rel="" target="">
 <span class="menu-text">ML Notebook</span></a>
  </li>  
  <li class="dropdown-header">
 <span class="menu-text"> </span></li>
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="3">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#libraries" id="toc-libraries" class="nav-link active" data-scroll-target="#libraries">Libraries</a></li>
  <li><a href="#udfs" id="toc-udfs" class="nav-link" data-scroll-target="#udfs">UDFs</a>
  <ul>
  <li><a href="#regression_table" id="toc-regression_table" class="nav-link" data-scroll-target="#regression_table">regression_table()</a></li>
  <li><a href="#add_dummy_variables" id="toc-add_dummy_variables" class="nav-link" data-scroll-target="#add_dummy_variables">add_dummy_variables()</a></li>
  <li><a href="#add_interaction_terms" id="toc-add_interaction_terms" class="nav-link" data-scroll-target="#add_interaction_terms">add_interaction_terms()</a></li>
  <li><a href="#compare_reg_models" id="toc-compare_reg_models" class="nav-link" data-scroll-target="#compare_reg_models">compare_reg_models()</a></li>
  <li><a href="#compare_rmse" id="toc-compare_rmse" class="nav-link" data-scroll-target="#compare_rmse">compare_rmse()</a></li>
  <li><a href="#residual_plot" id="toc-residual_plot" class="nav-link" data-scroll-target="#residual_plot">residual_plot()</a></li>
  <li><a href="#marginal_effects" id="toc-marginal_effects" class="nav-link" data-scroll-target="#marginal_effects">marginal_effects()</a></li>
  </ul></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a>
  <ul>
  <li><a href="#adding-variables-using-pandas" id="toc-adding-variables-using-pandas" class="nav-link" data-scroll-target="#adding-variables-using-pandas">Adding Variables using Pandas</a></li>
  <li><a href="#pyspark-dataframe" id="toc-pyspark-dataframe" class="nav-link" data-scroll-target="#pyspark-dataframe">PySpark DataFrame</a></li>
  <li><a href="#train-test-split" id="toc-train-test-split" class="nav-link" data-scroll-target="#train-test-split">Train-Test Split</a></li>
  <li><a href="#adding-dummies" id="toc-adding-dummies" class="nav-link" data-scroll-target="#adding-dummies">Adding Dummies</a></li>
  <li><a href="#adding-interactions" id="toc-adding-interactions" class="nav-link" data-scroll-target="#adding-interactions">Adding Interactions</a></li>
  </ul></li>
  <li><a href="#q1---visualization" id="toc-q1---visualization" class="nav-link" data-scroll-target="#q1---visualization">Q1 - Visualization</a>
  <ul>
  <li><a href="#correlation-heatmap" id="toc-correlation-heatmap" class="nav-link" data-scroll-target="#correlation-heatmap">Correlation Heatmap</a></li>
  </ul></li>
  <li><a href="#q2---linear-regression-i" id="toc-q2---linear-regression-i" class="nav-link" data-scroll-target="#q2---linear-regression-i">Q2 - Linear Regression I</a></li>
  <li><a href="#q3---linear-regression-ii" id="toc-q3---linear-regression-ii" class="nav-link" data-scroll-target="#q3---linear-regression-ii">Q3 - Linear Regression II</a></li>
  <li><a href="#q4---logistic-regression---i" id="toc-q4---logistic-regression---i" class="nav-link" data-scroll-target="#q4---logistic-regression---i">Q4 - Logistic Regression - I</a>
  <ul>
  <li><a href="#marginal-effects" id="toc-marginal-effects" class="nav-link" data-scroll-target="#marginal-effects">Marginal Effects</a></li>
  </ul></li>
  <li><a href="#q5---logistic-regression-ii" id="toc-q5---logistic-regression-ii" class="nav-link" data-scroll-target="#q5---logistic-regression-ii">Q5 - Logistic Regression II</a>
  <ul>
  <li><a href="#marginal-effects-1" id="toc-marginal-effects-1" class="nav-link" data-scroll-target="#marginal-effects-1">Marginal Effects</a></li>
  </ul></li>
  <li><a href="#q6---logistic-regression-with-sub-samples" id="toc-q6---logistic-regression-with-sub-samples" class="nav-link" data-scroll-target="#q6---logistic-regression-with-sub-samples">Q6 - Logistic Regression with Sub-samples</a>
  <ul>
  <li><a href="#over-175k-value" id="toc-over-175k-value" class="nav-link" data-scroll-target="#over-175k-value">Over 175k Value</a>
  <ul>
  <li><a href="#marginal-effects-2" id="toc-marginal-effects-2" class="nav-link" data-scroll-target="#marginal-effects-2">Marginal Effects</a></li>
  <li><a href="#classification" id="toc-classification" class="nav-link" data-scroll-target="#classification">Classification</a></li>
  </ul></li>
  <li><a href="#under-175k-value" id="toc-under-175k-value" class="nav-link" data-scroll-target="#under-175k-value">Under 175k Value</a>
  <ul>
  <li><a href="#marginal-effects-3" id="toc-marginal-effects-3" class="nav-link" data-scroll-target="#marginal-effects-3">Marginal Effects</a></li>
  <li><a href="#classification-1" id="toc-classification-1" class="nav-link" data-scroll-target="#classification-1">Classification</a></li>
  </ul></li>
  <li><a href="#comparison" id="toc-comparison" class="nav-link" data-scroll-target="#comparison">Comparison</a>
  <ul>
  <li><a href="#residual-deviance" id="toc-residual-deviance" class="nav-link" data-scroll-target="#residual-deviance">Residual Deviance</a></li>
  <li><a href="#marginal-effects-4" id="toc-marginal-effects-4" class="nav-link" data-scroll-target="#marginal-effects-4">Marginal Effects</a></li>
  <li><a href="#classification-2" id="toc-classification-2" class="nav-link" data-scroll-target="#classification-2">Classification</a>
  <ul>
  <li><a href="#choosing-the-right-threshold" id="toc-choosing-the-right-threshold" class="nav-link" data-scroll-target="#choosing-the-right-threshold">Choosing the Right Threshold</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Homework 3</h1>
<p class="subtitle lead">American Housing Survey 2004</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Byeong-Hak Choe </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 26, 2025</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">April 19, 2025</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="libraries" class="level1">
<h1>Libraries</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> google.colab <span class="im">import</span> data_table</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>data_table.enable_dataframe_formatter()</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tabulate <span class="im">import</span> tabulate  <span class="co"># for table summary</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> stats</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm  <span class="co"># for lowess smoothing</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> precision_recall_curve</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_curve</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> SparkSession</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.functions <span class="im">import</span> rand, col, <span class="bu">pow</span>, mean, avg, when, log, sqrt, exp</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.feature <span class="im">import</span> VectorAssembler</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.regression <span class="im">import</span> LinearRegression, GeneralizedLinearRegression</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.evaluation <span class="im">import</span> BinaryClassificationEvaluator</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>spark <span class="op">=</span> SparkSession.builder.master(<span class="st">"local[*]"</span>).getOrCreate()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="udfs" class="level1">
<h1>UDFs</h1>
<section id="regression_table" class="level2">
<h2 class="anchored" data-anchor-id="regression_table">regression_table()</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> regression_table(model, assembler):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Creates a formatted regression table from a fitted LinearRegression model and its VectorAssembler.</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">    If the model’s labelCol (retrieved using getLabelCol()) starts with "log", an extra column showing np.exp(coeff)</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">    is added immediately after the beta estimate column for predictor rows. Additionally, np.exp() of the 95% CI</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Lower and Upper bounds is also added unless the predictor's name includes "log_". The Intercept row does not</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">    include exponentiated values.</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">    When labelCol starts with "log", the columns are ordered as:</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">        y: [label] | Beta | Exp(Beta) | Sig. | Std. Error | p-value | 95% CI Lower | 95% CI Upper | Exp(95% CI Lower) | Exp(95% CI Upper)</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">    Otherwise, the columns are:</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">        y: [label] | Beta | Sig. | Std. Error | p-value | 95% CI Lower | 95% CI Upper</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">        model: A fitted LinearRegression model (with a .summary attribute and a labelCol).</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co">        assembler: The VectorAssembler used to assemble the features for the model.</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co">        A formatted string containing the regression table.</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Determine if we should display exponential values for coefficients.</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    is_log <span class="op">=</span> model.getLabelCol().lower().startswith(<span class="st">"log"</span>)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract coefficients and standard errors as NumPy arrays.</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    coeffs <span class="op">=</span> model.coefficients.toArray()</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    std_errors_all <span class="op">=</span> np.array(model.summary.coefficientStandardErrors)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if the intercept's standard error is included (one extra element).</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(std_errors_all) <span class="op">==</span> <span class="bu">len</span>(coeffs) <span class="op">+</span> <span class="dv">1</span>:</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>        intercept_se <span class="op">=</span> std_errors_all[<span class="dv">0</span>]</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>        std_errors <span class="op">=</span> std_errors_all[<span class="dv">1</span>:]</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>        intercept_se <span class="op">=</span> <span class="va">None</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>        std_errors <span class="op">=</span> std_errors_all</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use provided tValues and pValues.</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> model.summary.numInstances <span class="op">-</span> <span class="bu">len</span>(coeffs) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    t_critical <span class="op">=</span> stats.t.ppf(<span class="fl">0.975</span>, df)</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    p_values <span class="op">=</span> model.summary.pValues</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Helper: significance stars.</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> significance_stars(p):</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> p <span class="op">&lt;</span> <span class="fl">0.01</span>:</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"***"</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> p <span class="op">&lt;</span> <span class="fl">0.05</span>:</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"**"</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> p <span class="op">&lt;</span> <span class="fl">0.1</span>:</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"*"</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">""</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build table rows for each feature.</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    table <span class="op">=</span> []</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> feature, beta, se, p <span class="kw">in</span> <span class="bu">zip</span>(assembler.getInputCols(), coeffs, std_errors, p_values):</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>        ci_lower <span class="op">=</span> beta <span class="op">-</span> t_critical <span class="op">*</span> se</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>        ci_upper <span class="op">=</span> beta <span class="op">+</span> t_critical <span class="op">*</span> se</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if predictor contains "log_" to determine if exponentiation should be applied</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>        apply_exp <span class="op">=</span> is_log <span class="kw">and</span> <span class="st">"log_"</span> <span class="kw">not</span> <span class="kw">in</span> feature.lower()</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>        exp_beta <span class="op">=</span> np.exp(beta) <span class="cf">if</span> apply_exp <span class="cf">else</span> <span class="st">""</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>        exp_ci_lower <span class="op">=</span> np.exp(ci_lower) <span class="cf">if</span> apply_exp <span class="cf">else</span> <span class="st">""</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>        exp_ci_upper <span class="op">=</span> np.exp(ci_upper) <span class="cf">if</span> apply_exp <span class="cf">else</span> <span class="st">""</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> is_log:</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>            table.append([</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>                feature,            <span class="co"># Predictor name</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>                beta,               <span class="co"># Beta estimate</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>                exp_beta,           <span class="co"># Exponential of beta (or blank)</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>                significance_stars(p),</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>                se,</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>                p,</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>                ci_lower,</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>                ci_upper,</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>                exp_ci_lower,       <span class="co"># Exponential of 95% CI lower bound</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>                exp_ci_upper        <span class="co"># Exponential of 95% CI upper bound</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>            ])</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>            table.append([</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>                feature,</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>                beta,</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>                significance_stars(p),</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>                se,</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>                p,</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>                ci_lower,</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>                ci_upper</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>            ])</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process intercept.</span></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> intercept_se <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>        intercept_p <span class="op">=</span> model.summary.pValues[<span class="dv">0</span>] <span class="cf">if</span> model.summary.pValues <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>        intercept_sig <span class="op">=</span> significance_stars(intercept_p)</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>        ci_intercept_lower <span class="op">=</span> model.intercept <span class="op">-</span> t_critical <span class="op">*</span> intercept_se</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>        ci_intercept_upper <span class="op">=</span> model.intercept <span class="op">+</span> t_critical <span class="op">*</span> intercept_se</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>        intercept_sig <span class="op">=</span> <span class="st">""</span></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>        ci_intercept_lower <span class="op">=</span> <span class="st">""</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>        ci_intercept_upper <span class="op">=</span> <span class="st">""</span></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>        intercept_se <span class="op">=</span> <span class="st">""</span></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> is_log:</span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>        table.append([</span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Intercept"</span>,</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>            model.intercept,</span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>            <span class="st">""</span>,                    <span class="co"># Removed np.exp(model.intercept)</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>            intercept_sig,</span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>            intercept_se,</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>            <span class="st">""</span>,</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>            ci_intercept_lower,</span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>            <span class="st">""</span>,</span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>            ci_intercept_upper,</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>            <span class="st">""</span></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>        table.append([</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Intercept"</span>,</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>            model.intercept,</span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>            intercept_sig,</span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>            intercept_se,</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>            <span class="st">""</span>,</span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>            ci_intercept_lower,</span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>            ci_intercept_upper</span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Append overall model metrics.</span></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> is_log:</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>        table.append([<span class="st">"Observations"</span>, model.summary.numInstances, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>])</span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>        table.append([<span class="st">"R²"</span>, model.summary.r2, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>])</span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>        table.append([<span class="st">"RMSE"</span>, model.summary.rootMeanSquaredError, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>])</span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>        table.append([<span class="st">"Observations"</span>, model.summary.numInstances, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>])</span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>        table.append([<span class="st">"R²"</span>, model.summary.r2, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>])</span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>        table.append([<span class="st">"RMSE"</span>, model.summary.rootMeanSquaredError, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>])</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Format the table rows.</span></span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>    formatted_table <span class="op">=</span> []</span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> table:</span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>        formatted_row <span class="op">=</span> []</span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, item <span class="kw">in</span> <span class="bu">enumerate</span>(row):</span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Format Observations as integer with commas.</span></span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> row[<span class="dv">0</span>] <span class="op">==</span> <span class="st">"Observations"</span> <span class="kw">and</span> i <span class="op">==</span> <span class="dv">1</span> <span class="kw">and</span> <span class="bu">isinstance</span>(item, (<span class="bu">int</span>, <span class="bu">float</span>, np.floating)) <span class="kw">and</span> item <span class="op">!=</span> <span class="st">""</span>:</span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>                formatted_row.append(<span class="ss">f"</span><span class="sc">{</span><span class="bu">int</span>(item)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(item, (<span class="bu">int</span>, <span class="bu">float</span>, np.floating)) <span class="kw">and</span> item <span class="op">!=</span> <span class="st">""</span>:</span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> is_log:</span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># When is_log, the columns are:</span></span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># 0: Metric, 1: Beta, 2: Exp(Beta), 3: Sig, 4: Std. Error, 5: p-value,</span></span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># 6: 95% CI Lower, 7: 95% CI Upper, 8: Exp(95% CI Lower), 9: Exp(95% CI Upper).</span></span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> i <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>]:</span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>                        formatted_row.append(<span class="ss">f"</span><span class="sc">{</span>item<span class="sc">:,</span><span class="fl">.3</span><span class="er">f</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> i <span class="op">==</span> <span class="dv">5</span>:</span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>                        formatted_row.append(<span class="ss">f"</span><span class="sc">{</span>item<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>                        formatted_row.append(<span class="ss">f"</span><span class="sc">{</span>item<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># When not is_log, the columns are:</span></span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># 0: Metric, 1: Beta, 2: Sig, 3: Std. Error, 4: p-value, 5: 95% CI Lower, 6: 95% CI Upper.</span></span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> i <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">6</span>]:</span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>                        formatted_row.append(<span class="ss">f"</span><span class="sc">{</span>item<span class="sc">:,</span><span class="fl">.3</span><span class="er">f</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> i <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>                        formatted_row.append(<span class="ss">f"</span><span class="sc">{</span>item<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a>                        formatted_row.append(<span class="ss">f"</span><span class="sc">{</span>item<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>                formatted_row.append(item)</span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a>        formatted_table.append(formatted_row)</span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set header and column alignment based on whether label starts with "log"</span></span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> is_log:</span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>        headers <span class="op">=</span> [</span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"y: </span><span class="sc">{</span>model<span class="sc">.</span>getLabelCol()<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Beta"</span>, <span class="st">"Exp(Beta)"</span>, <span class="st">"Sig."</span>, <span class="st">"Std. Error"</span>, <span class="st">"p-value"</span>,</span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a>            <span class="st">"95% CI Lower"</span>, <span class="st">"95% CI Upper"</span>, <span class="st">"Exp(95% CI Lower)"</span>, <span class="st">"Exp(95% CI Upper)"</span></span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>        colalign <span class="op">=</span> (<span class="st">"left"</span>, <span class="st">"right"</span>, <span class="st">"right"</span>, <span class="st">"center"</span>, <span class="st">"right"</span>, <span class="st">"right"</span>, <span class="st">"right"</span>, <span class="st">"right"</span>, <span class="st">"right"</span>, <span class="st">"right"</span>)</span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a>        headers <span class="op">=</span> [<span class="ss">f"y: </span><span class="sc">{</span>model<span class="sc">.</span>getLabelCol()<span class="sc">}</span><span class="ss">"</span>, <span class="st">"Beta"</span>, <span class="st">"Sig."</span>, <span class="st">"Std. Error"</span>, <span class="st">"p-value"</span>, <span class="st">"95% CI Lower"</span>, <span class="st">"95% CI Upper"</span>]</span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a>        colalign <span class="op">=</span> (<span class="st">"left"</span>, <span class="st">"right"</span>, <span class="st">"center"</span>, <span class="st">"right"</span>, <span class="st">"right"</span>, <span class="st">"right"</span>, <span class="st">"right"</span>)</span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a>    table_str <span class="op">=</span> tabulate(</span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a>        formatted_table,</span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a>        headers<span class="op">=</span>headers,</span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a>        tablefmt<span class="op">=</span><span class="st">"pretty"</span>,</span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a>        colalign<span class="op">=</span>colalign</span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Insert a dashed line after the Intercept row.</span></span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> table_str.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a>    dash_line <span class="op">=</span> <span class="st">'-'</span> <span class="op">*</span> <span class="bu">len</span>(lines[<span class="dv">0</span>])</span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, line <span class="kw">in</span> <span class="bu">enumerate</span>(lines):</span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"Intercept"</span> <span class="kw">in</span> line <span class="kw">and</span> <span class="kw">not</span> line.strip().startswith(<span class="st">'+'</span>):</span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a>            lines.insert(i<span class="op">+</span><span class="dv">1</span>, dash_line)</span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(lines)</span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage:</span></span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a><span class="co"># print(regression_table(model_1, assembler_1))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="add_dummy_variables" class="level2">
<h2 class="anchored" data-anchor-id="add_dummy_variables">add_dummy_variables()</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_dummy_variables(var_name, reference_level, category_order<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Creates dummy variables for the specified column in the global DataFrames dtrain and dtest.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Allows manual setting of category order.</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">        var_name (str): The name of the categorical column (e.g., "borough_name").</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">        reference_level (int): Index of the category to be used as the reference (dummy omitted).</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">        category_order (list, optional): List of categories in the desired order. If None, categories are sorted.</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">        dummy_cols (list): List of dummy column names excluding the reference category.</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">        ref_category (str): The category chosen as the reference.</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> dtrain, dtest</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get distinct categories from the training set.</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    categories <span class="op">=</span> dtrain.select(var_name).distinct().rdd.flatMap(<span class="kw">lambda</span> x: x).collect()</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert booleans to strings if present.</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    categories <span class="op">=</span> [<span class="bu">str</span>(c) <span class="cf">if</span> <span class="bu">isinstance</span>(c, <span class="bu">bool</span>) <span class="cf">else</span> c <span class="cf">for</span> c <span class="kw">in</span> categories]</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use manual category order if provided; otherwise, sort categories.</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> category_order:</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure all categories are present in the user-defined order</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        missing <span class="op">=</span> <span class="bu">set</span>(categories) <span class="op">-</span> <span class="bu">set</span>(category_order)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> missing:</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"These categories are missing from your custom order: </span><span class="sc">{</span>missing<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>        categories <span class="op">=</span> category_order</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>        categories <span class="op">=</span> <span class="bu">sorted</span>(categories)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validate reference_level</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> reference_level <span class="op">&lt;</span> <span class="dv">0</span> <span class="kw">or</span> reference_level <span class="op">&gt;=</span> <span class="bu">len</span>(categories):</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"reference_level must be between 0 and </span><span class="sc">{</span><span class="bu">len</span>(categories) <span class="op">-</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define the reference category</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    ref_category <span class="op">=</span> categories[reference_level]</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Reference category (dummy omitted):"</span>, ref_category)</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create dummy variables for all categories</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> cat <span class="kw">in</span> categories:</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>        dummy_col_name <span class="op">=</span> var_name <span class="op">+</span> <span class="st">"_"</span> <span class="op">+</span> <span class="bu">str</span>(cat).replace(<span class="st">" "</span>, <span class="st">"_"</span>)</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>        dtrain <span class="op">=</span> dtrain.withColumn(dummy_col_name, when(col(var_name) <span class="op">==</span> cat, <span class="dv">1</span>).otherwise(<span class="dv">0</span>))</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>        dtest <span class="op">=</span> dtest.withColumn(dummy_col_name, when(col(var_name) <span class="op">==</span> cat, <span class="dv">1</span>).otherwise(<span class="dv">0</span>))</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># List of dummy columns, excluding the reference category</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    dummy_cols <span class="op">=</span> [var_name <span class="op">+</span> <span class="st">"_"</span> <span class="op">+</span> <span class="bu">str</span>(cat).replace(<span class="st">" "</span>, <span class="st">"_"</span>) <span class="cf">for</span> cat <span class="kw">in</span> categories <span class="cf">if</span> cat <span class="op">!=</span> ref_category]</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dummy_cols, ref_category</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage without category_order:</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="co"># dummy_cols_year, ref_category_year = add_dummy_variables('year', 0)</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage with category_order:</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a><span class="co"># custom_order_wkday = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday']</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a><span class="co"># dummy_cols_wkday, ref_category_wkday = add_dummy_variables('wkday', reference_level=0, category_order = custom_order_wkday)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="add_interaction_terms" class="level2">
<h2 class="anchored" data-anchor-id="add_interaction_terms">add_interaction_terms()</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_interaction_terms(var_list1, var_list2, var_list3<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Creates interaction term columns in the global DataFrames dtrain and dtest.</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">    For two sets of variable names (which may represent categorical (dummy) or continuous variables),</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">    this function creates two-way interactions by multiplying each variable in var_list1 with each</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">    variable in var_list2.</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Optionally, if a third list of variable names (var_list3) is provided, the function also creates</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">    three-way interactions among each variable in var_list1, each variable in var_list2, and each variable</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">    in var_list3.</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">        var_list1 (list): List of column names for the first set of variables.</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">        var_list2 (list): List of column names for the second set of variables.</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">        var_list3 (list, optional): List of column names for the third set of variables for three-way interactions.</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co">        A flat list of new interaction column names.</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> dtrain, dtest</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    interaction_cols <span class="op">=</span> []</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create two-way interactions between var_list1 and var_list2.</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> var1 <span class="kw">in</span> var_list1:</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> var2 <span class="kw">in</span> var_list2:</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>            col_name <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>var1<span class="sc">}</span><span class="ss">_*_</span><span class="sc">{</span>var2<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>            dtrain <span class="op">=</span> dtrain.withColumn(col_name, col(var1).cast(<span class="st">"double"</span>) <span class="op">*</span> col(var2).cast(<span class="st">"double"</span>))</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>            dtest <span class="op">=</span> dtest.withColumn(col_name, col(var1).cast(<span class="st">"double"</span>) <span class="op">*</span> col(var2).cast(<span class="st">"double"</span>))</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>            interaction_cols.append(col_name)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create two-way interactions between var_list1 and var_list3.</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> var_list3 <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> var1 <span class="kw">in</span> var_list1:</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> var3 <span class="kw">in</span> var_list3:</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>              col_name <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>var1<span class="sc">}</span><span class="ss">_*_</span><span class="sc">{</span>var3<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>              dtrain <span class="op">=</span> dtrain.withColumn(col_name, col(var1).cast(<span class="st">"double"</span>) <span class="op">*</span> col(var3).cast(<span class="st">"double"</span>))</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>              dtest <span class="op">=</span> dtest.withColumn(col_name, col(var1).cast(<span class="st">"double"</span>) <span class="op">*</span> col(var3).cast(<span class="st">"double"</span>))</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>              interaction_cols.append(col_name)</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create two-way interactions between var_list2 and var_list3.</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> var_list3 <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> var2 <span class="kw">in</span> var_list2:</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> var3 <span class="kw">in</span> var_list3:</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>              col_name <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>var2<span class="sc">}</span><span class="ss">_*_</span><span class="sc">{</span>var3<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>              dtrain <span class="op">=</span> dtrain.withColumn(col_name, col(var2).cast(<span class="st">"double"</span>) <span class="op">*</span> col(var3).cast(<span class="st">"double"</span>))</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>              dtest <span class="op">=</span> dtest.withColumn(col_name, col(var2).cast(<span class="st">"double"</span>) <span class="op">*</span> col(var3).cast(<span class="st">"double"</span>))</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>              interaction_cols.append(col_name)</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If a third list is provided, create three-way interactions.</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> var_list3 <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> var1 <span class="kw">in</span> var_list1:</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> var2 <span class="kw">in</span> var_list2:</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> var3 <span class="kw">in</span> var_list3:</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>                    col_name <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>var1<span class="sc">}</span><span class="ss">_*_</span><span class="sc">{</span>var2<span class="sc">}</span><span class="ss">_*_</span><span class="sc">{</span>var3<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>                    dtrain <span class="op">=</span> dtrain.withColumn(col_name, col(var1).cast(<span class="st">"double"</span>) <span class="op">*</span> col(var2).cast(<span class="st">"double"</span>) <span class="op">*</span> col(var3).cast(<span class="st">"double"</span>))</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>                    dtest <span class="op">=</span> dtest.withColumn(col_name, col(var1).cast(<span class="st">"double"</span>) <span class="op">*</span> col(var2).cast(<span class="st">"double"</span>) <span class="op">*</span> col(var3).cast(<span class="st">"double"</span>))</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>                    interaction_cols.append(col_name)</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> interaction_cols</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a> <span class="co"># Example</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a> <span class="co"># interaction_cols_brand_price = add_interaction_terms(dummy_cols_brand, ['log_price'])</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a> <span class="co"># interaction_cols_brand_ad_price = add_interaction_terms(dummy_cols_brand, dummy_cols_ad, ['log_price'])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="compare_reg_models" class="level2">
<h2 class="anchored" data-anchor-id="compare_reg_models">compare_reg_models()</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compare_reg_models(models, assemblers, names<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Produces a single formatted table comparing multiple regression models.</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">    For each predictor (the union across models, ordered by first appearance), the table shows</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">    the beta estimate (with significance stars) from each model (blank if not used).</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">    For a predictor, if a model's outcome (model.getLabelCol()) starts with "log", the cell displays</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">    both the beta and its exponential (separated by " / "), except when the predictor's name includes "log_".</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">    (The intercept row does not display exp(.))</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Additional rows for Intercept, Observations, R², and RMSE are appended.</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">    The header's first column is labeled "Predictor", and subsequent columns are</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">    "y: [outcome] ([name])" for each model.</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co">    The table is produced in grid format (with vertical lines). A dashed line (using '-' characters)</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co">    is inserted at the top, immediately after the header, and at the bottom.</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co">    Additionally, immediately after the Intercept row, the border line is replaced with one using '='</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co">    (to appear as, for example, "+==============================================+==========================+...").</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co">        models (list): List of fitted LinearRegression models.</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="co">        assemblers (list): List of corresponding VectorAssembler objects.</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co">        names (list, optional): List of model names; defaults to "Model 1", "Model 2", etc.</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co">        A formatted string containing the combined regression table.</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Default model names.</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> names <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>        names <span class="op">=</span> [<span class="ss">f"Model </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(models))]</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For each model, get outcome and determine if that model is log-transformed.</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    outcomes <span class="op">=</span> [m.getLabelCol() <span class="cf">for</span> m <span class="kw">in</span> models]</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    is_log_flags <span class="op">=</span> [out.lower().startswith(<span class="st">"log"</span>) <span class="cf">for</span> out <span class="kw">in</span> outcomes]</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build an ordered union of predictors based on first appearance.</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    ordered_predictors <span class="op">=</span> []</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> assembler <span class="kw">in</span> assemblers:</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> feat <span class="kw">in</span> assembler.getInputCols():</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> feat <span class="kw">not</span> <span class="kw">in</span> ordered_predictors:</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>                ordered_predictors.append(feat)</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Helper for significance stars.</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> significance_stars(p):</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> p <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">""</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> p <span class="op">&lt;</span> <span class="fl">0.01</span>:</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"***"</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> p <span class="op">&lt;</span> <span class="fl">0.05</span>:</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"**"</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> p <span class="op">&lt;</span> <span class="fl">0.1</span>:</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"*"</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">""</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build rows for each predictor.</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>    rows <span class="op">=</span> []</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> feat <span class="kw">in</span> ordered_predictors:</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>        row <span class="op">=</span> [feat]</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> m, a, is_log <span class="kw">in</span> <span class="bu">zip</span>(models, assemblers, is_log_flags):</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>            feats_model <span class="op">=</span> a.getInputCols()</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> feat <span class="kw">in</span> feats_model:</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>                idx <span class="op">=</span> feats_model.index(feat)</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>                beta <span class="op">=</span> m.coefficients.toArray()[idx]</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>                p_val <span class="op">=</span> m.summary.pValues[idx] <span class="cf">if</span> m.summary.pValues <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>                stars <span class="op">=</span> significance_stars(p_val)</span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>                cell <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>beta<span class="sc">:.3f}{</span>stars<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Only add exp(beta) if model is log and predictor name does NOT include "log_"</span></span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> is_log <span class="kw">and</span> (<span class="st">"log_"</span> <span class="kw">not</span> <span class="kw">in</span> feat.lower()):</span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>                    cell <span class="op">+=</span> <span class="ss">f" / </span><span class="sc">{</span>np<span class="sc">.</span>exp(beta)<span class="sc">:,</span><span class="fl">.3</span><span class="er">f</span><span class="sc">}</span><span class="ss">"</span></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>                row.append(cell)</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>                row.append(<span class="st">""</span>)</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>        rows.append(row)</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build intercept row (do NOT compute exp(intercept)).</span></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>    intercept_row <span class="op">=</span> [<span class="st">"Intercept"</span>]</span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> m <span class="kw">in</span> models:</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>        std_all <span class="op">=</span> np.array(m.summary.coefficientStandardErrors)</span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>        coeffs <span class="op">=</span> m.coefficients.toArray()</span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(std_all) <span class="op">==</span> <span class="bu">len</span>(coeffs) <span class="op">+</span> <span class="dv">1</span>:</span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>            intercept_p <span class="op">=</span> m.summary.pValues[<span class="dv">0</span>] <span class="cf">if</span> m.summary.pValues <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>            intercept_p <span class="op">=</span> <span class="va">None</span></span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>        sig <span class="op">=</span> significance_stars(intercept_p)</span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>        cell <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>m<span class="sc">.</span>intercept<span class="sc">:.3f}{</span>sig<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>        intercept_row.append(cell)</span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>    rows.append(intercept_row)</span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add Observations row.</span></span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>    obs_row <span class="op">=</span> [<span class="st">"Observations"</span>]</span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> m <span class="kw">in</span> models:</span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>        obs <span class="op">=</span> m.summary.numInstances</span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>        obs_row.append(<span class="ss">f"</span><span class="sc">{</span><span class="bu">int</span>(obs)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>    rows.append(obs_row)</span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add R² row.</span></span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>    r2_row <span class="op">=</span> [<span class="st">"R²"</span>]</span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> m <span class="kw">in</span> models:</span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>        r2_row.append(<span class="ss">f"</span><span class="sc">{</span>m<span class="sc">.</span>summary<span class="sc">.</span>r2<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a>    rows.append(r2_row)</span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add RMSE row.</span></span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>    rmse_row <span class="op">=</span> [<span class="st">"RMSE"</span>]</span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> m <span class="kw">in</span> models:</span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>        rmse_row.append(<span class="ss">f"</span><span class="sc">{</span>m<span class="sc">.</span>summary<span class="sc">.</span>rootMeanSquaredError<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a>    rows.append(rmse_row)</span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build header: first column "Predictor", then for each model: "y: [outcome] ([name])"</span></span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a>    header <span class="op">=</span> [<span class="st">"Predictor"</span>]</span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> out, name <span class="kw">in</span> <span class="bu">zip</span>(outcomes, names):</span>
<span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a>        header.append(<span class="ss">f"y: </span><span class="sc">{</span>out<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb5-114"><a href="#cb5-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-115"><a href="#cb5-115" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create table string using grid format.</span></span>
<span id="cb5-116"><a href="#cb5-116" aria-hidden="true" tabindex="-1"></a>    table_str <span class="op">=</span> tabulate(rows, headers<span class="op">=</span>header, tablefmt<span class="op">=</span><span class="st">"grid"</span>, colalign<span class="op">=</span>(<span class="st">"left"</span>,) <span class="op">+</span> (<span class="st">"right"</span>,)<span class="op">*</span><span class="bu">len</span>(models))</span>
<span id="cb5-117"><a href="#cb5-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-118"><a href="#cb5-118" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Split into lines.</span></span>
<span id="cb5-119"><a href="#cb5-119" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> table_str.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb5-120"><a href="#cb5-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-121"><a href="#cb5-121" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a dashed line spanning the full width.</span></span>
<span id="cb5-122"><a href="#cb5-122" aria-hidden="true" tabindex="-1"></a>    full_width <span class="op">=</span> <span class="bu">len</span>(lines[<span class="dv">0</span>])</span>
<span id="cb5-123"><a href="#cb5-123" aria-hidden="true" tabindex="-1"></a>    dash_line <span class="op">=</span> <span class="st">'-'</span> <span class="op">*</span> full_width</span>
<span id="cb5-124"><a href="#cb5-124" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create an equals line by replacing '-' with '='.</span></span>
<span id="cb5-125"><a href="#cb5-125" aria-hidden="true" tabindex="-1"></a>    eq_line <span class="op">=</span> dash_line.replace(<span class="st">'-'</span>, <span class="st">'='</span>)</span>
<span id="cb5-126"><a href="#cb5-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-127"><a href="#cb5-127" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Insert a dashed line after the header row.</span></span>
<span id="cb5-128"><a href="#cb5-128" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> table_str.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb5-129"><a href="#cb5-129" aria-hidden="true" tabindex="-1"></a>    <span class="co"># In grid format, header and separator are usually the first two lines.</span></span>
<span id="cb5-130"><a href="#cb5-130" aria-hidden="true" tabindex="-1"></a>    lines.insert(<span class="dv">2</span>, dash_line)</span>
<span id="cb5-131"><a href="#cb5-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-132"><a href="#cb5-132" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Insert an equals line after the Intercept row.</span></span>
<span id="cb5-133"><a href="#cb5-133" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, line <span class="kw">in</span> <span class="bu">enumerate</span>(lines):</span>
<span id="cb5-134"><a href="#cb5-134" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> line.startswith(<span class="st">"|"</span>) <span class="kw">and</span> <span class="st">"Intercept"</span> <span class="kw">in</span> line:</span>
<span id="cb5-135"><a href="#cb5-135" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i<span class="op">+</span><span class="dv">1</span> <span class="op">&lt;</span> <span class="bu">len</span>(lines):</span>
<span id="cb5-136"><a href="#cb5-136" aria-hidden="true" tabindex="-1"></a>                lines[i<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> eq_line</span>
<span id="cb5-137"><a href="#cb5-137" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb5-138"><a href="#cb5-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-139"><a href="#cb5-139" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add dashed lines at the very top and bottom.</span></span>
<span id="cb5-140"><a href="#cb5-140" aria-hidden="true" tabindex="-1"></a>    final_table <span class="op">=</span> dash_line <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(lines) <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> dash_line</span>
<span id="cb5-141"><a href="#cb5-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-142"><a href="#cb5-142" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> final_table</span>
<span id="cb5-143"><a href="#cb5-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-144"><a href="#cb5-144" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage:</span></span>
<span id="cb5-145"><a href="#cb5-145" aria-hidden="true" tabindex="-1"></a><span class="co"># print(compare_reg_models([model_1, model_2, model_3],</span></span>
<span id="cb5-146"><a href="#cb5-146" aria-hidden="true" tabindex="-1"></a><span class="co">#                          [assembler_1, assembler_2, assembler_3],</span></span>
<span id="cb5-147"><a href="#cb5-147" aria-hidden="true" tabindex="-1"></a><span class="co">#                          ["Model 1", "Model 2", "Model 3"]))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="compare_rmse" class="level2">
<h2 class="anchored" data-anchor-id="compare_rmse">compare_rmse()</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compare_rmse(test_dfs, label_col, pred_col<span class="op">=</span><span class="st">"prediction"</span>, names<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Computes and compares RMSE values for a list of test DataFrames.</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">    For each DataFrame in test_dfs, this function calculates the RMSE between the actual outcome</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">    (given by label_col) and the predicted value (given by pred_col, default "prediction"). It then</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">    produces a formatted table where the first column header is empty and the first row's first cell is</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">    "RMSE", with each model's RMSE in its own column.</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">        test_dfs (list): List of test DataFrames.</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">        label_col (str): The name of the outcome column.</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">        pred_col (str, optional): The name of the prediction column (default "prediction").</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">        names (list, optional): List of model names corresponding to the test DataFrames.</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">                                Defaults to "Model 1", "Model 2", etc.</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">        A formatted string containing a table that compares RMSE values for each test DataFrame,</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co">        with one model per column.</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set default model names if none provided.</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> names <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>        names <span class="op">=</span> [<span class="ss">f"Model </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(test_dfs))]</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    rmse_values <span class="op">=</span> []</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> df <span class="kw">in</span> test_dfs:</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create a column for squared error.</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df.withColumn(<span class="st">"error_sq"</span>, <span class="bu">pow</span>(col(label_col) <span class="op">-</span> col(pred_col), <span class="dv">2</span>))</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate RMSE: square root of the mean squared error.</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>        rmse <span class="op">=</span> df.agg(sqrt(avg(<span class="st">"error_sq"</span>)).alias(<span class="st">"rmse"</span>)).collect()[<span class="dv">0</span>][<span class="st">"rmse"</span>]</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>        rmse_values.append(rmse)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build a single row table: first cell "RMSE", then one cell per model with the RMSE value.</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    row <span class="op">=</span> [<span class="st">"RMSE"</span>] <span class="op">+</span> [<span class="ss">f"</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">"</span> <span class="cf">for</span> rmse <span class="kw">in</span> rmse_values]</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build header: first column header is empty, then model names.</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    header <span class="op">=</span> [<span class="st">""</span>] <span class="op">+</span> names</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>    table_str <span class="op">=</span> tabulate([row], headers<span class="op">=</span>header, tablefmt<span class="op">=</span><span class="st">"grid"</span>, colalign<span class="op">=</span>(<span class="st">"left"</span>,) <span class="op">+</span> (<span class="st">"right"</span>,)<span class="op">*</span><span class="bu">len</span>(names))</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> table_str</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage:</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="co"># print(compare_rmse([dtest_1, dtest_2, dtest_3], "log_sales", names=["Model 1", "Model 2", "Model 3"]))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="residual_plot" class="level2">
<h2 class="anchored" data-anchor-id="residual_plot">residual_plot()</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> residual_plot(df, label_col, model_name):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Generates a residual plot for a given test dataframe.</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">        df (DataFrame): Spark DataFrame containing the test set with predictions.</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">        label_col (str): The column name of the actual outcome variable.</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">        title (str): The title for the residual plot.</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">        None (displays the plot)</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to Pandas DataFrame</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    df_pd <span class="op">=</span> df.select([<span class="st">"prediction"</span>, label_col]).toPandas()</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    df_pd[<span class="st">"residual"</span>] <span class="op">=</span> df_pd[label_col] <span class="op">-</span> df_pd[<span class="st">"prediction"</span>]</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Scatter plot of residuals vs. predicted values</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    plt.scatter(df_pd[<span class="st">"prediction"</span>], df_pd[<span class="st">"residual"</span>], alpha<span class="op">=</span><span class="fl">0.2</span>, color<span class="op">=</span><span class="st">"darkgray"</span>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use LOWESS smoothing for trend line</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    smoothed <span class="op">=</span> sm.nonparametric.lowess(df_pd[<span class="st">"residual"</span>], df_pd[<span class="st">"prediction"</span>])</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    plt.plot(smoothed[:, <span class="dv">0</span>], smoothed[:, <span class="dv">1</span>], color<span class="op">=</span><span class="st">"darkblue"</span>)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add reference line at y=0</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Labels and title (model_name)</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Predicted Values"</span>)</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Residuals"</span>)</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    model_name <span class="op">=</span> <span class="st">"Residual Plot for "</span> <span class="op">+</span> model_name</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    plt.title(model_name)</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show plot</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage:</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="co"># residual_plot(dtest_1, "log_sales", "Model 1")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="marginal_effects" class="level2">
<h2 class="anchored" data-anchor-id="marginal_effects">marginal_effects()</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> marginal_effects(model, means):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute marginal effects for all predictors in a PySpark GeneralizedLinearRegression model (logit)</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">    and return a formatted table with statistical significance and standard errors.</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">        model: Fitted GeneralizedLinearRegression model (with binomial family and logit link).</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">        means: List of mean values for the predictor variables.</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">        - A formatted string containing the marginal effects table.</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co">        - A Pandas DataFrame with marginal effects, standard errors, confidence intervals, and significance stars.</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> assembler_predictors  <span class="co"># Use the global assembler_predictors list</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract model coefficients, standard errors, and intercept</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    coeffs <span class="op">=</span> np.array(model.coefficients)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    std_errors <span class="op">=</span> np.array(model.summary.coefficientStandardErrors)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    intercept <span class="op">=</span> model.intercept</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute linear combination of means and coefficients (XB)</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    XB <span class="op">=</span> np.dot(means, coeffs) <span class="op">+</span> intercept</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute derivative of logistic function (G'(XB))</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    G_prime_XB <span class="op">=</span> np.exp(XB) <span class="op">/</span> ((<span class="dv">1</span> <span class="op">+</span> np.exp(XB)) <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Helper: significance stars.</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> significance_stars(p):</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> p <span class="op">&lt;</span> <span class="fl">0.01</span>:</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"***"</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> p <span class="op">&lt;</span> <span class="fl">0.05</span>:</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"**"</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> p <span class="op">&lt;</span> <span class="fl">0.1</span>:</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"*"</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">""</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create lists to store results</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>    df_results <span class="op">=</span> []  <span class="co"># For Pandas DataFrame</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, predictor <span class="kw">in</span> <span class="bu">enumerate</span>(assembler_predictors):</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute marginal effect</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>        marginal_effect <span class="op">=</span> G_prime_XB <span class="op">*</span> coeffs[i]</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute standard error of the marginal effect</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>        std_error <span class="op">=</span> G_prime_XB <span class="op">*</span> std_errors[i]</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute z-score and p-value</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>        z_score <span class="op">=</span> marginal_effect <span class="op">/</span> std_error <span class="cf">if</span> std_error <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> np.nan</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>        p_value <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> norm.cdf(<span class="bu">abs</span>(z_score))) <span class="cf">if</span> <span class="kw">not</span> np.isnan(z_score) <span class="cf">else</span> np.nan</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute confidence interval (95%)</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>        ci_lower <span class="op">=</span> marginal_effect <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> std_error</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>        ci_upper <span class="op">=</span> marginal_effect <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> std_error</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Append results for table formatting</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>        results.append([</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>            predictor,</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"</span><span class="sc">{</span>marginal_effect<span class="sc">: .4f}</span><span class="ss">"</span>,</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>            significance_stars(p_value),</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"</span><span class="sc">{</span>std_error<span class="sc">: .4f}</span><span class="ss">"</span>,</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"</span><span class="sc">{</span>ci_lower<span class="sc">: .4f}</span><span class="ss">"</span>,</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"</span><span class="sc">{</span>ci_upper<span class="sc">: .4f}</span><span class="ss">"</span></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Append results for Pandas DataFrame</span></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>        df_results.append({</span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Variable"</span>: predictor,</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Marginal Effect"</span>: marginal_effect,</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Significance"</span>: significance_stars(p_value),</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Std. Error"</span>: std_error,</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>            <span class="st">"95% CI Lower"</span>: ci_lower,</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>            <span class="st">"95% CI Upper"</span>: ci_upper</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert results to formatted table</span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>    table_str <span class="op">=</span> tabulate(results, headers<span class="op">=</span>[<span class="st">"Variable"</span>, <span class="st">"Marginal Effect"</span>, <span class="st">"Significance"</span>, <span class="st">"Std. Error"</span>, <span class="st">"95% CI Lower"</span>, <span class="st">"95% CI Upper"</span>],</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>                         tablefmt<span class="op">=</span><span class="st">"pretty"</span>, colalign<span class="op">=</span>(<span class="st">"left"</span>, <span class="st">"decimal"</span>, <span class="st">"left"</span>, <span class="st">"decimal"</span>, <span class="st">"decimal"</span>, <span class="st">"decimal"</span>))</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert results to Pandas DataFrame</span></span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>    df_results <span class="op">=</span> pd.DataFrame(df_results)</span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> table_str, df_results</span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage:</span></span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a><span class="co"># means = [0.5, 30]  # Mean values for x1 and x2</span></span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a><span class="co"># assembler_predictors = ['x1', 'x2']  # Define globally before calling the function</span></span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a><span class="co"># table_output, df_output = marginal_effects(fitted_model, means)</span></span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a><span class="co"># print(table_output)</span></span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a><span class="co"># display(df_output)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="data" class="level1">
<h1>Data</h1>
<div class="cell" data-outputid="ee19c5a8-1558-49af-9a7e-ca843af66fc4">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>homes <span class="op">=</span> pd.read_csv(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'https://bcdanl.github.io/data/american_housing_survey.csv'</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>homes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: Total number of columns (29) exceeds max_columns (20). Falling back to pandas display.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="110">

  <div id="df-74e41e9a-3fd1-4dd3-b4db-a57d252a05cc" class="colab-df-container">
    <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">LPRICE</th>
<th data-quarto-table-cell-role="th">VALUE</th>
<th data-quarto-table-cell-role="th">STATE</th>
<th data-quarto-table-cell-role="th">METRO</th>
<th data-quarto-table-cell-role="th">ZINC2</th>
<th data-quarto-table-cell-role="th">HHGRAD</th>
<th data-quarto-table-cell-role="th">BATHS</th>
<th data-quarto-table-cell-role="th">BEDRMS</th>
<th data-quarto-table-cell-role="th">PER</th>
<th data-quarto-table-cell-role="th">ZADULT</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">EABAN</th>
<th data-quarto-table-cell-role="th">HOWH</th>
<th data-quarto-table-cell-role="th">HOWN</th>
<th data-quarto-table-cell-role="th">ODORA</th>
<th data-quarto-table-cell-role="th">STRNA</th>
<th data-quarto-table-cell-role="th">AMMORT</th>
<th data-quarto-table-cell-role="th">INTW</th>
<th data-quarto-table-cell-role="th">MATBUY</th>
<th data-quarto-table-cell-role="th">DWNPAY</th>
<th data-quarto-table-cell-role="th">FRSTHO</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>85000</td>
<td>150000</td>
<td>GA</td>
<td>rural</td>
<td>15600</td>
<td>No HS</td>
<td>2</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>...</td>
<td>0</td>
<td>good</td>
<td>good</td>
<td>0</td>
<td>0</td>
<td>50000</td>
<td>9</td>
<td>1</td>
<td>other</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>76500</td>
<td>130000</td>
<td>GA</td>
<td>rural</td>
<td>61001</td>
<td>HS Grad</td>
<td>2</td>
<td>3</td>
<td>5</td>
<td>2</td>
<td>...</td>
<td>0</td>
<td>good</td>
<td>bad</td>
<td>0</td>
<td>1</td>
<td>70000</td>
<td>5</td>
<td>1</td>
<td>other</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>93900</td>
<td>135000</td>
<td>GA</td>
<td>rural</td>
<td>38700</td>
<td>HS Grad</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>2</td>
<td>...</td>
<td>0</td>
<td>good</td>
<td>good</td>
<td>0</td>
<td>0</td>
<td>117000</td>
<td>6</td>
<td>0</td>
<td>other</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>100000</td>
<td>140000</td>
<td>GA</td>
<td>rural</td>
<td>80000</td>
<td>No HS</td>
<td>3</td>
<td>4</td>
<td>2</td>
<td>2</td>
<td>...</td>
<td>0</td>
<td>good</td>
<td>good</td>
<td>0</td>
<td>1</td>
<td>100000</td>
<td>7</td>
<td>1</td>
<td>prev home</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>100000</td>
<td>135000</td>
<td>GA</td>
<td>rural</td>
<td>61000</td>
<td>HS Grad</td>
<td>2</td>
<td>3</td>
<td>2</td>
<td>2</td>
<td>...</td>
<td>0</td>
<td>good</td>
<td>good</td>
<td>0</td>
<td>0</td>
<td>100000</td>
<td>4</td>
<td>1</td>
<td>other</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15560</td>
<td>109000</td>
<td>200000</td>
<td>CA</td>
<td>rural</td>
<td>67000</td>
<td>HS Grad</td>
<td>1</td>
<td>4</td>
<td>5</td>
<td>5</td>
<td>...</td>
<td>0</td>
<td>bad</td>
<td>good</td>
<td>0</td>
<td>0</td>
<td>109000</td>
<td>8</td>
<td>1</td>
<td>other</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15561</td>
<td>105000</td>
<td>190000</td>
<td>CA</td>
<td>rural</td>
<td>25000</td>
<td>HS Grad</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>...</td>
<td>0</td>
<td>good</td>
<td>bad</td>
<td>0</td>
<td>1</td>
<td>105000</td>
<td>5</td>
<td>1</td>
<td>other</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15562</td>
<td>130000</td>
<td>250000</td>
<td>CA</td>
<td>rural</td>
<td>48800</td>
<td>Bach</td>
<td>2</td>
<td>4</td>
<td>4</td>
<td>2</td>
<td>...</td>
<td>0</td>
<td>good</td>
<td>good</td>
<td>0</td>
<td>1</td>
<td>181000</td>
<td>7</td>
<td>0</td>
<td>other</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15563</td>
<td>13000</td>
<td>250000</td>
<td>CA</td>
<td>rural</td>
<td>58005</td>
<td>No HS</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>3</td>
<td>...</td>
<td>0</td>
<td>bad</td>
<td>good</td>
<td>0</td>
<td>0</td>
<td>180000</td>
<td>7</td>
<td>1</td>
<td>prev home</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15564</td>
<td>68000</td>
<td>180000</td>
<td>CA</td>
<td>rural</td>
<td>20000</td>
<td>HS Grad</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>...</td>
<td>0</td>
<td>good</td>
<td>good</td>
<td>0</td>
<td>0</td>
<td>68000</td>
<td>6</td>
<td>1</td>
<td>other</td>
<td>1</td>
</tr>
</tbody>
</table>


<p>15565 rows × 29 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-74e41e9a-3fd1-4dd3-b4db-a57d252a05cc')" title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-74e41e9a-3fd1-4dd3-b4db-a57d252a05cc button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-74e41e9a-3fd1-4dd3-b4db-a57d252a05cc');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-e50f5094-a989-45fd-a591-d0befed2c9fb">
  <button class="colab-df-quickchart" onclick="quickchart('df-e50f5094-a989-45fd-a591-d0befed2c9fb')" title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"></path>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-e50f5094-a989-45fd-a591-d0befed2c9fb button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

  <div id="id_290d9de5-c601-4be1-babe-85d1edcc3f43">
    <style>
      .colab-df-generate {
        background-color: #E8F0FE;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        fill: #1967D2;
        height: 32px;
        padding: 0 0 0 0;
        width: 32px;
      }

      .colab-df-generate:hover {
        background-color: #E2EBFA;
        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
        fill: #174EA6;
      }

      [theme=dark] .colab-df-generate {
        background-color: #3B4455;
        fill: #D2E3FC;
      }

      [theme=dark] .colab-df-generate:hover {
        background-color: #434B5C;
        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
        fill: #FFFFFF;
      }
    </style>
    <button class="colab-df-generate" onclick="generateWithVariable('homes')" title="Generate code using this dataframe." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z"></path>
  </svg>
    </button>
    <script>
      (() => {
      const buttonEl =
        document.querySelector('#id_290d9de5-c601-4be1-babe-85d1edcc3f43 button.colab-df-generate');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      buttonEl.onclick = () => {
        google.colab.notebook.generateWithVariable('homes');
      }
      })();
    </script>
  </div>

    </div>
  </div>
</div>
</div>
<div class="cell" data-outputid="37d7b942-c71a-4471-9617-5d96b6309397">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>homes[[<span class="st">'FRSTHO'</span>, <span class="st">'BEDRMS'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="111">

  <div id="df-dd5a3ee3-23c6-4f7c-a522-cd116860c119" class="colab-df-container">
    <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">FRSTHO</th>
<th data-quarto-table-cell-role="th">BEDRMS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15560</td>
<td>0</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15561</td>
<td>1</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15562</td>
<td>1</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15563</td>
<td>0</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15564</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>


<p>15565 rows × 2 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-dd5a3ee3-23c6-4f7c-a522-cd116860c119')" title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-dd5a3ee3-23c6-4f7c-a522-cd116860c119 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-dd5a3ee3-23c6-4f7c-a522-cd116860c119');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-d60b4b55-248e-4046-9bca-7107e2af6372">
  <button class="colab-df-quickchart" onclick="quickchart('df-d60b4b55-248e-4046-9bca-7107e2af6372')" title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"></path>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-d60b4b55-248e-4046-9bca-7107e2af6372 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>
</div>
</div>
<section id="adding-variables-using-pandas" class="level2">
<h2 class="anchored" data-anchor-id="adding-variables-using-pandas">Adding Variables using Pandas</h2>
<div class="cell" data-outputid="cedfb93d-cc50-42a4-fac6-4abf4c58bde9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>homes[<span class="st">'log_value'</span>] <span class="op">=</span> np.log(homes[<span class="st">'VALUE'</span>])</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>homes <span class="op">=</span> homes[homes[<span class="st">'ZINC2'</span>]<span class="op">&gt;</span><span class="dv">0</span>]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>homes[<span class="st">'log_zinc2'</span>] <span class="op">=</span> np.log(homes[<span class="st">'ZINC2'</span>])</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>homes[<span class="st">'GT20DWN'</span>] <span class="op">=</span> np.where( (homes[<span class="st">'LPRICE'</span>] <span class="op">-</span> homes[<span class="st">'AMMORT'</span>])<span class="op">/</span>homes[<span class="st">'LPRICE'</span>] <span class="op">&gt;</span> <span class="fl">.2</span>, <span class="dv">1</span>, <span class="dv">0</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-outputid="eb19071a-3885-489f-9ecf-569f8b24fddb">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>homes.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="113">
<pre><code>Index(['LPRICE', 'VALUE', 'STATE', 'METRO', 'ZINC2', 'HHGRAD', 'BATHS',
       'BEDRMS', 'PER', 'ZADULT', 'NUNITS', 'EAPTBL', 'ECOM1', 'ECOM2',
       'EGREEN', 'EJUNK', 'ELOW1', 'ESFD', 'ETRANS', 'EABAN', 'HOWH', 'HOWN',
       'ODORA', 'STRNA', 'AMMORT', 'INTW', 'MATBUY', 'DWNPAY', 'FRSTHO',
       'log_value', 'log_zinc2', 'GT20DWN'],
      dtype='object')</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>homes <span class="op">=</span> homes[[<span class="st">'LPRICE'</span>, <span class="st">'VALUE'</span>, <span class="st">'log_value'</span>, <span class="st">'STATE'</span>, <span class="st">'METRO'</span>, <span class="st">'log_zinc2'</span>, <span class="st">'HHGRAD'</span>, <span class="st">'BATHS'</span>,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">'BEDRMS'</span>, <span class="st">'PER'</span>, <span class="st">'ZADULT'</span>, <span class="st">'NUNITS'</span>, <span class="st">'EAPTBL'</span>, <span class="st">'ECOM1'</span>, <span class="st">'ECOM2'</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">'EGREEN'</span>, <span class="st">'EJUNK'</span>, <span class="st">'ELOW1'</span>, <span class="st">'ESFD'</span>, <span class="st">'ETRANS'</span>, <span class="st">'EABAN'</span>, <span class="st">'HOWH'</span>, <span class="st">'HOWN'</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">'ODORA'</span>, <span class="st">'STRNA'</span>, <span class="st">'AMMORT'</span>, <span class="st">'INTW'</span>, <span class="st">'MATBUY'</span>, <span class="st">'DWNPAY'</span>, <span class="st">'FRSTHO'</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">'GT20DWN'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-outputid="84126c36-6de2-4c65-8411-c0014559968e">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>homes[[<span class="st">'LPRICE'</span>, <span class="st">'AMMORT'</span>, <span class="st">'GT20DWN'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="115">

  <div id="df-19768628-2953-4573-9636-4c59a095114e" class="colab-df-container">
    <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">LPRICE</th>
<th data-quarto-table-cell-role="th">AMMORT</th>
<th data-quarto-table-cell-role="th">GT20DWN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>85000</td>
<td>50000</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>76500</td>
<td>70000</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>93900</td>
<td>117000</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>100000</td>
<td>100000</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>100000</td>
<td>100000</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15560</td>
<td>109000</td>
<td>109000</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15561</td>
<td>105000</td>
<td>105000</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15562</td>
<td>130000</td>
<td>181000</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15563</td>
<td>13000</td>
<td>180000</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15564</td>
<td>68000</td>
<td>68000</td>
<td>0</td>
</tr>
</tbody>
</table>


<p>15454 rows × 3 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-19768628-2953-4573-9636-4c59a095114e')" title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-19768628-2953-4573-9636-4c59a095114e button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-19768628-2953-4573-9636-4c59a095114e');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-6ed9420b-5f18-4d97-9203-66fbc5a9a850">
  <button class="colab-df-quickchart" onclick="quickchart('df-6ed9420b-5f18-4d97-9203-66fbc5a9a850')" title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"></path>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-6ed9420b-5f18-4d97-9203-66fbc5a9a850 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>
</div>
</div>
<div class="cell" data-outputid="5b6ed742-4d18-4e5c-df5e-3822be74c412">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>homes[[<span class="st">'DWNPAY'</span>, <span class="st">'INTW'</span>, <span class="st">'MATBUY'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="116">

  <div id="df-e06c8dfe-3211-40c9-a170-adbc80835417" class="colab-df-container">
    <div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DWNPAY</th>
<th data-quarto-table-cell-role="th">INTW</th>
<th data-quarto-table-cell-role="th">MATBUY</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>other</td>
<td>9</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>other</td>
<td>5</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>other</td>
<td>6</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>prev home</td>
<td>7</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>other</td>
<td>4</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15560</td>
<td>other</td>
<td>8</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15561</td>
<td>other</td>
<td>5</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15562</td>
<td>other</td>
<td>7</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15563</td>
<td>prev home</td>
<td>7</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15564</td>
<td>other</td>
<td>6</td>
<td>1</td>
</tr>
</tbody>
</table>


<p>15454 rows × 3 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-e06c8dfe-3211-40c9-a170-adbc80835417')" title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-e06c8dfe-3211-40c9-a170-adbc80835417 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-e06c8dfe-3211-40c9-a170-adbc80835417');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-b0479df8-e8b9-4823-8f42-80a1a5602b04">
  <button class="colab-df-quickchart" onclick="quickchart('df-b0479df8-e8b9-4823-8f42-80a1a5602b04')" title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"></path>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-b0479df8-e8b9-4823-8f42-80a1a5602b04 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>
</div>
</div>
</section>
<section id="pyspark-dataframe" class="level2">
<h2 class="anchored" data-anchor-id="pyspark-dataframe">PySpark DataFrame</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> spark.createDataFrame(homes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="train-test-split" class="level2">
<h2 class="anchored" data-anchor-id="train-test-split">Train-Test Split</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>dtrain, dtest <span class="op">=</span> df.randomSplit([<span class="fl">0.7</span>, <span class="fl">0.3</span>], seed <span class="op">=</span> <span class="dv">1234</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="adding-dummies" class="level2">
<h2 class="anchored" data-anchor-id="adding-dummies">Adding Dummies</h2>
<div class="cell" data-outputid="a18ede7a-9dc3-416e-d3f2-ba084625f605">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>homes.info()  <span class="co"># df.printSchema()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
Index: 15454 entries, 0 to 15564
Data columns (total 31 columns):
 #   Column     Non-Null Count  Dtype  
---  ------     --------------  -----  
 0   LPRICE     15454 non-null  int64  
 1   VALUE      15454 non-null  int64  
 2   log_value  15454 non-null  float64
 3   STATE      15454 non-null  object 
 4   METRO      15454 non-null  object 
 5   log_zinc2  15454 non-null  float64
 6   HHGRAD     15454 non-null  object 
 7   BATHS      15454 non-null  int64  
 8   BEDRMS     15454 non-null  int64  
 9   PER        15454 non-null  int64  
 10  ZADULT     15454 non-null  int64  
 11  NUNITS     15454 non-null  int64  
 12  EAPTBL     15454 non-null  int64  
 13  ECOM1      15454 non-null  int64  
 14  ECOM2      15454 non-null  int64  
 15  EGREEN     15454 non-null  int64  
 16  EJUNK      15454 non-null  int64  
 17  ELOW1      15454 non-null  int64  
 18  ESFD       15454 non-null  int64  
 19  ETRANS     15454 non-null  int64  
 20  EABAN      15454 non-null  int64  
 21  HOWH       15454 non-null  object 
 22  HOWN       15454 non-null  object 
 23  ODORA      15454 non-null  int64  
 24  STRNA      15454 non-null  int64  
 25  AMMORT     15454 non-null  int64  
 26  INTW       15454 non-null  int64  
 27  MATBUY     15454 non-null  int64  
 28  DWNPAY     15454 non-null  object 
 29  FRSTHO     15454 non-null  int64  
 30  GT20DWN    15454 non-null  int64  
dtypes: float64(2), int64(23), object(6)
memory usage: 3.8+ MB</code></pre>
</div>
</div>
<div class="cell" data-outputid="5577bebd-72eb-4795-cea4-b820d951c04b">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>homes[<span class="st">'STATE'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="121">
<pre><code>array(['GA', 'OH', 'CO', 'CT', 'IN', 'LA', 'OK', 'PA', 'TX', 'WA', 'IL',
       'MO', 'CA'], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-outputid="76ced33b-9260-4011-9eff-7c3ac8e98738">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>homes[<span class="st">'METRO'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="122">
<pre><code>array(['rural', 'urban'], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-outputid="0eee04c4-baf9-414e-f7be-b02d80fe227f">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>homes[<span class="st">'HHGRAD'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="123">
<pre><code>array(['No HS', 'HS Grad', 'Bach', 'Assoc', 'Grad'], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-outputid="881377b1-d0f6-4387-b06e-40a5a06f0b4d">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>homes[<span class="st">'HOWH'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="124">
<pre><code>array(['good', 'bad'], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-outputid="6cb5773e-a381-41c7-faaf-c93752152ee5">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>homes[<span class="st">'HOWN'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="125">
<pre><code>array(['good', 'bad'], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-outputid="bde57e09-f062-43e7-fd88-1d1822f9d3d5">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>homes[<span class="st">'DWNPAY'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="126">
<pre><code>array(['other', 'prev home'], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-outputid="56bbb937-5a72-4c7f-c60a-8e69814e0b59">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>dummy_cols_state, ref_category_state <span class="op">=</span> add_dummy_variables(<span class="st">'STATE'</span>, <span class="dv">0</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>dummy_cols_metro, ref_category_metro <span class="op">=</span> add_dummy_variables(<span class="st">'METRO'</span>, <span class="dv">0</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>dummy_cols_hhgrad, ref_category_hhgrad <span class="op">=</span> add_dummy_variables(<span class="st">'HHGRAD'</span>, <span class="dv">0</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>dummy_cols_howh, ref_category_howh <span class="op">=</span> add_dummy_variables(<span class="st">'HOWH'</span>, <span class="dv">0</span>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>dummy_cols_hown, ref_category_hown <span class="op">=</span> add_dummy_variables(<span class="st">'HOWN'</span>, <span class="dv">0</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>dummy_cols_dwnpay, ref_category_dwnpay <span class="op">=</span> add_dummy_variables(<span class="st">'DWNPAY'</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reference category (dummy omitted): CA
Reference category (dummy omitted): rural
Reference category (dummy omitted): Assoc
Reference category (dummy omitted): bad
Reference category (dummy omitted): bad
Reference category (dummy omitted): other</code></pre>
</div>
</div>
</section>
<section id="adding-interactions" class="level2">
<h2 class="anchored" data-anchor-id="adding-interactions">Adding Interactions</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>interaction_cols_FRSTHO_BEDRMS <span class="op">=</span> add_interaction_terms([<span class="st">'FRSTHO'</span>], [<span class="st">'BEDRMS'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-outputid="a1c7a6fd-77a1-4432-cd6f-252bd6adee5a">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>interaction_cols_FRSTHO_BEDRMS</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="129">
<pre><code>['FRSTHO_*_BEDRMS']</code></pre>
</div>
</div>
<div class="cell" data-outputid="406144ca-c029-4304-c312-10b45acfaf06">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>dtrain.printSchema()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>root
 |-- LPRICE: long (nullable = true)
 |-- VALUE: long (nullable = true)
 |-- log_value: double (nullable = true)
 |-- STATE: string (nullable = true)
 |-- METRO: string (nullable = true)
 |-- log_zinc2: double (nullable = true)
 |-- HHGRAD: string (nullable = true)
 |-- BATHS: long (nullable = true)
 |-- BEDRMS: long (nullable = true)
 |-- PER: long (nullable = true)
 |-- ZADULT: long (nullable = true)
 |-- NUNITS: long (nullable = true)
 |-- EAPTBL: long (nullable = true)
 |-- ECOM1: long (nullable = true)
 |-- ECOM2: long (nullable = true)
 |-- EGREEN: long (nullable = true)
 |-- EJUNK: long (nullable = true)
 |-- ELOW1: long (nullable = true)
 |-- ESFD: long (nullable = true)
 |-- ETRANS: long (nullable = true)
 |-- EABAN: long (nullable = true)
 |-- HOWH: string (nullable = true)
 |-- HOWN: string (nullable = true)
 |-- ODORA: long (nullable = true)
 |-- STRNA: long (nullable = true)
 |-- AMMORT: long (nullable = true)
 |-- INTW: long (nullable = true)
 |-- MATBUY: long (nullable = true)
 |-- DWNPAY: string (nullable = true)
 |-- FRSTHO: long (nullable = true)
 |-- GT20DWN: long (nullable = true)
 |-- STATE_CA: integer (nullable = false)
 |-- STATE_CO: integer (nullable = false)
 |-- STATE_CT: integer (nullable = false)
 |-- STATE_GA: integer (nullable = false)
 |-- STATE_IL: integer (nullable = false)
 |-- STATE_IN: integer (nullable = false)
 |-- STATE_LA: integer (nullable = false)
 |-- STATE_MO: integer (nullable = false)
 |-- STATE_OH: integer (nullable = false)
 |-- STATE_OK: integer (nullable = false)
 |-- STATE_PA: integer (nullable = false)
 |-- STATE_TX: integer (nullable = false)
 |-- STATE_WA: integer (nullable = false)
 |-- METRO_rural: integer (nullable = false)
 |-- METRO_urban: integer (nullable = false)
 |-- HHGRAD_Assoc: integer (nullable = false)
 |-- HHGRAD_Bach: integer (nullable = false)
 |-- HHGRAD_Grad: integer (nullable = false)
 |-- HHGRAD_HS_Grad: integer (nullable = false)
 |-- HHGRAD_No_HS: integer (nullable = false)
 |-- HOWH_bad: integer (nullable = false)
 |-- HOWH_good: integer (nullable = false)
 |-- HOWN_bad: integer (nullable = false)
 |-- HOWN_good: integer (nullable = false)
 |-- DWNPAY_other: integer (nullable = false)
 |-- DWNPAY_prev_home: integer (nullable = false)
 |-- FRSTHO_*_BEDRMS: double (nullable = true)
</code></pre>
</div>
</div>
</section>
</section>
<section id="q1---visualization" class="level1">
<h1>Q1 - Visualization</h1>
<section id="correlation-heatmap" class="level2">
<h2 class="anchored" data-anchor-id="correlation-heatmap">Correlation Heatmap</h2>
<div class="cell" data-outputid="be169b83-7509-45a0-d34f-ae41808c331d">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df_corr <span class="op">=</span> homes.drop([<span class="st">'LPRICE'</span>, <span class="st">'VALUE'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify categorical columns (object or category dtype)</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>categorical_cols <span class="op">=</span> df_corr.select_dtypes(include<span class="op">=</span>[<span class="st">'object'</span>, <span class="st">'category'</span>]).columns.tolist()</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert categorical variables to dummies</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>df_corr <span class="op">=</span> pd.get_dummies(df_corr, columns<span class="op">=</span>categorical_cols, drop_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute correlation matrix</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>corr_matrix <span class="op">=</span> df_corr.corr()</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Correlation heatmap using matplotlib</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>cax <span class="op">=</span> ax.imshow(corr_matrix.values, aspect<span class="op">=</span><span class="st">'auto'</span>)</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>fig.colorbar(cax, ax<span class="op">=</span>ax)</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(<span class="bu">range</span>(<span class="bu">len</span>(corr_matrix.columns)))</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>ax.set_yticks(<span class="bu">range</span>(<span class="bu">len</span>(corr_matrix.columns)))</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(corr_matrix.columns, rotation<span class="op">=</span><span class="dv">90</span>, fontsize<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>ax.set_yticklabels(corr_matrix.columns, fontsize<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'How Are Variables Correlated?'</span>)</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="danl_320_hw3_linear_regression_logistic_regression_housing_markets_files/figure-html/cell-30-output-1.png" class="img-fluid"></p>
</div>
</div>
<ul>
<li>The dummy <strong>DWNPAY_prev_home</strong> (whether a household tapped equity from a prior residence to fund its down payment) is strongly negatively correlated with <strong>FRSTHO</strong> (the dummy for first-time homebuyers).
<ul>
<li>Because first-time buyers have no previous equity, they may fund down payments almost entirely from savings or gifts—the strong negative correlation between <strong>DWNPAY_prev_home</strong> and <strong>FRSTHO</strong>.</li>
<li>Once buyers move into a second home, they can use rolled-over equity from their prior property, lowering their upfront cash requirement.</li>
</ul></li>
<li>The variable <strong>AMMORT</strong> (the size of the initial mortgage loan taken out when a home was acquired) is strongly positively correlated with <strong>BATHS</strong> (the count of full bathrooms in the unit)
<ul>
<li>Home buyers borrow more to secure properties with extra baths, whether for growing families or simply higher‐end homes.</li>
</ul></li>
</ul>
</section>
</section>
<section id="q2---linear-regression-i" class="level1">
<h1>Q2 - Linear Regression I</h1>
<div class="cell" data-outputid="52c4c596-eb3e-4dbc-b3df-148eea70fbec">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>df.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="132">
<pre><code>['LPRICE',
 'VALUE',
 'log_value',
 'STATE',
 'METRO',
 'log_zinc2',
 'HHGRAD',
 'BATHS',
 'BEDRMS',
 'PER',
 'ZADULT',
 'NUNITS',
 'EAPTBL',
 'ECOM1',
 'ECOM2',
 'EGREEN',
 'EJUNK',
 'ELOW1',
 'ESFD',
 'ETRANS',
 'EABAN',
 'HOWH',
 'HOWN',
 'ODORA',
 'STRNA',
 'AMMORT',
 'INTW',
 'MATBUY',
 'DWNPAY',
 'FRSTHO',
 'GT20DWN']</code></pre>
</div>
</div>
<div class="cell" data-outputid="664dadf6-4e24-49c2-b1b6-430e765c6eab">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># assembling predictors</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>conti_cols <span class="op">=</span> [</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a> <span class="st">'log_zinc2'</span>,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'BATHS'</span>,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'BEDRMS'</span>,</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'PER'</span>,</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'ZADULT'</span>,</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'NUNITS'</span>,</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'EAPTBL'</span>,</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'ECOM1'</span>,</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a> <span class="st">'ECOM2'</span>,</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a> <span class="st">'EGREEN'</span>,</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a> <span class="st">'EJUNK'</span>,</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a> <span class="st">'ELOW1'</span>,</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a> <span class="st">'ESFD'</span>,</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a> <span class="st">'ETRANS'</span>,</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a> <span class="st">'EABAN'</span>,</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a> <span class="st">'ODORA'</span>,</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a> <span class="st">'STRNA'</span>,</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a> <span class="st">'INTW'</span>,</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a> <span class="st">'MATBUY'</span>,</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a> <span class="st">'FRSTHO'</span>]</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>assembler_predictors <span class="op">=</span> (</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>    conti_cols <span class="op">+</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>    dummy_cols_state <span class="op">+</span></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>    dummy_cols_metro <span class="op">+</span></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>    dummy_cols_hhgrad <span class="op">+</span></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>    dummy_cols_howh <span class="op">+</span></span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>    dummy_cols_hown <span class="op">+</span></span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>    dummy_cols_dwnpay</span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>assembler_1 <span class="op">=</span> VectorAssembler(</span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a>    inputCols <span class="op">=</span> assembler_predictors,</span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a>    outputCol <span class="op">=</span> <span class="st">"predictors"</span></span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>dtrain_1 <span class="op">=</span> assembler_1.transform(dtrain)</span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a>dtest_1  <span class="op">=</span> assembler_1.transform(dtest)</span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a><span class="co"># fitting the model</span></span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a>model_1 <span class="op">=</span> (</span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a>    LinearRegression(featuresCol<span class="op">=</span><span class="st">"predictors"</span>,</span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a>                     labelCol<span class="op">=</span><span class="st">"log_value"</span>)</span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a>    .fit(dtrain_1)</span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a><span class="co"># making prediction</span></span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a>dtest_1 <span class="op">=</span> model_1.transform(dtest_1)</span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true" tabindex="-1"></a><span class="co"># makting regression table</span></span>
<span id="cb44-53"><a href="#cb44-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( regression_table(model_1, assembler_1) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+------------------+--------+-----------+------+------------+---------+--------------+--------------+-------------------+-------------------+
| y: log_value     |   Beta | Exp(Beta) | Sig. | Std. Error | p-value | 95% CI Lower | 95% CI Upper | Exp(95% CI Lower) | Exp(95% CI Upper) |
+------------------+--------+-----------+------+------------+---------+--------------+--------------+-------------------+-------------------+
| log_zinc2        |  0.100 |           | ***  |      0.014 |   0.000 |        0.072 |        0.128 |                   |                   |
| BATHS            |  0.200 |     1.221 | ***  |      0.012 |   0.000 |        0.175 |        0.224 |             1.192 |             1.251 |
| BEDRMS           |  0.079 |     1.082 | ***  |      0.008 |   0.000 |        0.064 |        0.094 |             1.066 |             1.099 |
| PER              |  0.011 |     1.011 |      |      0.013 |   0.136 |       -0.015 |        0.038 |             0.985 |             1.038 |
| ZADULT           | -0.039 |     0.962 | ***  |      0.001 |   0.003 |       -0.040 |       -0.038 |             0.960 |             0.963 |
| NUNITS           | -0.001 |     0.999 |  *   |      0.029 |   0.051 |       -0.057 |        0.055 |             0.944 |             1.056 |
| EAPTBL           | -0.047 |     0.954 |      |      0.024 |   0.103 |       -0.093 |       -0.000 |             0.911 |             1.000 |
| ECOM1            | -0.032 |     0.968 |      |      0.059 |   0.171 |       -0.148 |        0.084 |             0.862 |             1.087 |
| ECOM2            | -0.087 |     0.916 |      |      0.017 |   0.140 |       -0.121 |       -0.054 |             0.886 |             0.948 |
| EGREEN           |  0.001 |     1.001 |      |      0.063 |   0.956 |       -0.122 |        0.123 |             0.886 |             1.131 |
| EJUNK            | -0.125 |     0.882 |  **  |      0.028 |   0.045 |       -0.180 |       -0.071 |             0.835 |             0.932 |
| ELOW1            |  0.020 |     1.020 |      |      0.036 |   0.477 |       -0.051 |        0.090 |             0.951 |             1.094 |
| ESFD             |  0.323 |     1.381 | ***  |      0.031 |   0.000 |        0.262 |        0.384 |             1.300 |             1.468 |
| ETRANS           | -0.028 |     0.972 |      |      0.044 |   0.368 |       -0.114 |        0.058 |             0.892 |             1.060 |
| EABAN            | -0.107 |     0.899 |  **  |      0.040 |   0.015 |       -0.186 |       -0.028 |             0.830 |             0.972 |
| ODORA            |  0.036 |     1.036 |      |      0.020 |   0.375 |       -0.003 |        0.074 |             0.997 |             1.077 |
| STRNA            | -0.044 |     0.957 |  **  |      0.005 |   0.024 |       -0.055 |       -0.034 |             0.947 |             0.967 |
| INTW             | -0.044 |     0.957 | ***  |      0.017 |   0.000 |       -0.077 |       -0.012 |             0.926 |             0.989 |
| MATBUY           | -0.009 |     0.991 |      |      0.021 |   0.576 |       -0.051 |        0.032 |             0.951 |             1.032 |
| FRSTHO           | -0.081 |     0.923 | ***  |      0.036 |   0.000 |       -0.151 |       -0.010 |             0.860 |             0.990 |
| STATE_CO         | -0.305 |     0.737 | ***  |      0.038 |   0.000 |       -0.380 |       -0.230 |             0.684 |             0.795 |
| STATE_CT         | -0.348 |     0.706 | ***  |      0.038 |   0.000 |       -0.422 |       -0.273 |             0.656 |             0.761 |
| STATE_GA         | -0.672 |     0.511 | ***  |      0.073 |   0.000 |       -0.815 |       -0.529 |             0.443 |             0.589 |
| STATE_IL         | -0.894 |     0.409 | ***  |      0.038 |   0.000 |       -0.968 |       -0.820 |             0.380 |             0.441 |
| STATE_IN         | -0.794 |     0.452 | ***  |      0.045 |   0.000 |       -0.883 |       -0.706 |             0.414 |             0.494 |
| STATE_LA         | -0.728 |     0.483 | ***  |      0.041 |   0.000 |       -0.809 |       -0.647 |             0.445 |             0.524 |
| STATE_MO         | -0.652 |     0.521 | ***  |      0.040 |   0.000 |       -0.730 |       -0.573 |             0.482 |             0.564 |
| STATE_OH         | -0.658 |     0.518 | ***  |      0.040 |   0.000 |       -0.737 |       -0.580 |             0.479 |             0.560 |
| STATE_OK         | -1.011 |     0.364 | ***  |      0.042 |   0.000 |       -1.092 |       -0.929 |             0.335 |             0.395 |
| STATE_PA         | -0.842 |     0.431 | ***  |      0.042 |   0.000 |       -0.925 |       -0.760 |             0.397 |             0.468 |
| STATE_TX         | -1.053 |     0.349 | ***  |      0.038 |   0.000 |       -1.127 |       -0.979 |             0.324 |             0.376 |
| STATE_WA         | -0.144 |     0.866 | ***  |      0.022 |   0.000 |       -0.187 |       -0.100 |             0.829 |             0.905 |
| METRO_urban      |  0.083 |     1.087 | ***  |      0.028 |   0.000 |        0.028 |        0.138 |             1.029 |             1.148 |
| HHGRAD_Bach      |  0.134 |     1.143 | ***  |      0.032 |   0.000 |        0.072 |        0.196 |             1.074 |             1.216 |
| HHGRAD_Grad      |  0.210 |     1.233 | ***  |      0.027 |   0.000 |        0.158 |        0.262 |             1.171 |             1.299 |
| HHGRAD_HS_Grad   | -0.055 |     0.946 |  **  |      0.039 |   0.037 |       -0.131 |        0.021 |             0.877 |             1.021 |
| HHGRAD_No_HS     | -0.130 |     0.878 | ***  |      0.032 |   0.001 |       -0.193 |       -0.067 |             0.824 |             0.935 |
| HOWH_good        |  0.127 |     1.135 | ***  |      0.027 |   0.000 |        0.074 |        0.180 |             1.077 |             1.197 |
| HOWN_good        |  0.123 |     1.131 | ***  |      0.022 |   0.000 |        0.081 |        0.166 |             1.084 |             1.181 |
| DWNPAY_prev_home |  0.127 |     1.135 | ***  |      0.126 |   0.000 |       -0.120 |        0.374 |             0.887 |             1.453 |
| Intercept        | 10.572 |           | ***  |      0.010 |         |       10.553 |              |            10.591 |                   |
---------------------------------------------------------------------------------------------------------------------------------------------
| Observations     | 10,869 |           |      |            |         |              |              |                   |                   |
| R²               |  0.294 |           |      |            |         |              |              |                   |                   |
| RMSE             |  0.832 |           |      |            |         |              |              |                   |                   |
+------------------+--------+-----------+------+------------+---------+--------------+--------------+-------------------+-------------------+</code></pre>
</div>
</div>
</section>
<section id="q3---linear-regression-ii" class="level1">
<h1>Q3 - Linear Regression II</h1>
<div class="cell" data-outputid="a92f1edc-3acf-4ac9-b68e-a6ae245d273c">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># assembling predictors</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>conti_cols <span class="op">=</span> [</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a> <span class="st">'log_zinc2'</span>,</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'BATHS'</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'BEDRMS'</span>,</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'ZADULT'</span>,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'NUNITS'</span>,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'EJUNK'</span>,</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'ESFD'</span>,</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'EABAN'</span>,</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a> <span class="st">'STRNA'</span>,</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a> <span class="st">'INTW'</span>,</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a> <span class="st">'FRSTHO'</span>]</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>assembler_predictors <span class="op">=</span> (</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>    conti_cols <span class="op">+</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>    dummy_cols_state <span class="op">+</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>    dummy_cols_metro <span class="op">+</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>    dummy_cols_hhgrad <span class="op">+</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>    dummy_cols_howh <span class="op">+</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>    dummy_cols_hown <span class="op">+</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>    dummy_cols_dwnpay</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>assembler_2 <span class="op">=</span> VectorAssembler(</span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>    inputCols <span class="op">=</span> assembler_predictors,</span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>    outputCol <span class="op">=</span> <span class="st">"predictors"</span></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>dtrain_2 <span class="op">=</span> assembler_2.transform(dtrain)</span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>dtest_2  <span class="op">=</span> assembler_2.transform(dtest)</span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a><span class="co"># training model</span></span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a>model_2 <span class="op">=</span> (</span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a>    LinearRegression(featuresCol<span class="op">=</span><span class="st">"predictors"</span>,</span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a>                     labelCol<span class="op">=</span><span class="st">"log_value"</span>)</span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a>    .fit(dtrain_2)</span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-40"><a href="#cb46-40" aria-hidden="true" tabindex="-1"></a><span class="co"># making prediction</span></span>
<span id="cb46-41"><a href="#cb46-41" aria-hidden="true" tabindex="-1"></a>dtest_2 <span class="op">=</span> model_2.transform(dtest_2)</span>
<span id="cb46-42"><a href="#cb46-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-43"><a href="#cb46-43" aria-hidden="true" tabindex="-1"></a><span class="co"># makting regression table</span></span>
<span id="cb46-44"><a href="#cb46-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( regression_table(model_2, assembler_2) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+------------------+--------+-----------+------+------------+---------+--------------+--------------+-------------------+-------------------+
| y: log_value     |   Beta | Exp(Beta) | Sig. | Std. Error | p-value | 95% CI Lower | 95% CI Upper | Exp(95% CI Lower) | Exp(95% CI Upper) |
+------------------+--------+-----------+------+------------+---------+--------------+--------------+-------------------+-------------------+
| log_zinc2        |  0.101 |           | ***  |      0.014 |   0.000 |        0.074 |        0.129 |                   |                   |
| BATHS            |  0.201 |     1.223 | ***  |      0.012 |   0.000 |        0.178 |        0.224 |             1.195 |             1.252 |
| BEDRMS           |  0.086 |     1.089 | ***  |      0.011 |   0.000 |        0.064 |        0.107 |             1.066 |             1.113 |
| ZADULT           | -0.028 |     0.972 |  **  |      0.001 |   0.011 |       -0.029 |       -0.027 |             0.971 |             0.973 |
| NUNITS           | -0.001 |     0.999 |  **  |      0.062 |   0.020 |       -0.124 |        0.121 |             0.884 |             1.128 |
| EJUNK            | -0.126 |     0.882 |  **  |      0.036 |   0.043 |       -0.196 |       -0.056 |             0.822 |             0.946 |
| ESFD             |  0.324 |     1.382 | ***  |      0.044 |   0.000 |        0.238 |        0.409 |             1.269 |             1.506 |
| EABAN            | -0.119 |     0.888 | ***  |      0.019 |   0.006 |       -0.157 |       -0.081 |             0.855 |             0.922 |
| STRNA            | -0.051 |     0.950 | ***  |      0.005 |   0.008 |       -0.062 |       -0.041 |             0.940 |             0.960 |
| INTW             | -0.045 |     0.956 | ***  |      0.021 |   0.000 |       -0.086 |       -0.004 |             0.918 |             0.996 |
| FRSTHO           | -0.080 |     0.923 | ***  |      0.036 |   0.000 |       -0.150 |       -0.010 |             0.861 |             0.990 |
| STATE_CO         | -0.304 |     0.738 | ***  |      0.038 |   0.000 |       -0.380 |       -0.229 |             0.684 |             0.795 |
| STATE_CT         | -0.350 |     0.705 | ***  |      0.038 |   0.000 |       -0.424 |       -0.276 |             0.654 |             0.759 |
| STATE_GA         | -0.677 |     0.508 | ***  |      0.073 |   0.000 |       -0.820 |       -0.534 |             0.440 |             0.586 |
| STATE_IL         | -0.898 |     0.407 | ***  |      0.038 |   0.000 |       -0.972 |       -0.824 |             0.378 |             0.439 |
| STATE_IN         | -0.794 |     0.452 | ***  |      0.045 |   0.000 |       -0.882 |       -0.706 |             0.414 |             0.494 |
| STATE_LA         | -0.732 |     0.481 | ***  |      0.041 |   0.000 |       -0.813 |       -0.651 |             0.444 |             0.522 |
| STATE_MO         | -0.655 |     0.520 | ***  |      0.040 |   0.000 |       -0.733 |       -0.577 |             0.481 |             0.562 |
| STATE_OH         | -0.668 |     0.513 | ***  |      0.040 |   0.000 |       -0.746 |       -0.589 |             0.474 |             0.555 |
| STATE_OK         | -1.008 |     0.365 | ***  |      0.042 |   0.000 |       -1.089 |       -0.926 |             0.337 |             0.396 |
| STATE_PA         | -0.844 |     0.430 | ***  |      0.042 |   0.000 |       -0.926 |       -0.763 |             0.396 |             0.466 |
| STATE_TX         | -1.051 |     0.349 | ***  |      0.038 |   0.000 |       -1.125 |       -0.977 |             0.325 |             0.376 |
| STATE_WA         | -0.145 |     0.865 | ***  |      0.022 |   0.000 |       -0.188 |       -0.102 |             0.829 |             0.903 |
| METRO_urban      |  0.074 |     1.077 | ***  |      0.028 |   0.001 |        0.019 |        0.129 |             1.020 |             1.138 |
| HHGRAD_Bach      |  0.134 |     1.143 | ***  |      0.032 |   0.000 |        0.072 |        0.196 |             1.074 |             1.216 |
| HHGRAD_Grad      |  0.209 |     1.232 | ***  |      0.027 |   0.000 |        0.157 |        0.261 |             1.170 |             1.298 |
| HHGRAD_HS_Grad   | -0.055 |     0.946 |  **  |      0.039 |   0.037 |       -0.131 |        0.021 |             0.877 |             1.021 |
| HHGRAD_No_HS     | -0.131 |     0.877 | ***  |      0.032 |   0.001 |       -0.194 |       -0.068 |             0.824 |             0.934 |
| HOWH_good        |  0.126 |     1.134 | ***  |      0.027 |   0.000 |        0.074 |        0.178 |             1.076 |             1.195 |
| HOWN_good        |  0.126 |     1.134 | ***  |      0.022 |   0.000 |        0.083 |        0.169 |             1.087 |             1.184 |
| DWNPAY_prev_home |  0.130 |     1.139 | ***  |      0.124 |   0.000 |       -0.113 |        0.373 |             0.893 |             1.452 |
| Intercept        | 10.532 |           | ***  |      0.010 |         |       10.514 |              |            10.551 |                   |
---------------------------------------------------------------------------------------------------------------------------------------------
| Observations     | 10,869 |           |      |            |         |              |              |                   |                   |
| R²               |  0.293 |           |      |            |         |              |              |                   |                   |
| RMSE             |  0.833 |           |      |            |         |              |              |                   |                   |
+------------------+--------+-----------+------+------------+---------+--------------+--------------+-------------------+-------------------+</code></pre>
</div>
</div>
<div class="cell" data-outputid="324010e2-5201-49dd-c747-d87830464ed8">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(compare_reg_models([model_1, model_2],</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>                         [assembler_1, assembler_2],</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>                         [<span class="st">"Model 1"</span>, <span class="st">"Model 2"</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--------------------------------------------------------------------------
+------------------+--------------------------+--------------------------+
| Predictor        |   y: log_value (Model 1) |   y: log_value (Model 2) |
--------------------------------------------------------------------------
+==================+==========================+==========================+
| log_zinc2        |                 0.100*** |                 0.101*** |
+------------------+--------------------------+--------------------------+
| BATHS            |         0.200*** / 1.221 |         0.201*** / 1.223 |
+------------------+--------------------------+--------------------------+
| BEDRMS           |         0.079*** / 1.082 |         0.086*** / 1.089 |
+------------------+--------------------------+--------------------------+
| PER              |            0.011 / 1.011 |                          |
+------------------+--------------------------+--------------------------+
| ZADULT           |        -0.039*** / 0.962 |         -0.028** / 0.972 |
+------------------+--------------------------+--------------------------+
| NUNITS           |          -0.001* / 0.999 |         -0.001** / 0.999 |
+------------------+--------------------------+--------------------------+
| EAPTBL           |           -0.047 / 0.954 |                          |
+------------------+--------------------------+--------------------------+
| ECOM1            |           -0.032 / 0.968 |                          |
+------------------+--------------------------+--------------------------+
| ECOM2            |           -0.087 / 0.916 |                          |
+------------------+--------------------------+--------------------------+
| EGREEN           |            0.001 / 1.001 |                          |
+------------------+--------------------------+--------------------------+
| EJUNK            |         -0.125** / 0.882 |         -0.126** / 0.882 |
+------------------+--------------------------+--------------------------+
| ELOW1            |            0.020 / 1.020 |                          |
+------------------+--------------------------+--------------------------+
| ESFD             |         0.323*** / 1.381 |         0.324*** / 1.382 |
+------------------+--------------------------+--------------------------+
| ETRANS           |           -0.028 / 0.972 |                          |
+------------------+--------------------------+--------------------------+
| EABAN            |         -0.107** / 0.899 |        -0.119*** / 0.888 |
+------------------+--------------------------+--------------------------+
| ODORA            |            0.036 / 1.036 |                          |
+------------------+--------------------------+--------------------------+
| STRNA            |         -0.044** / 0.957 |        -0.051*** / 0.950 |
+------------------+--------------------------+--------------------------+
| INTW             |        -0.044*** / 0.957 |        -0.045*** / 0.956 |
+------------------+--------------------------+--------------------------+
| MATBUY           |           -0.009 / 0.991 |                          |
+------------------+--------------------------+--------------------------+
| FRSTHO           |        -0.081*** / 0.923 |        -0.080*** / 0.923 |
+------------------+--------------------------+--------------------------+
| STATE_CO         |        -0.305*** / 0.737 |        -0.304*** / 0.738 |
+------------------+--------------------------+--------------------------+
| STATE_CT         |        -0.348*** / 0.706 |        -0.350*** / 0.705 |
+------------------+--------------------------+--------------------------+
| STATE_GA         |        -0.672*** / 0.511 |        -0.677*** / 0.508 |
+------------------+--------------------------+--------------------------+
| STATE_IL         |        -0.894*** / 0.409 |        -0.898*** / 0.407 |
+------------------+--------------------------+--------------------------+
| STATE_IN         |        -0.794*** / 0.452 |        -0.794*** / 0.452 |
+------------------+--------------------------+--------------------------+
| STATE_LA         |        -0.728*** / 0.483 |        -0.732*** / 0.481 |
+------------------+--------------------------+--------------------------+
| STATE_MO         |        -0.652*** / 0.521 |        -0.655*** / 0.520 |
+------------------+--------------------------+--------------------------+
| STATE_OH         |        -0.658*** / 0.518 |        -0.668*** / 0.513 |
+------------------+--------------------------+--------------------------+
| STATE_OK         |        -1.011*** / 0.364 |        -1.008*** / 0.365 |
+------------------+--------------------------+--------------------------+
| STATE_PA         |        -0.842*** / 0.431 |        -0.844*** / 0.430 |
+------------------+--------------------------+--------------------------+
| STATE_TX         |        -1.053*** / 0.349 |        -1.051*** / 0.349 |
+------------------+--------------------------+--------------------------+
| STATE_WA         |        -0.144*** / 0.866 |        -0.145*** / 0.865 |
+------------------+--------------------------+--------------------------+
| METRO_urban      |         0.083*** / 1.087 |         0.074*** / 1.077 |
+------------------+--------------------------+--------------------------+
| HHGRAD_Bach      |         0.134*** / 1.143 |         0.134*** / 1.143 |
+------------------+--------------------------+--------------------------+
| HHGRAD_Grad      |         0.210*** / 1.233 |         0.209*** / 1.232 |
+------------------+--------------------------+--------------------------+
| HHGRAD_HS_Grad   |         -0.055** / 0.946 |         -0.055** / 0.946 |
+------------------+--------------------------+--------------------------+
| HHGRAD_No_HS     |        -0.130*** / 0.878 |        -0.131*** / 0.877 |
+------------------+--------------------------+--------------------------+
| HOWH_good        |         0.127*** / 1.135 |         0.126*** / 1.134 |
+------------------+--------------------------+--------------------------+
| HOWN_good        |         0.123*** / 1.131 |         0.126*** / 1.134 |
+------------------+--------------------------+--------------------------+
| DWNPAY_prev_home |         0.127*** / 1.135 |         0.130*** / 1.139 |
+------------------+--------------------------+--------------------------+
| Intercept        |                10.572*** |                10.532*** |
==========================================================================
| Observations     |                   10,869 |                   10,869 |
+------------------+--------------------------+--------------------------+
| R²               |                    0.294 |                    0.293 |
+------------------+--------------------------+--------------------------+
| RMSE             |                    0.832 |                    0.833 |
+------------------+--------------------------+--------------------------+
--------------------------------------------------------------------------</code></pre>
</div>
</div>
<div class="cell" data-outputid="92d3d3ca-39c1-410e-c136-59b03ea43971">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>residual_plot(dtest_1, <span class="st">"log_value"</span>, <span class="st">"Model 1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="danl_320_hw3_linear_regression_logistic_regression_housing_markets_files/figure-html/cell-35-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-outputid="1c8f4530-b793-4b8b-9df0-366d046b1df7">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>residual_plot(dtest_2, <span class="st">"log_value"</span>, <span class="st">"Model 2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="danl_320_hw3_linear_regression_logistic_regression_housing_markets_files/figure-html/cell-36-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="q4---logistic-regression---i" class="level1">
<h1>Q4 - Logistic Regression - I</h1>
<div class="cell" data-outputid="d49c2ba0-ec2c-4fa0-9cb6-b923e5842563">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># assembling predictors</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>conti_cols <span class="op">=</span> [</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a> <span class="st">'log_zinc2'</span>,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'BATHS'</span>,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'BEDRMS'</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'PER'</span>,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'ZADULT'</span>,</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'NUNITS'</span>,</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'EAPTBL'</span>,</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'ECOM1'</span>,</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a> <span class="st">'ECOM2'</span>,</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a> <span class="st">'EGREEN'</span>,</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a> <span class="st">'EJUNK'</span>,</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a> <span class="st">'ELOW1'</span>,</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a> <span class="st">'ESFD'</span>,</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a> <span class="st">'ETRANS'</span>,</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a> <span class="st">'EABAN'</span>,</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a> <span class="st">'ODORA'</span>,</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a> <span class="st">'STRNA'</span>,</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a> <span class="st">'INTW'</span>,</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a> <span class="st">'MATBUY'</span>,</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a> <span class="st">'FRSTHO'</span>]</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>assembler_predictors <span class="op">=</span> (</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>    conti_cols <span class="op">+</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>    dummy_cols_state <span class="op">+</span></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>    dummy_cols_metro <span class="op">+</span></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>    dummy_cols_hhgrad <span class="op">+</span></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>    dummy_cols_howh <span class="op">+</span></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>    dummy_cols_hown <span class="op">+</span></span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>    dummy_cols_dwnpay</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>assembler_3 <span class="op">=</span> VectorAssembler(</span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>    inputCols <span class="op">=</span> assembler_predictors,</span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>    outputCol <span class="op">=</span> <span class="st">"predictors"</span></span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a>dtrain_3 <span class="op">=</span> assembler_3.transform(dtrain)</span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a>dtest_3  <span class="op">=</span> assembler_3.transform(dtest)</span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a><span class="co"># training the model</span></span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a>model_3 <span class="op">=</span> (</span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a>    GeneralizedLinearRegression(featuresCol<span class="op">=</span><span class="st">"predictors"</span>,</span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a>                                labelCol<span class="op">=</span><span class="st">"GT20DWN"</span>,</span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a>                                family<span class="op">=</span><span class="st">"binomial"</span>,</span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a>                                link<span class="op">=</span><span class="st">"logit"</span>)</span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a>    .fit(dtrain_3)</span>
<span id="cb52-49"><a href="#cb52-49" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-50"><a href="#cb52-50" aria-hidden="true" tabindex="-1"></a><span class="co"># making prediction</span></span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a>dtrain_3 <span class="op">=</span> model_3.transform(dtrain_3)</span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a>dtest_3 <span class="op">=</span> model_3.transform(dtest_3)</span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true" tabindex="-1"></a><span class="co"># makting regression table</span></span>
<span id="cb52-55"><a href="#cb52-55" aria-hidden="true" tabindex="-1"></a>model_3.summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="138">
<pre><code>Coefficients:
         Feature Estimate Std Error T Value P Value
     (Intercept)  -0.3965    0.3491 -1.1358  0.2560
       log_zinc2  -0.0647    0.0263 -2.4572  0.0140
           BATHS   0.3836    0.0395  9.7098  0.0000
          BEDRMS   0.0310    0.0346  0.8954  0.3706
             PER  -0.1092    0.0221 -4.9522  0.0000
          ZADULT   0.0064    0.0383  0.1673  0.8672
          NUNITS   0.0028    0.0017  1.5797  0.1142
          EAPTBL  -0.0445    0.0859 -0.5181  0.6044
           ECOM1  -0.1851    0.0707 -2.6196  0.0088
           ECOM2  -0.1670    0.1908 -0.8756  0.3813
          EGREEN  -0.0072    0.0478 -0.1512  0.8798
           EJUNK   0.0799    0.1938  0.4125  0.6800
           ELOW1   0.0153    0.0798  0.1913  0.8483
            ESFD  -0.2195    0.0996 -2.2027  0.0276
          ETRANS  -0.1033    0.0926 -1.1153  0.2647
           EABAN  -0.0629    0.1406 -0.4477  0.6544
           ODORA   0.1368    0.1176  1.1629  0.2449
           STRNA  -0.1670    0.0574 -2.9076  0.0036
            INTW  -0.0915    0.0166 -5.5077  0.0000
          MATBUY   0.2764    0.0472  5.8552  0.0000
          FRSTHO  -0.4728    0.0622 -7.6055  0.0000
        STATE_CO  -0.2293    0.1009 -2.2729  0.0230
        STATE_CT   0.6353    0.1050  6.0529  0.0000
        STATE_GA  -0.5510    0.1099 -5.0146  0.0000
        STATE_IL   0.2934    0.2008  1.4611  0.1440
        STATE_IN  -0.0048    0.1069 -0.0451  0.9640
        STATE_LA   0.3375    0.1247  2.7065  0.0068
        STATE_MO   0.2289    0.1141  2.0059  0.0449
        STATE_OH   0.4700    0.1100  4.2723  0.0000
        STATE_OK  -0.2453    0.1170 -2.0971  0.0360
        STATE_PA   0.3136    0.1164  2.6944  0.0071
        STATE_TX  -0.0706    0.1216 -0.5807  0.5614
        STATE_WA   0.1421    0.1044  1.3611  0.1735
     METRO_urban  -0.0678    0.0653 -1.0378  0.2994
     HHGRAD_Bach   0.2034    0.0792  2.5674  0.0102
     HHGRAD_Grad   0.3891    0.0873  4.4560  0.0000
  HHGRAD_HS_Grad  -0.0580    0.0768 -0.7545  0.4505
    HHGRAD_No_HS  -0.0939    0.1180 -0.7961  0.4260
       HOWH_good  -0.1434    0.0960 -1.4949  0.1349
       HOWN_good   0.2085    0.0817  2.5533  0.0107
DWNPAY_prev_home   0.7493    0.0578 12.9532  0.0000

(Dispersion parameter for binomial family taken to be 1.0000)
    Null deviance: 13055.3691 on 10828 degrees of freedom
Residual deviance: 11731.1943 on 10828 degrees of freedom
AIC: 11813.1943</code></pre>
</div>
</div>
<section id="marginal-effects" class="level2">
<h2 class="anchored" data-anchor-id="marginal-effects">Marginal Effects</h2>
<div class="cell" data-outputid="0619e276-172d-49fc-a508-068ccf3afb2d">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute means</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>means_df <span class="op">=</span> dtrain_3.select([mean(col).alias(col) <span class="cf">for</span> col <span class="kw">in</span> assembler_predictors])</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect the results as a list</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>means <span class="op">=</span> means_df.collect()[<span class="dv">0</span>]</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>means_list <span class="op">=</span> [means[col] <span class="cf">for</span> col <span class="kw">in</span> assembler_predictors]</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>table_output, df_ME <span class="op">=</span> marginal_effects(model_3, means_list) <span class="co"># Instead of mean values, some other representative values can also be chosen.</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(table_output)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+------------------+-----------------+--------------+------------+--------------+--------------+
| Variable         | Marginal Effect | Significance | Std. Error | 95% CI Lower | 95% CI Upper |
+------------------+-----------------+--------------+------------+--------------+--------------+
| log_zinc2        |         -0.0125 | **           |     0.0051 |      -0.0225 |      -0.0025 |
| BATHS            |          0.0742 | ***          |     0.0076 |       0.0592 |       0.0892 |
| BEDRMS           |          0.0060 |              |     0.0067 |      -0.0071 |       0.0191 |
| PER              |         -0.0211 | ***          |     0.0043 |      -0.0295 |      -0.0128 |
| ZADULT           |          0.0012 |              |     0.0074 |      -0.0133 |       0.0158 |
| NUNITS           |          0.0005 |              |     0.0003 |      -0.0001 |       0.0012 |
| EAPTBL           |         -0.0086 |              |     0.0166 |      -0.0412 |       0.0240 |
| ECOM1            |         -0.0358 | ***          |     0.0137 |      -0.0626 |      -0.0090 |
| ECOM2            |         -0.0323 |              |     0.0369 |      -0.1046 |       0.0400 |
| EGREEN           |         -0.0014 |              |     0.0093 |      -0.0195 |       0.0167 |
| EJUNK            |          0.0155 |              |     0.0375 |      -0.0580 |       0.0889 |
| ELOW1            |          0.0030 |              |     0.0154 |      -0.0273 |       0.0332 |
| ESFD             |         -0.0424 | **           |     0.0193 |      -0.0802 |      -0.0047 |
| ETRANS           |         -0.0200 |              |     0.0179 |      -0.0551 |       0.0151 |
| EABAN            |         -0.0122 |              |     0.0272 |      -0.0655 |       0.0411 |
| ODORA            |          0.0264 |              |     0.0227 |      -0.0181 |       0.0710 |
| STRNA            |         -0.0323 | ***          |     0.0111 |      -0.0541 |      -0.0105 |
| INTW             |         -0.0177 | ***          |     0.0032 |      -0.0240 |      -0.0114 |
| MATBUY           |          0.0535 | ***          |     0.0091 |       0.0356 |       0.0713 |
| FRSTHO           |         -0.0914 | ***          |     0.0120 |      -0.1150 |      -0.0679 |
| STATE_CO         |         -0.0443 | **           |     0.0195 |      -0.0826 |      -0.0061 |
| STATE_CT         |          0.1229 | ***          |     0.0203 |       0.0831 |       0.1627 |
| STATE_GA         |         -0.1065 | ***          |     0.0212 |      -0.1482 |      -0.0649 |
| STATE_IL         |          0.0567 |              |     0.0388 |      -0.0194 |       0.1328 |
| STATE_IN         |         -0.0009 |              |     0.0207 |      -0.0415 |       0.0396 |
| STATE_LA         |          0.0653 | ***          |     0.0241 |       0.0180 |       0.1125 |
| STATE_MO         |          0.0443 | **           |     0.0221 |       0.0010 |       0.0875 |
| STATE_OH         |          0.0909 | ***          |     0.0213 |       0.0492 |       0.1326 |
| STATE_OK         |         -0.0474 | **           |     0.0226 |      -0.0918 |      -0.0031 |
| STATE_PA         |          0.0606 | ***          |     0.0225 |       0.0165 |       0.1048 |
| STATE_TX         |         -0.0137 |              |     0.0235 |      -0.0597 |       0.0324 |
| STATE_WA         |          0.0275 |              |     0.0202 |      -0.0121 |       0.0671 |
| METRO_urban      |         -0.0131 |              |     0.0126 |      -0.0378 |       0.0116 |
| HHGRAD_Bach      |          0.0393 | **           |     0.0153 |       0.0093 |       0.0694 |
| HHGRAD_Grad      |          0.0753 | ***          |     0.0169 |       0.0422 |       0.1084 |
| HHGRAD_HS_Grad   |         -0.0112 |              |     0.0149 |      -0.0403 |       0.0179 |
| HHGRAD_No_HS     |         -0.0182 |              |     0.0228 |      -0.0629 |       0.0265 |
| HOWH_good        |         -0.0277 |              |     0.0186 |      -0.0641 |       0.0086 |
| HOWN_good        |          0.0403 | **           |     0.0158 |       0.0094 |       0.0713 |
| DWNPAY_prev_home |          0.1449 | ***          |     0.0112 |       0.1230 |       0.1668 |
+------------------+-----------------+--------------+------------+--------------+--------------+</code></pre>
</div>
</div>
</section>
</section>
<section id="q5---logistic-regression-ii" class="level1">
<h1>Q5 - Logistic Regression II</h1>
<div class="cell" data-outputid="cd1f7f19-0902-4f95-ff61-c13d851b8d2b">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># assembling predictors</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>conti_cols <span class="op">=</span> [</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a> <span class="st">'log_zinc2'</span>,</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'BATHS'</span>,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'BEDRMS'</span>,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'PER'</span>,</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'ZADULT'</span>,</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'NUNITS'</span>,</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'EAPTBL'</span>,</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'ECOM1'</span>,</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a> <span class="st">'ECOM2'</span>,</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a> <span class="st">'EGREEN'</span>,</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a> <span class="st">'EJUNK'</span>,</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a> <span class="st">'ELOW1'</span>,</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a> <span class="st">'ESFD'</span>,</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a> <span class="st">'ETRANS'</span>,</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a> <span class="st">'EABAN'</span>,</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a> <span class="st">'ODORA'</span>,</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a> <span class="st">'STRNA'</span>,</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a> <span class="st">'INTW'</span>,</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a> <span class="st">'MATBUY'</span>,</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a> <span class="st">'FRSTHO'</span>]</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>assembler_predictors <span class="op">=</span> (</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>    conti_cols <span class="op">+</span></span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>    dummy_cols_state <span class="op">+</span></span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>    dummy_cols_metro <span class="op">+</span></span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>    dummy_cols_hhgrad <span class="op">+</span></span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>    dummy_cols_howh <span class="op">+</span></span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>    dummy_cols_hown <span class="op">+</span></span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>    dummy_cols_dwnpay <span class="op">+</span></span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>    interaction_cols_FRSTHO_BEDRMS</span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>assembler_4 <span class="op">=</span> VectorAssembler(</span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>    inputCols <span class="op">=</span> assembler_predictors,</span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>    outputCol <span class="op">=</span> <span class="st">"predictors"</span></span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>dtrain_4 <span class="op">=</span> assembler_4.transform(dtrain)</span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>dtest_4  <span class="op">=</span> assembler_4.transform(dtest)</span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a><span class="co"># training the model</span></span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>model_4 <span class="op">=</span> (</span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>    GeneralizedLinearRegression(featuresCol<span class="op">=</span><span class="st">"predictors"</span>,</span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a>                                labelCol<span class="op">=</span><span class="st">"GT20DWN"</span>,</span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a>                                family<span class="op">=</span><span class="st">"binomial"</span>,</span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a>                                link<span class="op">=</span><span class="st">"logit"</span>)</span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a>    .fit(dtrain_4)</span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a><span class="co"># making prediction</span></span>
<span id="cb56-52"><a href="#cb56-52" aria-hidden="true" tabindex="-1"></a>dtrain_4 <span class="op">=</span> model_4.transform(dtrain_4)</span>
<span id="cb56-53"><a href="#cb56-53" aria-hidden="true" tabindex="-1"></a>dtest_4 <span class="op">=</span> model_4.transform(dtest_4)</span>
<span id="cb56-54"><a href="#cb56-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-55"><a href="#cb56-55" aria-hidden="true" tabindex="-1"></a><span class="co"># makting regression table</span></span>
<span id="cb56-56"><a href="#cb56-56" aria-hidden="true" tabindex="-1"></a>model_4.summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="140">
<pre><code>Coefficients:
         Feature Estimate Std Error T Value P Value
     (Intercept)  -0.4319    0.3520 -1.2270  0.2198
       log_zinc2  -0.0652    0.0263 -2.4769  0.0133
           BATHS   0.3817    0.0396  9.6396  0.0000
          BEDRMS   0.0451    0.0390  1.1561  0.2477
             PER  -0.1096    0.0221 -4.9650  0.0000
          ZADULT   0.0071    0.0383  0.1845  0.8536
          NUNITS   0.0027    0.0017  1.5682  0.1168
          EAPTBL  -0.0458    0.0859 -0.5337  0.5935
           ECOM1  -0.1858    0.0707 -2.6301  0.0085
           ECOM2  -0.1673    0.1907 -0.8777  0.3801
          EGREEN  -0.0076    0.0478 -0.1587  0.8739
           EJUNK   0.0797    0.1937  0.4115  0.6807
           ELOW1   0.0149    0.0797  0.1871  0.8516
            ESFD  -0.2197    0.0996 -2.2068  0.0273
          ETRANS  -0.1032    0.0926 -1.1142  0.2652
           EABAN  -0.0634    0.1405 -0.4515  0.6516
           ODORA   0.1347    0.1176  1.1458  0.2519
           STRNA  -0.1666    0.0574 -2.9000  0.0037
            INTW  -0.0916    0.0166 -5.5117  0.0000
          MATBUY   0.2762    0.0472  5.8492  0.0000
          FRSTHO  -0.3225    0.2010 -1.6046  0.1086
        STATE_CO  -0.2316    0.1010 -2.2943  0.0218
        STATE_CT   0.6338    0.1050  6.0366  0.0000
        STATE_GA  -0.5525    0.1099 -5.0249  0.0000
        STATE_IL   0.2911    0.2008  1.4498  0.1471
        STATE_IN  -0.0057    0.1070 -0.0533  0.9575
        STATE_LA   0.3365    0.1247  2.6984  0.0070
        STATE_MO   0.2267    0.1142  1.9863  0.0470
        STATE_OH   0.4691    0.1100  4.2629  0.0000
        STATE_OK  -0.2458    0.1170 -2.1011  0.0356
        STATE_PA   0.3118    0.1164  2.6786  0.0074
        STATE_TX  -0.0704    0.1216 -0.5786  0.5628
        STATE_WA   0.1411    0.1044  1.3508  0.1768
     METRO_urban  -0.0688    0.0653 -1.0542  0.2918
     HHGRAD_Bach   0.2021    0.0792  2.5502  0.0108
     HHGRAD_Grad   0.3881    0.0873  4.4439  0.0000
  HHGRAD_HS_Grad  -0.0578    0.0768 -0.7529  0.4515
    HHGRAD_No_HS  -0.0939    0.1179 -0.7959  0.4261
       HOWH_good  -0.1418    0.0959 -1.4785  0.1393
       HOWN_good   0.2080    0.0817  2.5474  0.0109
DWNPAY_prev_home   0.7472    0.0579 12.9013  0.0000
 FRSTHO_*_BEDRMS  -0.0483    0.0614 -0.7857  0.4320

(Dispersion parameter for binomial family taken to be 1.0000)
    Null deviance: 13055.3691 on 10827 degrees of freedom
Residual deviance: 11730.5760 on 10827 degrees of freedom
AIC: 11814.5760</code></pre>
</div>
</div>
<section id="marginal-effects-1" class="level2">
<h2 class="anchored" data-anchor-id="marginal-effects-1">Marginal Effects</h2>
<div class="cell" data-outputid="056c2165-2b34-43df-eb0e-d0ee612980ac">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute means</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>means_df <span class="op">=</span> dtrain_4.select([mean(col).alias(col) <span class="cf">for</span> col <span class="kw">in</span> assembler_predictors])</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect the results as a list</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>means <span class="op">=</span> means_df.collect()[<span class="dv">0</span>]</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>means_list <span class="op">=</span> [means[col] <span class="cf">for</span> col <span class="kw">in</span> assembler_predictors]</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>table_output, df_ME <span class="op">=</span> marginal_effects(model_4, means_list) <span class="co"># Instead of mean values, some other representative values can also be chosen.</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(table_output)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+------------------+-----------------+--------------+------------+--------------+--------------+
| Variable         | Marginal Effect | Significance | Std. Error | 95% CI Lower | 95% CI Upper |
+------------------+-----------------+--------------+------------+--------------+--------------+
| log_zinc2        |         -0.0126 | **           |     0.0051 |      -0.0226 |      -0.0026 |
| BATHS            |          0.0738 | ***          |     0.0077 |       0.0588 |       0.0888 |
| BEDRMS           |          0.0087 |              |     0.0075 |      -0.0061 |       0.0235 |
| PER              |         -0.0212 | ***          |     0.0043 |      -0.0296 |      -0.0128 |
| ZADULT           |          0.0014 |              |     0.0074 |      -0.0132 |       0.0159 |
| NUNITS           |          0.0005 |              |     0.0003 |      -0.0001 |       0.0012 |
| EAPTBL           |         -0.0089 |              |     0.0166 |      -0.0414 |       0.0237 |
| ECOM1            |         -0.0359 | ***          |     0.0137 |      -0.0627 |      -0.0092 |
| ECOM2            |         -0.0324 |              |     0.0369 |      -0.1046 |       0.0399 |
| EGREEN           |         -0.0015 |              |     0.0093 |      -0.0196 |       0.0167 |
| EJUNK            |          0.0154 |              |     0.0375 |      -0.0580 |       0.0889 |
| ELOW1            |          0.0029 |              |     0.0154 |      -0.0273 |       0.0331 |
| ESFD             |         -0.0425 | **           |     0.0193 |      -0.0802 |      -0.0048 |
| ETRANS           |         -0.0200 |              |     0.0179 |      -0.0551 |       0.0151 |
| EABAN            |         -0.0123 |              |     0.0272 |      -0.0655 |       0.0410 |
| ODORA            |          0.0261 |              |     0.0227 |      -0.0185 |       0.0706 |
| STRNA            |         -0.0322 | ***          |     0.0111 |      -0.0540 |      -0.0104 |
| INTW             |         -0.0177 | ***          |     0.0032 |      -0.0240 |      -0.0114 |
| MATBUY           |          0.0534 | ***          |     0.0091 |       0.0355 |       0.0713 |
| FRSTHO           |         -0.0624 |              |     0.0389 |      -0.1385 |       0.0138 |
| STATE_CO         |         -0.0448 | **           |     0.0195 |      -0.0831 |      -0.0065 |
| STATE_CT         |          0.1226 | ***          |     0.0203 |       0.0828 |       0.1624 |
| STATE_GA         |         -0.1068 | ***          |     0.0213 |      -0.1485 |      -0.0652 |
| STATE_IL         |          0.0563 |              |     0.0388 |      -0.0198 |       0.1324 |
| STATE_IN         |         -0.0011 |              |     0.0207 |      -0.0417 |       0.0394 |
| STATE_LA         |          0.0651 | ***          |     0.0241 |       0.0178 |       0.1124 |
| STATE_MO         |          0.0439 | **           |     0.0221 |       0.0006 |       0.0871 |
| STATE_OH         |          0.0907 | ***          |     0.0213 |       0.0490 |       0.1324 |
| STATE_OK         |         -0.0475 | **           |     0.0226 |      -0.0919 |      -0.0032 |
| STATE_PA         |          0.0603 | ***          |     0.0225 |       0.0162 |       0.1044 |
| STATE_TX         |         -0.0136 |              |     0.0235 |      -0.0597 |       0.0325 |
| STATE_WA         |          0.0273 |              |     0.0202 |      -0.0123 |       0.0669 |
| METRO_urban      |         -0.0133 |              |     0.0126 |      -0.0381 |       0.0114 |
| HHGRAD_Bach      |          0.0391 | **           |     0.0153 |       0.0090 |       0.0691 |
| HHGRAD_Grad      |          0.0751 | ***          |     0.0169 |       0.0420 |       0.1082 |
| HHGRAD_HS_Grad   |         -0.0112 |              |     0.0149 |      -0.0403 |       0.0179 |
| HHGRAD_No_HS     |         -0.0182 |              |     0.0228 |      -0.0629 |       0.0266 |
| HOWH_good        |         -0.0274 |              |     0.0186 |      -0.0638 |       0.0089 |
| HOWN_good        |          0.0402 | **           |     0.0158 |       0.0093 |       0.0712 |
| DWNPAY_prev_home |          0.1445 | ***          |     0.0112 |       0.1225 |       0.1665 |
| FRSTHO_*_BEDRMS  |         -0.0093 |              |     0.0119 |      -0.0326 |       0.0140 |
+------------------+-----------------+--------------+------------+--------------+--------------+</code></pre>
</div>
</div>
</section>
</section>
<section id="q6---logistic-regression-with-sub-samples" class="level1">
<h1>Q6 - Logistic Regression with Sub-samples</h1>
<section id="over-175k-value" class="level2">
<h2 class="anchored" data-anchor-id="over-175k-value">Over 175k Value</h2>
<div class="cell" data-outputid="4d7a6ac9-b840-4010-d607-7d9e18ec532b">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># df = spark.createDataFrame(homes)</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.<span class="bu">filter</span>(col(<span class="st">"VALUE"</span>) <span class="op">&gt;=</span> <span class="dv">175000</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>dtrain, dtest <span class="op">=</span> df.randomSplit([<span class="fl">0.7</span>, <span class="fl">0.3</span>], seed <span class="op">=</span> <span class="dv">1234</span>)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>dummy_cols_state, ref_category_state <span class="op">=</span> add_dummy_variables(<span class="st">'STATE'</span>, <span class="dv">0</span>)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>dummy_cols_metro, ref_category_metro <span class="op">=</span> add_dummy_variables(<span class="st">'METRO'</span>, <span class="dv">0</span>)</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>dummy_cols_hhgrad, ref_category_hhgrad <span class="op">=</span> add_dummy_variables(<span class="st">'HHGRAD'</span>, <span class="dv">0</span>)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>dummy_cols_howh, ref_category_howh <span class="op">=</span> add_dummy_variables(<span class="st">'HOWH'</span>, <span class="dv">0</span>)</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>dummy_cols_hown, ref_category_hown <span class="op">=</span> add_dummy_variables(<span class="st">'HOWN'</span>, <span class="dv">0</span>)</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>dummy_cols_dwnpay, ref_category_dwnpay <span class="op">=</span> add_dummy_variables(<span class="st">'DWNPAY'</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reference category (dummy omitted): CA
Reference category (dummy omitted): rural
Reference category (dummy omitted): Assoc
Reference category (dummy omitted): bad
Reference category (dummy omitted): bad
Reference category (dummy omitted): other</code></pre>
</div>
</div>
<div class="cell" data-outputid="ea39b7e6-946c-4897-d4b8-fd65a0175ca4">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># assembling predictors</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>conti_cols <span class="op">=</span> [</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a> <span class="st">'log_zinc2'</span>,</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'BATHS'</span>,</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'BEDRMS'</span>,</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'PER'</span>,</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'ZADULT'</span>,</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'NUNITS'</span>,</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'EAPTBL'</span>,</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'ECOM1'</span>,</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a> <span class="st">'ECOM2'</span>,</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a> <span class="st">'EGREEN'</span>,</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a> <span class="st">'EJUNK'</span>,</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a> <span class="st">'ELOW1'</span>,</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a> <span class="st">'ESFD'</span>,</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a> <span class="st">'ETRANS'</span>,</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a> <span class="st">'EABAN'</span>,</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a> <span class="st">'ODORA'</span>,</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a> <span class="st">'STRNA'</span>,</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a> <span class="st">'INTW'</span>,</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a> <span class="st">'MATBUY'</span>,</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a> <span class="st">'FRSTHO'</span>]</span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>assembler_predictors <span class="op">=</span> (</span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>    conti_cols <span class="op">+</span></span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>    dummy_cols_state <span class="op">+</span></span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>    dummy_cols_metro <span class="op">+</span></span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>    dummy_cols_hhgrad <span class="op">+</span></span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>    dummy_cols_howh <span class="op">+</span></span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a>    dummy_cols_hown <span class="op">+</span></span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>    dummy_cols_dwnpay</span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a>assembler_5 <span class="op">=</span> VectorAssembler(</span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a>    inputCols <span class="op">=</span> assembler_predictors,</span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a>    outputCol <span class="op">=</span> <span class="st">"predictors"</span></span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true" tabindex="-1"></a>dtrain_5 <span class="op">=</span> assembler_5.transform(dtrain)</span>
<span id="cb62-40"><a href="#cb62-40" aria-hidden="true" tabindex="-1"></a>dtest_5  <span class="op">=</span> assembler_5.transform(dtest)</span>
<span id="cb62-41"><a href="#cb62-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-42"><a href="#cb62-42" aria-hidden="true" tabindex="-1"></a><span class="co"># training the model</span></span>
<span id="cb62-43"><a href="#cb62-43" aria-hidden="true" tabindex="-1"></a>model_5 <span class="op">=</span> (</span>
<span id="cb62-44"><a href="#cb62-44" aria-hidden="true" tabindex="-1"></a>    GeneralizedLinearRegression(featuresCol<span class="op">=</span><span class="st">"predictors"</span>,</span>
<span id="cb62-45"><a href="#cb62-45" aria-hidden="true" tabindex="-1"></a>                                labelCol<span class="op">=</span><span class="st">"GT20DWN"</span>,</span>
<span id="cb62-46"><a href="#cb62-46" aria-hidden="true" tabindex="-1"></a>                                family<span class="op">=</span><span class="st">"binomial"</span>,</span>
<span id="cb62-47"><a href="#cb62-47" aria-hidden="true" tabindex="-1"></a>                                link<span class="op">=</span><span class="st">"logit"</span>)</span>
<span id="cb62-48"><a href="#cb62-48" aria-hidden="true" tabindex="-1"></a>    .fit(dtrain_5)</span>
<span id="cb62-49"><a href="#cb62-49" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-50"><a href="#cb62-50" aria-hidden="true" tabindex="-1"></a><span class="co"># making prediction</span></span>
<span id="cb62-51"><a href="#cb62-51" aria-hidden="true" tabindex="-1"></a>dtrain_5 <span class="op">=</span> model_5.transform(dtrain_5)</span>
<span id="cb62-52"><a href="#cb62-52" aria-hidden="true" tabindex="-1"></a>dtest_5 <span class="op">=</span> model_5.transform(dtest_5)</span>
<span id="cb62-53"><a href="#cb62-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-54"><a href="#cb62-54" aria-hidden="true" tabindex="-1"></a><span class="co"># makting regression table</span></span>
<span id="cb62-55"><a href="#cb62-55" aria-hidden="true" tabindex="-1"></a>model_5.summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="148">
<pre><code>Coefficients:
         Feature Estimate Std Error T Value P Value
     (Intercept)  -0.9444    0.4785 -1.9736  0.0484
       log_zinc2  -0.0414    0.0341 -1.2147  0.2245
           BATHS   0.3740    0.0488  7.6637  0.0000
          BEDRMS  -0.0106    0.0448 -0.2366  0.8130
             PER  -0.0848    0.0285 -2.9738  0.0029
          ZADULT  -0.0055    0.0504 -0.1097  0.9126
          NUNITS   0.0003    0.0053  0.0629  0.9498
          EAPTBL   0.1634    0.1285  1.2720  0.2034
           ECOM1   0.0229    0.1008  0.2270  0.8204
           ECOM2  -0.3561    0.3508 -1.0151  0.3100
          EGREEN   0.0111    0.0625  0.1771  0.8594
           EJUNK  -0.3499    0.3340 -1.0478  0.2947
           ELOW1  -0.0640    0.1113 -0.5753  0.5651
            ESFD  -0.2295    0.1661 -1.3821  0.1670
          ETRANS  -0.1628    0.1377 -1.1824  0.2371
           EABAN  -0.4304    0.2659 -1.6187  0.1055
           ODORA   0.3021    0.1704  1.7735  0.0761
           STRNA  -0.2275    0.0815 -2.7911  0.0053
            INTW  -0.0823    0.0259 -3.1832  0.0015
          MATBUY   0.5120    0.0619  8.2768  0.0000
          FRSTHO  -0.4224    0.0910 -4.6425  0.0000
        STATE_CO  -0.1388    0.1055 -1.3151  0.1885
        STATE_CT   0.6874    0.1167  5.8879  0.0000
        STATE_GA  -0.3892    0.1298 -2.9974  0.0027
        STATE_IL   0.1701    0.3273  0.5199  0.6031
        STATE_IN   0.1883    0.1450  1.2984  0.1941
        STATE_LA   0.7247    0.1839  3.9407  0.0001
        STATE_MO   0.5225    0.1440  3.6286  0.0003
        STATE_OH   0.7060    0.1502  4.7010  0.0000
        STATE_OK   0.2419    0.1920  1.2598  0.2077
        STATE_PA   0.6531    0.1790  3.6481  0.0003
        STATE_TX   0.2097    0.2249  0.9323  0.3512
        STATE_WA   0.0200    0.1117  0.1792  0.8578
     METRO_urban  -0.0247    0.0936 -0.2639  0.7918
     HHGRAD_Bach   0.2805    0.1079  2.5987  0.0094
     HHGRAD_Grad   0.3803    0.1151  3.3050  0.0009
  HHGRAD_HS_Grad   0.0370    0.1096  0.3371  0.7360
    HHGRAD_No_HS  -0.1526    0.1968 -0.7754  0.4381
       HOWH_good  -0.1439    0.1509 -0.9532  0.3405
       HOWN_good   0.3543    0.1234  2.8711  0.0041
DWNPAY_prev_home   0.7196    0.0751  9.5884  0.0000

(Dispersion parameter for binomial family taken to be 1.0000)
    Null deviance: 7217.9381 on 5475 degrees of freedom
Residual deviance: 6487.1260 on 5475 degrees of freedom
AIC: 6569.1260</code></pre>
</div>
</div>
<section id="marginal-effects-2" class="level3">
<h3 class="anchored" data-anchor-id="marginal-effects-2">Marginal Effects</h3>
<div class="cell" data-outputid="04d0a460-bee2-4d71-d7e9-f0248da43073">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute means</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>means_df <span class="op">=</span> dtrain_5.select([mean(col).alias(col) <span class="cf">for</span> col <span class="kw">in</span> assembler_predictors])</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect the results as a list</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>means <span class="op">=</span> means_df.collect()[<span class="dv">0</span>]</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>means_list <span class="op">=</span> [means[col] <span class="cf">for</span> col <span class="kw">in</span> assembler_predictors]</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>table_output, df_ME <span class="op">=</span> marginal_effects(model_5, means_list) <span class="co"># Instead of mean values, some other representative values can also be chosen.</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(table_output)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+------------------+-----------------+--------------+------------+--------------+--------------+
| Variable         | Marginal Effect | Significance | Std. Error | 95% CI Lower | 95% CI Upper |
+------------------+-----------------+--------------+------------+--------------+--------------+
| log_zinc2        |         -0.0093 |              |     0.0077 |      -0.0243 |       0.0057 |
| BATHS            |          0.0840 | ***          |     0.0110 |       0.0625 |       0.1054 |
| BEDRMS           |         -0.0024 |              |     0.0101 |      -0.0221 |       0.0173 |
| PER              |         -0.0190 | ***          |     0.0064 |      -0.0316 |      -0.0065 |
| ZADULT           |         -0.0012 |              |     0.0113 |      -0.0234 |       0.0210 |
| NUNITS           |          0.0001 |              |     0.0012 |      -0.0023 |       0.0024 |
| EAPTBL           |          0.0367 |              |     0.0288 |      -0.0198 |       0.0932 |
| ECOM1            |          0.0051 |              |     0.0226 |      -0.0392 |       0.0495 |
| ECOM2            |         -0.0799 |              |     0.0788 |      -0.2343 |       0.0744 |
| EGREEN           |          0.0025 |              |     0.0140 |      -0.0250 |       0.0300 |
| EJUNK            |         -0.0786 |              |     0.0750 |      -0.2255 |       0.0684 |
| ELOW1            |         -0.0144 |              |     0.0250 |      -0.0634 |       0.0346 |
| ESFD             |         -0.0515 |              |     0.0373 |      -0.1246 |       0.0215 |
| ETRANS           |         -0.0366 |              |     0.0309 |      -0.0972 |       0.0240 |
| EABAN            |         -0.0966 |              |     0.0597 |      -0.2137 |       0.0204 |
| ODORA            |          0.0678 | *            |     0.0382 |      -0.0071 |       0.1428 |
| STRNA            |         -0.0511 | ***          |     0.0183 |      -0.0869 |      -0.0152 |
| INTW             |         -0.0185 | ***          |     0.0058 |      -0.0299 |      -0.0071 |
| MATBUY           |          0.1150 | ***          |     0.0139 |       0.0877 |       0.1422 |
| FRSTHO           |         -0.0948 | ***          |     0.0204 |      -0.1349 |      -0.0548 |
| STATE_CO         |         -0.0312 |              |     0.0237 |      -0.0776 |       0.0153 |
| STATE_CT         |          0.1543 | ***          |     0.0262 |       0.1030 |       0.2057 |
| STATE_GA         |         -0.0874 | ***          |     0.0292 |      -0.1445 |      -0.0302 |
| STATE_IL         |          0.0382 |              |     0.0735 |      -0.1058 |       0.1822 |
| STATE_IN         |          0.0423 |              |     0.0326 |      -0.0215 |       0.1061 |
| STATE_LA         |          0.1627 | ***          |     0.0413 |       0.0818 |       0.2436 |
| STATE_MO         |          0.1173 | ***          |     0.0323 |       0.0539 |       0.1807 |
| STATE_OH         |          0.1585 | ***          |     0.0337 |       0.0924 |       0.2246 |
| STATE_OK         |          0.0543 |              |     0.0431 |      -0.0302 |       0.1388 |
| STATE_PA         |          0.1466 | ***          |     0.0402 |       0.0678 |       0.2254 |
| STATE_TX         |          0.0471 |              |     0.0505 |      -0.0519 |       0.1460 |
| STATE_WA         |          0.0045 |              |     0.0251 |      -0.0447 |       0.0536 |
| METRO_urban      |         -0.0055 |              |     0.0210 |      -0.0468 |       0.0357 |
| HHGRAD_Bach      |          0.0630 | ***          |     0.0242 |       0.0155 |       0.1105 |
| HHGRAD_Grad      |          0.0854 | ***          |     0.0258 |       0.0347 |       0.1360 |
| HHGRAD_HS_Grad   |          0.0083 |              |     0.0246 |      -0.0400 |       0.0565 |
| HHGRAD_No_HS     |         -0.0343 |              |     0.0442 |      -0.1209 |       0.0523 |
| HOWH_good        |         -0.0323 |              |     0.0339 |      -0.0987 |       0.0341 |
| HOWN_good        |          0.0796 | ***          |     0.0277 |       0.0252 |       0.1339 |
| DWNPAY_prev_home |          0.1616 | ***          |     0.0169 |       0.1285 |       0.1946 |
+------------------+-----------------+--------------+------------+--------------+--------------+</code></pre>
</div>
</div>
</section>
<section id="classification" class="level3">
<h3 class="anchored" data-anchor-id="classification">Classification</h3>
<div class="cell" data-outputid="cc4cc166-2fd3-453e-a38a-236b620dccf0">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter training data for atRisk == 1 and atRisk == 0</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>pdf <span class="op">=</span> dtrain_5.select(<span class="st">"prediction"</span>, <span class="st">"GT20DWN"</span>).toPandas()</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>train_true <span class="op">=</span> pdf[pdf[<span class="st">"GT20DWN"</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>train_false <span class="op">=</span> pdf[pdf[<span class="st">"GT20DWN"</span>] <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the first density plot</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(train_true[<span class="st">"prediction"</span>], label<span class="op">=</span><span class="st">"TRUE"</span>, color<span class="op">=</span><span class="st">"red"</span>, fill<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(train_false[<span class="st">"prediction"</span>], label<span class="op">=</span><span class="st">"FALSE"</span>, color<span class="op">=</span><span class="st">"blue"</span>, fill<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Prediction"</span>)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Density"</span>)</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Density Plot of Predictions"</span>)</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">"GT20DWN"</span>)</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="danl_320_hw3_linear_regression_logistic_regression_housing_markets_files/figure-html/cell-44-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-outputid="82adcc17-abc5-4638-8173-732a002f6263">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define threshold for vertical line</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>threshold <span class="op">=</span> <span class="fl">0.3767</span>  <span class="co"># Replace with actual value</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the second density plot with vertical line</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(train_true[<span class="st">"prediction"</span>], label<span class="op">=</span><span class="st">"TRUE"</span>, color<span class="op">=</span><span class="st">"red"</span>, fill<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(train_false[<span class="st">"prediction"</span>], label<span class="op">=</span><span class="st">"FALSE"</span>, color<span class="op">=</span><span class="st">"blue"</span>, fill<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>plt.axvline(x<span class="op">=</span>threshold, color<span class="op">=</span><span class="st">"blue"</span>, linestyle<span class="op">=</span><span class="st">"dashed"</span>, label<span class="op">=</span><span class="ss">f"Threshold = </span><span class="sc">{</span>threshold<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Prediction"</span>)</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Density"</span>)</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Density Plot of Predictions with Threshold"</span>)</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">"GT20DWN"</span>)</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="danl_320_hw3_linear_regression_logistic_regression_housing_markets_files/figure-html/cell-45-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-outputid="69a9ebbc-af90-493b-d4d6-097bdb760074">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute confusion matrix</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>dtest_5 <span class="op">=</span> dtest_5.withColumn(<span class="st">"predicted_class"</span>, when(col(<span class="st">"prediction"</span>) <span class="op">&gt;</span> <span class="fl">.3767</span>, <span class="dv">1</span>).otherwise(<span class="dv">0</span>))</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> dtest_5.groupBy(<span class="st">"GT20DWN"</span>, <span class="st">"predicted_class"</span>).count().orderBy(<span class="st">"GT20DWN"</span>, <span class="st">"predicted_class"</span>)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>TP <span class="op">=</span> dtest_5.<span class="bu">filter</span>((col(<span class="st">"GT20DWN"</span>) <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (col(<span class="st">"predicted_class"</span>) <span class="op">==</span> <span class="dv">1</span>)).count()</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>FP <span class="op">=</span> dtest_5.<span class="bu">filter</span>((col(<span class="st">"GT20DWN"</span>) <span class="op">==</span> <span class="dv">0</span>) <span class="op">&amp;</span> (col(<span class="st">"predicted_class"</span>) <span class="op">==</span> <span class="dv">1</span>)).count()</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>FN <span class="op">=</span> dtest_5.<span class="bu">filter</span>((col(<span class="st">"GT20DWN"</span>) <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (col(<span class="st">"predicted_class"</span>) <span class="op">==</span> <span class="dv">0</span>)).count()</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>TN <span class="op">=</span> dtest_5.<span class="bu">filter</span>((col(<span class="st">"GT20DWN"</span>) <span class="op">==</span> <span class="dv">0</span>) <span class="op">&amp;</span> (col(<span class="st">"predicted_class"</span>) <span class="op">==</span> <span class="dv">0</span>)).count()</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> (TP <span class="op">+</span> TN) <span class="op">/</span> (TP <span class="op">+</span> FP <span class="op">+</span> FN <span class="op">+</span> TN)</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>precision <span class="op">=</span> TP <span class="op">/</span> (TP <span class="op">+</span> FP)</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>recall <span class="op">=</span> TP <span class="op">/</span> (TP <span class="op">+</span> FN)</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>specificity <span class="op">=</span> TN <span class="op">/</span> (TN <span class="op">+</span> FP)</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>average_rate <span class="op">=</span> (TP <span class="op">+</span> FN) <span class="op">/</span> (TP <span class="op">+</span> TN <span class="op">+</span> FP <span class="op">+</span> FN)  <span class="co"># Proportion of actual at-risk babies</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>enrichment <span class="op">=</span> precision <span class="op">/</span> average_rate</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Print formatted confusion matrix with labels</span></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st"> Confusion Matrix:</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"                     Predicted"</span>)</span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"            |  Negative  |  Positive  "</span>)</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"------------+------------+------------"</span>)</span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Actual Neg. |    </span><span class="sc">{</span>TN<span class="sc">:5}</span><span class="ss">   |    </span><span class="sc">{</span>FP<span class="sc">:5}</span><span class="ss">  |"</span>)</span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"------------+------------+------------"</span>)</span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Actual Pos. |    </span><span class="sc">{</span>FN<span class="sc">:5}</span><span class="ss">   |    </span><span class="sc">{</span>TP<span class="sc">:5}</span><span class="ss">  |"</span>)</span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"------------+------------+------------"</span>)</span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Accuracy:  </span><span class="sc">{</span>accuracy<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Precision: </span><span class="sc">{</span>precision<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Recall (Sensitivity): </span><span class="sc">{</span>recall<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Specificity:  </span><span class="sc">{</span>specificity<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average Rate: </span><span class="sc">{</span>average_rate<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Enrichment:   </span><span class="sc">{</span>enrichment<span class="sc">:.4f}</span><span class="ss"> (Relative Precision)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Confusion Matrix:

                     Predicted
            |  Negative  |  Positive  
------------+------------+------------
Actual Neg. |      919   |      460  |
------------+------------+------------
Actual Pos. |      333   |      544  |
------------+------------+------------
Accuracy:  0.6485
Precision: 0.5418
Recall (Sensitivity): 0.6203
Specificity:  0.6664
Average Rate: 0.3887
Enrichment:   1.3938 (Relative Precision)</code></pre>
</div>
</div>
<div class="cell" data-outputid="487fb77e-a7cc-4f49-d71d-74c38334460d">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use probability of the positive class (y=1)</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>evaluator <span class="op">=</span> BinaryClassificationEvaluator(labelCol<span class="op">=</span><span class="st">"GT20DWN"</span>, rawPredictionCol<span class="op">=</span><span class="st">"prediction"</span>, metricName<span class="op">=</span><span class="st">"areaUnderROC"</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate AUC</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>auc <span class="op">=</span> evaluator.evaluate(dtest_5)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"AUC: </span><span class="sc">{</span>auc<span class="sc">:.4f}</span><span class="ss">"</span>)  <span class="co"># Higher is better (closer to 1)</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to Pandas</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>pdf <span class="op">=</span> dtest_5.select(<span class="st">"prediction"</span>, <span class="st">"GT20DWN"</span>).toPandas()</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute ROC curve</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>fpr, tpr, _ <span class="op">=</span> roc_curve(pdf[<span class="st">"GT20DWN"</span>], pdf[<span class="st">"prediction"</span>])</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot ROC curve</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">6</span>))</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>plt.plot(fpr, tpr, label<span class="op">=</span><span class="ss">f"ROC Curve (AUC = </span><span class="sc">{</span>auc<span class="sc">:.4f}</span><span class="ss">)"</span>)</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>, label<span class="op">=</span><span class="st">"Random Guess"</span>)</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"False Positive Rate"</span>)</span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"True Positive Rate"</span>)</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"ROC Curve"</span>)</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AUC: 0.7084</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="danl_320_hw3_linear_regression_logistic_regression_housing_markets_files/figure-html/cell-47-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-outputid="ef9ec844-184c-4334-cf1b-8fc63ca31769">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>pdf <span class="op">=</span> dtest_5.select(<span class="st">"prediction"</span>, <span class="st">"GT20DWN"</span>).toPandas()</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract predictions and true labels</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>y_true <span class="op">=</span> pdf[<span class="st">"GT20DWN"</span>]  <span class="co"># True labels</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>y_scores <span class="op">=</span> pdf[<span class="st">"prediction"</span>]  <span class="co"># Predicted probabilities</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute precision, recall, and thresholds</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>precision_plot, recall_plot, thresholds <span class="op">=</span> precision_recall_curve(y_true, y_scores)</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute enrichment: precision divided by average at-risk rate</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>average_rate <span class="op">=</span> np.mean(y_true)</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>enrichment_plot <span class="op">=</span> precision_plot <span class="op">/</span> average_rate</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Define optimal threshold (example: threshold where recall ≈ enrichment balance)</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>threshold <span class="op">=</span> <span class="fl">0.3767</span>  <span class="co"># Adjust based on the plot</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Enrichment vs. Recall vs. Threshold</span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>plt.plot(thresholds, enrichment_plot[:<span class="op">-</span><span class="dv">1</span>], label<span class="op">=</span><span class="st">"Enrichment"</span>, color<span class="op">=</span><span class="st">"blue"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>)</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>plt.plot(thresholds, recall_plot[:<span class="op">-</span><span class="dv">1</span>], label<span class="op">=</span><span class="st">"Recall"</span>, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">"-"</span>)</span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Add vertical line for chosen threshold</span></span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>plt.axvline(x<span class="op">=</span>threshold, color<span class="op">=</span><span class="st">"black"</span>, linestyle<span class="op">=</span><span class="st">"dashed"</span>, label<span class="op">=</span><span class="ss">f"Threshold = </span><span class="sc">{</span>threshold<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Labels and legend</span></span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Threshold"</span>)</span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Score"</span>)</span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Enrichment vs. Recall"</span>)</span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="danl_320_hw3_linear_regression_logistic_regression_housing_markets_files/figure-html/cell-48-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="under-175k-value" class="level2">
<h2 class="anchored" data-anchor-id="under-175k-value">Under 175k Value</h2>
<div class="cell" data-outputid="9efc2c81-3f62-49f5-f62b-e2b4662cc7b8">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> spark.createDataFrame(homes)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.<span class="bu">filter</span>(col(<span class="st">"VALUE"</span>) <span class="op">&lt;</span> <span class="dv">175000</span>)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>dtrain, dtest <span class="op">=</span> df.randomSplit([<span class="fl">0.7</span>, <span class="fl">0.3</span>], seed <span class="op">=</span> <span class="dv">1234</span>)</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>dummy_cols_state, ref_category_state <span class="op">=</span> add_dummy_variables(<span class="st">'STATE'</span>, <span class="dv">0</span>)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>dummy_cols_metro, ref_category_metro <span class="op">=</span> add_dummy_variables(<span class="st">'METRO'</span>, <span class="dv">0</span>)</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>dummy_cols_hhgrad, ref_category_hhgrad <span class="op">=</span> add_dummy_variables(<span class="st">'HHGRAD'</span>, <span class="dv">0</span>)</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>dummy_cols_howh, ref_category_howh <span class="op">=</span> add_dummy_variables(<span class="st">'HOWH'</span>, <span class="dv">0</span>)</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>dummy_cols_hown, ref_category_hown <span class="op">=</span> add_dummy_variables(<span class="st">'HOWN'</span>, <span class="dv">0</span>)</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>dummy_cols_dwnpay, ref_category_dwnpay <span class="op">=</span> add_dummy_variables(<span class="st">'DWNPAY'</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reference category (dummy omitted): CA
Reference category (dummy omitted): rural
Reference category (dummy omitted): Assoc
Reference category (dummy omitted): bad
Reference category (dummy omitted): bad
Reference category (dummy omitted): other</code></pre>
</div>
</div>
<div class="cell" data-outputid="b625658e-cc34-4465-8498-a8df48481424">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># assembling predictors</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>conti_cols <span class="op">=</span> [</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a> <span class="st">'log_zinc2'</span>,</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'BATHS'</span>,</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'BEDRMS'</span>,</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'PER'</span>,</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'ZADULT'</span>,</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'NUNITS'</span>,</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'EAPTBL'</span>,</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'ECOM1'</span>,</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a> <span class="st">'ECOM2'</span>,</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a> <span class="st">'EGREEN'</span>,</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a> <span class="st">'EJUNK'</span>,</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a> <span class="st">'ELOW1'</span>,</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a> <span class="st">'ESFD'</span>,</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a> <span class="st">'ETRANS'</span>,</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a> <span class="st">'EABAN'</span>,</span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a> <span class="st">'ODORA'</span>,</span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a> <span class="st">'STRNA'</span>,</span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a> <span class="st">'INTW'</span>,</span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a> <span class="st">'MATBUY'</span>,</span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a> <span class="st">'FRSTHO'</span>]</span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>assembler_predictors <span class="op">=</span> (</span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a>    conti_cols <span class="op">+</span></span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a>    dummy_cols_state <span class="op">+</span></span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a>    dummy_cols_metro <span class="op">+</span></span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a>    dummy_cols_hhgrad <span class="op">+</span></span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a>    dummy_cols_howh <span class="op">+</span></span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true" tabindex="-1"></a>    dummy_cols_hown <span class="op">+</span></span>
<span id="cb75-31"><a href="#cb75-31" aria-hidden="true" tabindex="-1"></a>    dummy_cols_dwnpay</span>
<span id="cb75-32"><a href="#cb75-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb75-33"><a href="#cb75-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-34"><a href="#cb75-34" aria-hidden="true" tabindex="-1"></a>assembler_6 <span class="op">=</span> VectorAssembler(</span>
<span id="cb75-35"><a href="#cb75-35" aria-hidden="true" tabindex="-1"></a>    inputCols <span class="op">=</span> assembler_predictors,</span>
<span id="cb75-36"><a href="#cb75-36" aria-hidden="true" tabindex="-1"></a>    outputCol <span class="op">=</span> <span class="st">"predictors"</span></span>
<span id="cb75-37"><a href="#cb75-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb75-38"><a href="#cb75-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-39"><a href="#cb75-39" aria-hidden="true" tabindex="-1"></a>dtrain_6 <span class="op">=</span> assembler_6.transform(dtrain)</span>
<span id="cb75-40"><a href="#cb75-40" aria-hidden="true" tabindex="-1"></a>dtest_6  <span class="op">=</span> assembler_6.transform(dtest)</span>
<span id="cb75-41"><a href="#cb75-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-42"><a href="#cb75-42" aria-hidden="true" tabindex="-1"></a><span class="co"># training the model</span></span>
<span id="cb75-43"><a href="#cb75-43" aria-hidden="true" tabindex="-1"></a>model_6 <span class="op">=</span> (</span>
<span id="cb75-44"><a href="#cb75-44" aria-hidden="true" tabindex="-1"></a>    GeneralizedLinearRegression(featuresCol<span class="op">=</span><span class="st">"predictors"</span>,</span>
<span id="cb75-45"><a href="#cb75-45" aria-hidden="true" tabindex="-1"></a>                                labelCol<span class="op">=</span><span class="st">"GT20DWN"</span>,</span>
<span id="cb75-46"><a href="#cb75-46" aria-hidden="true" tabindex="-1"></a>                                family<span class="op">=</span><span class="st">"binomial"</span>,</span>
<span id="cb75-47"><a href="#cb75-47" aria-hidden="true" tabindex="-1"></a>                                link<span class="op">=</span><span class="st">"logit"</span>)</span>
<span id="cb75-48"><a href="#cb75-48" aria-hidden="true" tabindex="-1"></a>    .fit(dtrain_6)</span>
<span id="cb75-49"><a href="#cb75-49" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb75-50"><a href="#cb75-50" aria-hidden="true" tabindex="-1"></a><span class="co"># making prediction</span></span>
<span id="cb75-51"><a href="#cb75-51" aria-hidden="true" tabindex="-1"></a>dtrain_6 <span class="op">=</span> model_6.transform(dtrain_6)</span>
<span id="cb75-52"><a href="#cb75-52" aria-hidden="true" tabindex="-1"></a>dtest_6 <span class="op">=</span> model_6.transform(dtest_6)</span>
<span id="cb75-53"><a href="#cb75-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-54"><a href="#cb75-54" aria-hidden="true" tabindex="-1"></a><span class="co"># makting regression table</span></span>
<span id="cb75-55"><a href="#cb75-55" aria-hidden="true" tabindex="-1"></a>model_6.summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="166">
<pre><code>Coefficients:
         Feature Estimate Std Error T Value P Value
     (Intercept)   1.5459    0.5823  2.6546  0.0079
       log_zinc2  -0.1247    0.0417 -2.9944  0.0028
           BATHS   0.1486    0.0696  2.1349  0.0328
          BEDRMS   0.0110    0.0560  0.1961  0.8445
             PER  -0.1603    0.0357 -4.4872  0.0000
          ZADULT   0.0811    0.0591  1.3720  0.1701
          NUNITS   0.0022    0.0016  1.3485  0.1775
          EAPTBL   0.0289    0.1099  0.2633  0.7923
           ECOM1  -0.3379    0.0977 -3.4595  0.0005
           ECOM2  -0.1490    0.2234 -0.6667  0.5049
          EGREEN  -0.0439    0.0745 -0.5890  0.5559
           EJUNK  -0.1720    0.2479 -0.6937  0.4879
           ELOW1   0.0458    0.1164  0.3931  0.6942
            ESFD  -0.2187    0.1301 -1.6815  0.0927
          ETRANS   0.0740    0.1189  0.6222  0.5338
           EABAN  -0.0901    0.1612 -0.5589  0.5762
           ODORA   0.0859    0.1574  0.5456  0.5853
           STRNA  -0.0301    0.0806 -0.3735  0.7088
            INTW  -0.0624    0.0210 -2.9746  0.0029
          MATBUY  -0.1199    0.0715 -1.6767  0.0936
          FRSTHO  -0.3768    0.0855 -4.4051  0.0000
        STATE_CO  -1.2002    0.3436 -3.4926  0.0005
        STATE_CT  -0.1410    0.3118 -0.4521  0.6512
        STATE_GA  -1.1278    0.3107 -3.6294  0.0003
        STATE_IL  -0.3090    0.3513 -0.8796  0.3791
        STATE_IN  -0.8464    0.3008 -2.8141  0.0049
        STATE_LA  -0.4525    0.3103 -1.4584  0.1447
        STATE_MO  -0.7814    0.3110 -2.5126  0.0120
        STATE_OH  -0.2886    0.3031 -0.9522  0.3410
        STATE_OK  -0.9326    0.3027 -3.0812  0.0021
        STATE_PA  -0.5283    0.3044 -1.7353  0.0827
        STATE_TX  -0.7327    0.3051 -2.4015  0.0163
        STATE_WA  -0.5304    0.3546 -1.4956  0.1348
     METRO_urban  -0.1059    0.0910 -1.1632  0.2448
     HHGRAD_Bach   0.1352    0.1175  1.1498  0.2502
     HHGRAD_Grad   0.2345    0.1399  1.6755  0.0938
  HHGRAD_HS_Grad  -0.0571    0.1057 -0.5399  0.5892
    HHGRAD_No_HS  -0.2540    0.1541 -1.6478  0.0994
       HOWH_good  -0.1156    0.1226 -0.9430  0.3457
       HOWN_good   0.1000    0.1057  0.9456  0.3444
DWNPAY_prev_home   0.6405    0.0939  6.8220  0.0000

(Dispersion parameter for binomial family taken to be 1.0000)
    Null deviance: 5724.5375 on 5407 degrees of freedom
Residual deviance: 5372.3945 on 5407 degrees of freedom
AIC: 5454.3945</code></pre>
</div>
</div>
<section id="marginal-effects-3" class="level3">
<h3 class="anchored" data-anchor-id="marginal-effects-3">Marginal Effects</h3>
<div class="cell" data-outputid="8205a0f0-20f0-417a-976a-996ad1ca2901">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute means</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>means_df <span class="op">=</span> dtrain_6.select([mean(col).alias(col) <span class="cf">for</span> col <span class="kw">in</span> assembler_predictors])</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect the results as a list</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>means <span class="op">=</span> means_df.collect()[<span class="dv">0</span>]</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>means_list <span class="op">=</span> [means[col] <span class="cf">for</span> col <span class="kw">in</span> assembler_predictors]</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>table_output, df_ME <span class="op">=</span> marginal_effects(model_6, means_list) <span class="co"># Instead of mean values, some other representative values can also be chosen.</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(table_output)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+------------------+-----------------+--------------+------------+--------------+--------------+
| Variable         | Marginal Effect | Significance | Std. Error | 95% CI Lower | 95% CI Upper |
+------------------+-----------------+--------------+------------+--------------+--------------+
| log_zinc2        |         -0.0201 | ***          |     0.0067 |      -0.0332 |      -0.0069 |
| BATHS            |          0.0239 | **           |     0.0112 |       0.0020 |       0.0458 |
| BEDRMS           |          0.0018 |              |     0.0090 |      -0.0159 |       0.0194 |
| PER              |         -0.0258 | ***          |     0.0057 |      -0.0370 |      -0.0145 |
| ZADULT           |          0.0130 |              |     0.0095 |      -0.0056 |       0.0317 |
| NUNITS           |          0.0004 |              |     0.0003 |      -0.0002 |       0.0009 |
| EAPTBL           |          0.0047 |              |     0.0177 |      -0.0300 |       0.0393 |
| ECOM1            |         -0.0543 | ***          |     0.0157 |      -0.0851 |      -0.0235 |
| ECOM2            |         -0.0239 |              |     0.0359 |      -0.0944 |       0.0465 |
| EGREEN           |         -0.0071 |              |     0.0120 |      -0.0305 |       0.0164 |
| EJUNK            |         -0.0276 |              |     0.0399 |      -0.1058 |       0.0505 |
| ELOW1            |          0.0074 |              |     0.0187 |      -0.0293 |       0.0440 |
| ESFD             |         -0.0352 | *            |     0.0209 |      -0.0762 |       0.0058 |
| ETRANS           |          0.0119 |              |     0.0191 |      -0.0256 |       0.0494 |
| EABAN            |         -0.0145 |              |     0.0259 |      -0.0653 |       0.0363 |
| ODORA            |          0.0138 |              |     0.0253 |      -0.0358 |       0.0634 |
| STRNA            |         -0.0048 |              |     0.0130 |      -0.0302 |       0.0206 |
| INTW             |         -0.0100 | ***          |     0.0034 |      -0.0167 |      -0.0034 |
| MATBUY           |         -0.0193 | *            |     0.0115 |      -0.0418 |       0.0033 |
| FRSTHO           |         -0.0606 | ***          |     0.0138 |      -0.0875 |      -0.0336 |
| STATE_CO         |         -0.1930 | ***          |     0.0552 |      -0.3012 |      -0.0847 |
| STATE_CT         |         -0.0227 |              |     0.0501 |      -0.1209 |       0.0756 |
| STATE_GA         |         -0.1813 | ***          |     0.0500 |      -0.2792 |      -0.0834 |
| STATE_IL         |         -0.0497 |              |     0.0565 |      -0.1604 |       0.0610 |
| STATE_IN         |         -0.1361 | ***          |     0.0484 |      -0.2309 |      -0.0413 |
| STATE_LA         |         -0.0728 |              |     0.0499 |      -0.1705 |       0.0250 |
| STATE_MO         |         -0.1256 | **           |     0.0500 |      -0.2236 |      -0.0276 |
| STATE_OH         |         -0.0464 |              |     0.0487 |      -0.1419 |       0.0491 |
| STATE_OK         |         -0.1499 | ***          |     0.0487 |      -0.2453 |      -0.0546 |
| STATE_PA         |         -0.0849 | *            |     0.0489 |      -0.1809 |       0.0110 |
| STATE_TX         |         -0.1178 | **           |     0.0491 |      -0.2139 |      -0.0217 |
| STATE_WA         |         -0.0853 |              |     0.0570 |      -0.1970 |       0.0265 |
| METRO_urban      |         -0.0170 |              |     0.0146 |      -0.0457 |       0.0117 |
| HHGRAD_Bach      |          0.0217 |              |     0.0189 |      -0.0153 |       0.0588 |
| HHGRAD_Grad      |          0.0377 | *            |     0.0225 |      -0.0064 |       0.0818 |
| HHGRAD_HS_Grad   |         -0.0092 |              |     0.0170 |      -0.0425 |       0.0241 |
| HHGRAD_No_HS     |         -0.0408 | *            |     0.0248 |      -0.0894 |       0.0077 |
| HOWH_good        |         -0.0186 |              |     0.0197 |      -0.0572 |       0.0200 |
| HOWN_good        |          0.0161 |              |     0.0170 |      -0.0172 |       0.0494 |
| DWNPAY_prev_home |          0.1030 | ***          |     0.0151 |       0.0734 |       0.1326 |
+------------------+-----------------+--------------+------------+--------------+--------------+</code></pre>
</div>
</div>
</section>
<section id="classification-1" class="level3">
<h3 class="anchored" data-anchor-id="classification-1">Classification</h3>
<div class="cell" data-outputid="db7c5bd2-8f6c-4b87-8a23-f51f66255fcb">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter training data for atRisk == 1 and atRisk == 0</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>pdf <span class="op">=</span> dtrain_6.select(<span class="st">"prediction"</span>, <span class="st">"GT20DWN"</span>).toPandas()</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>train_true <span class="op">=</span> pdf[pdf[<span class="st">"GT20DWN"</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>train_false <span class="op">=</span> pdf[pdf[<span class="st">"GT20DWN"</span>] <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the first density plot</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(train_true[<span class="st">"prediction"</span>], label<span class="op">=</span><span class="st">"TRUE"</span>, color<span class="op">=</span><span class="st">"red"</span>, fill<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(train_false[<span class="st">"prediction"</span>], label<span class="op">=</span><span class="st">"FALSE"</span>, color<span class="op">=</span><span class="st">"blue"</span>, fill<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Prediction"</span>)</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Density"</span>)</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Density Plot of Predictions"</span>)</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">"GT20DWN"</span>)</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="danl_320_hw3_linear_regression_logistic_regression_housing_markets_files/figure-html/cell-52-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-outputid="f315fe3a-2896-4fbf-b031-1f89aef1cded">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define threshold for vertical line</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>threshold <span class="op">=</span> <span class="fl">0.24</span>  <span class="co"># Replace with actual value</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the second density plot with vertical line</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(train_true[<span class="st">"prediction"</span>], label<span class="op">=</span><span class="st">"TRUE"</span>, color<span class="op">=</span><span class="st">"red"</span>, fill<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(train_false[<span class="st">"prediction"</span>], label<span class="op">=</span><span class="st">"FALSE"</span>, color<span class="op">=</span><span class="st">"blue"</span>, fill<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>plt.axvline(x<span class="op">=</span>threshold, color<span class="op">=</span><span class="st">"blue"</span>, linestyle<span class="op">=</span><span class="st">"dashed"</span>, label<span class="op">=</span><span class="ss">f"Threshold = </span><span class="sc">{</span>threshold<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Prediction"</span>)</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Density"</span>)</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Density Plot of Predictions with Threshold"</span>)</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">"GT20DWN"</span>)</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="danl_320_hw3_linear_regression_logistic_regression_housing_markets_files/figure-html/cell-53-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-outputid="f6632613-23ce-4006-8961-3f8b45e46dae">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute confusion matrix</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>dtest_6 <span class="op">=</span> dtest_6.withColumn(<span class="st">"predicted_class"</span>, when(col(<span class="st">"prediction"</span>) <span class="op">&gt;</span> <span class="fl">.24</span>, <span class="dv">1</span>).otherwise(<span class="dv">0</span>))</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> dtest_6.groupBy(<span class="st">"GT20DWN"</span>, <span class="st">"predicted_class"</span>).count().orderBy(<span class="st">"GT20DWN"</span>, <span class="st">"predicted_class"</span>)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>TP <span class="op">=</span> dtest_6.<span class="bu">filter</span>((col(<span class="st">"GT20DWN"</span>) <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (col(<span class="st">"predicted_class"</span>) <span class="op">==</span> <span class="dv">1</span>)).count()</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>FP <span class="op">=</span> dtest_6.<span class="bu">filter</span>((col(<span class="st">"GT20DWN"</span>) <span class="op">==</span> <span class="dv">0</span>) <span class="op">&amp;</span> (col(<span class="st">"predicted_class"</span>) <span class="op">==</span> <span class="dv">1</span>)).count()</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>FN <span class="op">=</span> dtest_6.<span class="bu">filter</span>((col(<span class="st">"GT20DWN"</span>) <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (col(<span class="st">"predicted_class"</span>) <span class="op">==</span> <span class="dv">0</span>)).count()</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>TN <span class="op">=</span> dtest_6.<span class="bu">filter</span>((col(<span class="st">"GT20DWN"</span>) <span class="op">==</span> <span class="dv">0</span>) <span class="op">&amp;</span> (col(<span class="st">"predicted_class"</span>) <span class="op">==</span> <span class="dv">0</span>)).count()</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> (TP <span class="op">+</span> TN) <span class="op">/</span> (TP <span class="op">+</span> FP <span class="op">+</span> FN <span class="op">+</span> TN)</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>precision <span class="op">=</span> TP <span class="op">/</span> (TP <span class="op">+</span> FP)</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>recall <span class="op">=</span> TP <span class="op">/</span> (TP <span class="op">+</span> FN)</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>specificity <span class="op">=</span> TN <span class="op">/</span> (TN <span class="op">+</span> FP)</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>average_rate <span class="op">=</span> (TP <span class="op">+</span> FN) <span class="op">/</span> (TP <span class="op">+</span> TN <span class="op">+</span> FP <span class="op">+</span> FN)  <span class="co"># Proportion of actual at-risk babies</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>enrichment <span class="op">=</span> precision <span class="op">/</span> average_rate</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Print formatted confusion matrix with labels</span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st"> Confusion Matrix:</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"                     Predicted"</span>)</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"            |  Negative  |  Positive  "</span>)</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"------------+------------+------------"</span>)</span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Actual Neg. |    </span><span class="sc">{</span>TN<span class="sc">:5}</span><span class="ss">   |    </span><span class="sc">{</span>FP<span class="sc">:5}</span><span class="ss">  |"</span>)</span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"------------+------------+------------"</span>)</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Actual Pos. |    </span><span class="sc">{</span>FN<span class="sc">:5}</span><span class="ss">   |    </span><span class="sc">{</span>TP<span class="sc">:5}</span><span class="ss">  |"</span>)</span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"------------+------------+------------"</span>)</span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Accuracy:  </span><span class="sc">{</span>accuracy<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Precision: </span><span class="sc">{</span>precision<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Recall (Sensitivity): </span><span class="sc">{</span>recall<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Specificity:  </span><span class="sc">{</span>specificity<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average Rate: </span><span class="sc">{</span>average_rate<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Enrichment:   </span><span class="sc">{</span>enrichment<span class="sc">:.4f}</span><span class="ss"> (Relative Precision)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Confusion Matrix:

                     Predicted
            |  Negative  |  Positive  
------------+------------+------------
Actual Neg. |     1248   |      503  |
------------+------------+------------
Actual Pos. |      218   |      265  |
------------+------------+------------
Accuracy:  0.6773
Precision: 0.3451
Recall (Sensitivity): 0.5487
Specificity:  0.7127
Average Rate: 0.2162
Enrichment:   1.5960 (Relative Precision)</code></pre>
</div>
</div>
<div class="cell" data-outputid="0639d746-b925-4c9a-982c-04d363c73a85">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use probability of the positive class (y=1)</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>evaluator <span class="op">=</span> BinaryClassificationEvaluator(labelCol<span class="op">=</span><span class="st">"GT20DWN"</span>, rawPredictionCol<span class="op">=</span><span class="st">"prediction"</span>, metricName<span class="op">=</span><span class="st">"areaUnderROC"</span>)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate AUC</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>auc <span class="op">=</span> evaluator.evaluate(dtest_6)</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"AUC: </span><span class="sc">{</span>auc<span class="sc">:.4f}</span><span class="ss">"</span>)  <span class="co"># Higher is better (closer to 1)</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to Pandas</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>pdf <span class="op">=</span> dtest_6.select(<span class="st">"prediction"</span>, <span class="st">"GT20DWN"</span>).toPandas()</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute ROC curve</span></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>fpr, tpr, _ <span class="op">=</span> roc_curve(pdf[<span class="st">"GT20DWN"</span>], pdf[<span class="st">"prediction"</span>])</span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot ROC curve</span></span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">6</span>))</span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>plt.plot(fpr, tpr, label<span class="op">=</span><span class="ss">f"ROC Curve (AUC = </span><span class="sc">{</span>auc<span class="sc">:.4f}</span><span class="ss">)"</span>)</span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>, label<span class="op">=</span><span class="st">"Random Guess"</span>)</span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"False Positive Rate"</span>)</span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"True Positive Rate"</span>)</span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"ROC Curve"</span>)</span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AUC: 0.6708</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="danl_320_hw3_linear_regression_logistic_regression_housing_markets_files/figure-html/cell-55-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-outputid="d8c9ebd6-2c46-4728-e8db-aae7cb875ac6">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>pdf <span class="op">=</span> dtest_6.select(<span class="st">"prediction"</span>, <span class="st">"GT20DWN"</span>).toPandas()</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract predictions and true labels</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>y_true <span class="op">=</span> pdf[<span class="st">"GT20DWN"</span>]  <span class="co"># True labels</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>y_scores <span class="op">=</span> pdf[<span class="st">"prediction"</span>]  <span class="co"># Predicted probabilities</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute precision, recall, and thresholds</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>precision_plot, recall_plot, thresholds <span class="op">=</span> precision_recall_curve(y_true, y_scores)</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute enrichment: precision divided by average at-risk rate</span></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>average_rate <span class="op">=</span> np.mean(y_true)</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>enrichment_plot <span class="op">=</span> precision_plot <span class="op">/</span> average_rate</span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Define optimal threshold (example: threshold where recall ≈ enrichment balance)</span></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>threshold <span class="op">=</span> <span class="fl">0.24</span>  <span class="co"># Adjust based on the plot</span></span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Enrichment vs. Recall vs. Threshold</span></span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>plt.plot(thresholds, enrichment_plot[:<span class="op">-</span><span class="dv">1</span>], label<span class="op">=</span><span class="st">"Enrichment"</span>, color<span class="op">=</span><span class="st">"blue"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>)</span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>plt.plot(thresholds, recall_plot[:<span class="op">-</span><span class="dv">1</span>], label<span class="op">=</span><span class="st">"Recall"</span>, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">"-"</span>)</span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Add vertical line for chosen threshold</span></span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a>plt.axvline(x<span class="op">=</span>threshold, color<span class="op">=</span><span class="st">"black"</span>, linestyle<span class="op">=</span><span class="st">"dashed"</span>, label<span class="op">=</span><span class="ss">f"Optimal Threshold = </span><span class="sc">{</span>threshold<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb85-24"><a href="#cb85-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-25"><a href="#cb85-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Labels and legend</span></span>
<span id="cb85-26"><a href="#cb85-26" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Threshold"</span>)</span>
<span id="cb85-27"><a href="#cb85-27" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Score"</span>)</span>
<span id="cb85-28"><a href="#cb85-28" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Enrichment vs. Recall"</span>)</span>
<span id="cb85-29"><a href="#cb85-29" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb85-30"><a href="#cb85-30" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb85-31"><a href="#cb85-31" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="danl_320_hw3_linear_regression_logistic_regression_housing_markets_files/figure-html/cell-56-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="comparison" class="level2">
<h2 class="anchored" data-anchor-id="comparison">Comparison</h2>
<section id="residual-deviance" class="level3">
<h3 class="anchored" data-anchor-id="residual-deviance">Residual Deviance</h3>
<ul>
<li>Over 175k Value
<ul>
<li>Residual deviance: 6487.1260 on 5475 degrees of freedom</li>
</ul></li>
<li>Under 175k Value
<ul>
<li>Residual deviance: 5372.3945 on 5407 degrees of freedom</li>
</ul></li>
</ul>
</section>
<section id="marginal-effects-4" class="level3">
<h3 class="anchored" data-anchor-id="marginal-effects-4">Marginal Effects</h3>
<table class="table">
<colgroup>
<col style="width: 13%">
<col style="width: 22%">
<col style="width: 20%">
<col style="width: 23%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Marginal Effect (Over 175k)</th>
<th>Significance (Over 175k)</th>
<th>Marginal Effect (Under 175k)</th>
<th>Significance (Under 175k)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>log_zinc2</td>
<td>-0.0093</td>
<td></td>
<td>-0.0201</td>
<td>***</td>
</tr>
<tr class="even">
<td>BATHS</td>
<td>0.0840</td>
<td>***</td>
<td>0.0239</td>
<td>**</td>
</tr>
<tr class="odd">
<td>BEDRMS</td>
<td>-0.0024</td>
<td></td>
<td>0.0018</td>
<td></td>
</tr>
<tr class="even">
<td>PER</td>
<td>-0.0190</td>
<td>***</td>
<td>-0.0258</td>
<td>***</td>
</tr>
<tr class="odd">
<td>ZADULT</td>
<td>-0.0012</td>
<td></td>
<td>0.0130</td>
<td></td>
</tr>
<tr class="even">
<td>NUNITS</td>
<td>0.0001</td>
<td></td>
<td>0.0004</td>
<td></td>
</tr>
<tr class="odd">
<td>EAPTBL</td>
<td>0.0367</td>
<td></td>
<td>0.0047</td>
<td></td>
</tr>
<tr class="even">
<td>ECOM1</td>
<td>0.0051</td>
<td></td>
<td>-0.0543</td>
<td>***</td>
</tr>
<tr class="odd">
<td>ECOM2</td>
<td>-0.0799</td>
<td></td>
<td>-0.0239</td>
<td></td>
</tr>
<tr class="even">
<td>EGREEN</td>
<td>0.0025</td>
<td></td>
<td>-0.0071</td>
<td></td>
</tr>
<tr class="odd">
<td>EJUNK</td>
<td>-0.0786</td>
<td></td>
<td>-0.0276</td>
<td></td>
</tr>
<tr class="even">
<td>ELOW1</td>
<td>-0.0144</td>
<td></td>
<td>0.0074</td>
<td></td>
</tr>
<tr class="odd">
<td>ESFD</td>
<td>-0.0515</td>
<td></td>
<td>-0.0352</td>
<td>*</td>
</tr>
<tr class="even">
<td>ETRANS</td>
<td>-0.0366</td>
<td></td>
<td>0.0119</td>
<td></td>
</tr>
<tr class="odd">
<td>EABAN</td>
<td>-0.0966</td>
<td></td>
<td>-0.0145</td>
<td></td>
</tr>
<tr class="even">
<td>ODORA</td>
<td>0.0678</td>
<td>*</td>
<td>0.0138</td>
<td></td>
</tr>
<tr class="odd">
<td>STRNA</td>
<td>-0.0511</td>
<td>***</td>
<td>-0.0048</td>
<td></td>
</tr>
<tr class="even">
<td>INTW</td>
<td>-0.0185</td>
<td>***</td>
<td>-0.0100</td>
<td>***</td>
</tr>
<tr class="odd">
<td>MATBUY</td>
<td>0.1150</td>
<td>***</td>
<td>-0.0193</td>
<td>*</td>
</tr>
<tr class="even">
<td>FRSTHO</td>
<td>-0.0948</td>
<td>***</td>
<td>-0.0606</td>
<td>***</td>
</tr>
<tr class="odd">
<td>STATE_CO</td>
<td>-0.0312</td>
<td></td>
<td>-0.1930</td>
<td>***</td>
</tr>
<tr class="even">
<td>STATE_CT</td>
<td>0.1543</td>
<td>***</td>
<td>-0.0227</td>
<td></td>
</tr>
<tr class="odd">
<td>STATE_GA</td>
<td>-0.0874</td>
<td>***</td>
<td>-0.1813</td>
<td>***</td>
</tr>
<tr class="even">
<td>STATE_IL</td>
<td>0.0382</td>
<td></td>
<td>-0.0497</td>
<td></td>
</tr>
<tr class="odd">
<td>STATE_IN</td>
<td>0.0423</td>
<td></td>
<td>-0.1361</td>
<td>***</td>
</tr>
<tr class="even">
<td>STATE_LA</td>
<td>0.1627</td>
<td>***</td>
<td>-0.0728</td>
<td></td>
</tr>
<tr class="odd">
<td>STATE_MO</td>
<td>0.1173</td>
<td>***</td>
<td>-0.1256</td>
<td>**</td>
</tr>
<tr class="even">
<td>STATE_OH</td>
<td>0.1585</td>
<td>***</td>
<td>-0.0464</td>
<td></td>
</tr>
<tr class="odd">
<td>STATE_OK</td>
<td>0.0543</td>
<td></td>
<td>-0.1499</td>
<td>***</td>
</tr>
<tr class="even">
<td>STATE_PA</td>
<td>0.1466</td>
<td>***</td>
<td>-0.0849</td>
<td>*</td>
</tr>
<tr class="odd">
<td>STATE_TX</td>
<td>0.0471</td>
<td></td>
<td>-0.1178</td>
<td>**</td>
</tr>
<tr class="even">
<td>STATE_WA</td>
<td>0.0045</td>
<td></td>
<td>-0.0853</td>
<td></td>
</tr>
<tr class="odd">
<td>METRO_urban</td>
<td>-0.0055</td>
<td></td>
<td>-0.0170</td>
<td></td>
</tr>
<tr class="even">
<td>HHGRAD_Bach</td>
<td>0.0630</td>
<td>***</td>
<td>0.0217</td>
<td></td>
</tr>
<tr class="odd">
<td>HHGRAD_Grad</td>
<td>0.0854</td>
<td>***</td>
<td>0.0377</td>
<td>*</td>
</tr>
<tr class="even">
<td>HHGRAD_HS_Grad</td>
<td>0.0083</td>
<td></td>
<td>-0.0092</td>
<td></td>
</tr>
<tr class="odd">
<td>HHGRAD_No_HS</td>
<td>-0.0343</td>
<td></td>
<td>-0.0408</td>
<td>*</td>
</tr>
<tr class="even">
<td>HOWH_good</td>
<td>-0.0323</td>
<td></td>
<td>-0.0186</td>
<td></td>
</tr>
<tr class="odd">
<td>HOWN_good</td>
<td>0.0796</td>
<td>***</td>
<td>0.0161</td>
<td></td>
</tr>
<tr class="even">
<td>DWNPAY_prev_home</td>
<td>0.1616</td>
<td>***</td>
<td>0.1030</td>
<td>***</td>
</tr>
</tbody>
</table>
</section>
<section id="classification-2" class="level3">
<h3 class="anchored" data-anchor-id="classification-2">Classification</h3>
<p><strong>Thresholds Used</strong><br>
- <strong>Over $175k</strong>: 0.3767<br>
- <strong>Under $175k</strong>: 0.24</p>
<table class="table">
<thead>
<tr class="header">
<th>Metric</th>
<th>Over 175k</th>
<th>Under 175k</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Accuracy</strong></td>
<td>0.6485</td>
<td>0.6773</td>
</tr>
<tr class="even">
<td><strong>Precision</strong></td>
<td>0.5418</td>
<td>0.3451</td>
</tr>
<tr class="odd">
<td><strong>Recall (Sensitivity)</strong></td>
<td>0.6203</td>
<td>0.5487</td>
</tr>
<tr class="even">
<td><strong>Specificity</strong></td>
<td>0.6664</td>
<td>0.7127</td>
</tr>
<tr class="odd">
<td><strong>Average Rate</strong></td>
<td>0.3887</td>
<td>0.2162</td>
</tr>
<tr class="even">
<td><strong>Enrichment</strong><br>(Rel. Precision)</td>
<td>1.3938</td>
<td>1.5960</td>
</tr>
<tr class="odd">
<td><strong>AUC</strong></td>
<td>0.7084</td>
<td>0.6708</td>
</tr>
</tbody>
</table>
<section id="choosing-the-right-threshold" class="level4">
<h4 class="anchored" data-anchor-id="choosing-the-right-threshold">Choosing the Right Threshold</h4>
<p>The thresholds used in our two samples were initially chosen to give clean separation in density plots of the model’s predicted probabilities. However, this may not be optimal. The best classifier is the one that best balances your budget, risk tolerance, and operational capacity. Always tie your classifier threshold back to business costs and benefits, and re-assess as those factors change.</p>
<ol type="1">
<li><p>Put More Emphasis on Precision (Enrichment)</p>
<p><strong>Use Case:</strong></p>
<ul>
<li>Budget‑constrained marketing: You only have $X amount of budget to spend on outreach, so you want to target the very top scorers.<br>
</li>
<li>High cost of a false positive: e.g., sending a promotional offer or pre‑approval letter that you’ll have to honor, even if the buyer can’t actually make a 20% down payment.</li>
</ul>
<p><strong>What happens as you raise the cutoff?</strong></p>
<ul>
<li>Precision ↑ (fewer false positives)<br>
</li>
<li>Recall ↓ (you’ll miss more true positives)<br>
</li>
<li>Fewer people reached, but each one is more likely to convert</li>
</ul>
<p><strong>Example:</strong> raising the cutoff from 0.38 to 0.50 might boost precision from 0.54 → 0.65, but drop recall from 0.62 → 0.40.</p></li>
<li><p>Put More Emphasis on Recall</p>
<p><strong>Use Case:</strong></p>
<ul>
<li>Risk management or compliance: You must flag every buyer who could afford a 20% down payment, even if that means extra follow‑up.<br>
</li>
<li>Cost of missing a true positive is high: e.g., an underwriter must check every possible strong applicant to meet regulatory or fairness mandates.</li>
</ul>
<p><strong>What happens as you lower the cutoff?</strong></p>
<ul>
<li>Recall ↑ (fewer false negatives)<br>
</li>
<li>Precision ↓ (you’ll incur more false positives)<br>
</li>
<li>More people flagged, increasing verification workload</li>
</ul>
<p><strong>Example:</strong> lowering the cutoff from 0.24 to 0.10 might push recall from 0.55 → 0.80, but precision falls from 0.35 → 0.20.</p></li>
</ol>


</section>
</section>
</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
<script src="https://giscus.app/client.js" data-repo="bcdanl/320" data-repo-id="R_kgDONtaKIQ" data-category="General" data-category-id="DIC_kwDONtaKIc4CmOi-" data-mapping="title" data-reactions-enabled="0" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme" data-lang="en" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">powered with github, quarto, and rstudio<br>byeong-hak choe, 2025</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>
<div id="scroll-padding"></div>
<script src="../assets/js/site.js"></script>
<script src="../assets/js/posts.js"></script>



</body></html>